<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2025 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $SCMqt = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private $Q32XX = array('action_logs' => '1.3.8', 'export_pro' => '1.5.8', 'multi_inventory' => '1.8.7', 'product_levels' => '1.9.3', 'purchase_orders' => '1.2.1', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private static $Rv2Cs = []; private static $HjqFn = []; private $OIiMF; public function __construct() { goto cqehL; ggtT3: uNAlz: goto XX0T5; eGfmi: foreach ($aU48q as $SY51M => $gL3xF) { goto CTIZX; l5Qly: KqYlT: goto RMhsj; CTIZX: if (!(!array_key_exists($SY51M, $this->Q32XX) && version_compare($gL3xF, '0.0', '>'))) { goto vLHpH; } goto oRsuW; NxqgP: vLHpH: goto l5Qly; oRsuW: $this->Q32XX[$SY51M] = $gL3xF; goto NxqgP; RMhsj: } goto CbGFh; RCnji: if (empty($aU48q)) { goto uNAlz; } goto eGfmi; CbGFh: SnSMw: goto ggtT3; HsFAN: $aU48q = (array) apply_filters('atum/addons/loader/extra_addons', []); goto RCnji; uOwfB: $this->check_addons(); goto FP2sb; XX0T5: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto uOwfB; cqehL: $this->OIiMF = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto HsFAN; FP2sb: } public function load_addons() { goto Cm13n; ippYT: if (empty($bGIIb)) { goto qj0lo; } goto dDbt8; icH6z: kk9ok: goto b1obT; VXBfs: add_action('admin_enqueue_scripts', function () { goto uak9c; uak9c: Helpers::register_swal_scripts(); goto nu4V1; nu4V1: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto dfvmz; dfvmz: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto wLZFF; wLZFF: }, 1); goto ZBcQy; b1obT: if (empty($M_vw6)) { goto aItEG; } goto VXBfs; wVlJM: $am7v6 = Addons::get_keys(); goto aZ39S; dDbt8: $M_vw6 = []; goto wVlJM; BE2Lx: if (!(count(self::$HjqFn) > 0)) { goto gVWxY; } goto kGwZ8; ZBcQy: $ucJRp = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto PYp9i; aZ39S: $z21kq = Addons::get_addons_paths(); goto C8dHn; C8dHn: foreach ($bGIIb as $R1n01 => $Ayvw_) { goto pEm9y; VyECS: self::$HjqFn[] = $R1n01; goto FWQjX; p6eyI: if (!(empty($am7v6[$P0EY3]['expires']) || strtotime($am7v6[$P0EY3]['expires']) <= time())) { goto ewfKB; } goto IUfM3; ZRGh_: $this->show_notices($Ayvw_, $Ae4V9); goto DImoj; i6vLG: $Ae4V9 = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $Ayvw_['name']); goto HeNyY; vOb5a: $this->show_notices($Ayvw_, $Ae4V9); goto qFM0j; pEm9y: $onGJ2 = str_contains($R1n01, '_trial') || str_contains($Ayvw_['basename'], 'trial'); goto ODi3F; HhHjK: self::$HjqFn[] = $R1n01; goto wR3gB; kd6Pi: goto s112a; goto TYooO; Rrm9l: if (isset($this->Q32XX[$VunE2])) { goto vUyJ2; } goto NoV2N; dn7xR: if (!(empty($am7v6) || empty($am7v6[$P0EY3]) || empty($am7v6[$P0EY3]['key']))) { goto n5JVc; } goto hCVbL; FxK0p: if (!(isset($bGIIb[$VunE2]) || !$this->OIiMF && !empty($z21kq[$VunE2]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $z21kq[$VunE2]['basename']))) { goto hy9R6; } goto bDhRj; TYooO: QxK6L: goto p6eyI; o0vVd: $M_vw6[$R1n01]['extended'] = $am7v6[$P0EY3]['extended'] ?? FALSE; goto KkV2N; u0Gvi: if (!version_compare($this->Q32XX[$VunE2], $Ayvw_['version'], '>')) { goto xBCO6; } goto AGI5I; NoV2N: $Ae4V9 = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $Ayvw_['name']); goto ZRGh_; g55vo: $bslqB = call_user_func($Ayvw_['bootstrap']); goto wit7w; tRZb4: self::$HjqFn[] = $R1n01; goto KmXiN; MzDPQ: self::$HjqFn[] = $R1n01; goto WLWNA; WLWNA: goto s112a; goto pxQOH; Vdjge: $Ae4V9 = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $Ayvw_['name'], date_i18n(get_option('date_format'), strtotime($am7v6[$P0EY3]['expires']))); goto KkWwV; IUfM3: $M_vw6[$R1n01] = $Ayvw_; goto r0P_Y; pxQOH: ewfKB: goto BGRN7; hCVbL: $Ae4V9 = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $Ayvw_['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto K1Nvy; Y_ucl: rGksH: goto DLHlB; ODi3F: $VunE2 = $onGJ2 ? str_replace('_trial', '', $R1n01) : $R1n01; goto hN1gM; plbbG: self::$HjqFn[] = $R1n01; goto Y_ucl; KkWwV: goto S1BNr; goto UXpyX; wit7w: if (!(!$bslqB && !empty($this->SCMqt[$R1n01]) && version_compare($this->SCMqt[$R1n01], $Ayvw_['version'], '<'))) { goto rGksH; } goto GRTDP; n2Eoh: $bGIIb[$R1n01]['bootstrap'] = NULL; goto Qh77i; VEVTG: goto s112a; goto Pj0np; iBSIn: $this->show_notices($Ayvw_, $Ae4V9); goto PTkxb; j4L9M: s112a: goto DseAN; MjuCE: $M_vw6[$R1n01]['key'] = $am7v6[$P0EY3]['key']; goto o0vVd; UXpyX: kXMw3: goto i6vLG; nVyc_: $this->show_notices($Ayvw_, $Ae4V9); goto n2Eoh; hN1gM: $P0EY3 = strtolower($z21kq[$VunE2]['name'] ?? ''); goto Rrm9l; nyOKX: $plUw1 = add_query_arg($u_vqS, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto E1gt_; If4iP: $u_vqS = array('key' => $am7v6[$P0EY3]['key'], 'url' => home_url()); goto nyOKX; sKT9b: if (!$onGJ2) { goto XKezy; } goto FxK0p; K1Nvy: $this->show_notices($Ayvw_, $Ae4V9); goto K3o7i; bDhRj: $Ae4V9 = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $Ayvw_['name']); goto iBSIn; zCuZj: goto s112a; goto Ftu5i; GRTDP: $bGIIb[$R1n01]['bootstrap'] = NULL; goto hkoSk; UmVU1: goto s112a; goto OB7nE; KkV2N: if ('now' === $M_vw6[$R1n01]['expires']) { goto kXMw3; } goto Vdjge; Fotoi: self::$Rv2Cs[] = $R1n01; goto g55vo; M_nG_: $this->show_notices($Ayvw_, $Ae4V9 . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $Ayvw_['addon_url'] . '" target="_blank">', '</a>')); goto v7JEh; PTkxb: $bGIIb[$R1n01]['bootstrap'] = NULL; goto HhHjK; OB7nE: vUyJ2: goto u0Gvi; AGI5I: $Ae4V9 = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $Ayvw_['name'], $this->Q32XX[$VunE2]); goto nVyc_; kK1fY: if (!(!empty($Ayvw_['bootstrap']) && is_callable($Ayvw_['bootstrap']))) { goto lnJAi; } goto Fotoi; HeNyY: S1BNr: goto M_nG_; FWQjX: Addons::delete_status_transient($P0EY3); goto kd6Pi; BGRN7: XKezy: goto kK1fY; CvA5g: n5JVc: goto wcH5c; yB38f: self::$HjqFn[] = $R1n01; goto UmVU1; Ftu5i: hy9R6: goto dn7xR; wR3gB: Addons::delete_status_transient($P0EY3); goto zCuZj; DImoj: $bGIIb[$R1n01]['bootstrap'] = NULL; goto yB38f; DLHlB: lnJAi: goto j4L9M; v7JEh: $bGIIb[$R1n01]['bootstrap'] = NULL; goto MzDPQ; r0P_Y: $M_vw6[$R1n01]['expires'] = $am7v6[$P0EY3]['expires'] ?? 'now'; goto MjuCE; Qh77i: self::$HjqFn[] = $R1n01; goto VEVTG; wcH5c: if (!in_array($am7v6[$P0EY3]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto QxK6L; } goto If4iP; hkoSk: array_pop(self::$Rv2Cs); goto plbbG; Pj0np: xBCO6: goto sKT9b; K3o7i: $bGIIb[$R1n01]['bootstrap'] = NULL; goto tRZb4; mhxvH: goto s112a; goto CvA5g; E1gt_: $Ae4V9 = sprintf('trial_used' === $am7v6[$P0EY3]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $Ayvw_['name'], '<a href="' . $plUw1 . '" target="_blank">', '</a>'); goto vOb5a; KmXiN: Addons::delete_status_transient($P0EY3); goto mhxvH; qFM0j: $bGIIb[$R1n01]['bootstrap'] = NULL; goto VyECS; DseAN: } goto icH6z; PYp9i: $ucJRp->set_js_dependencies(['atum-trials-modal']); goto pxFnp; VSGK5: qj0lo: goto KYmp3; pxFnp: $ucJRp->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($M_vw6), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $M_vw6])); goto pFdiH; kGwZ8: Addons::set_installed_addons($bGIIb); goto Y_Q5r; Y_Q5r: gVWxY: goto VSGK5; Cm13n: $bGIIb = Addons::get_installed_addons(); goto ippYT; pFdiH: aItEG: goto BE2Lx; KYmp3: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($OQJn2) { $OQJn2['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $OQJn2; }); add_action('atum/check_addons', function () { goto anZlk; tPjGY: $G0vkX = Addons::get_installed_addons(); goto H0jFc; R2En4: return; goto DpkK6; PX27d: if (!$QkoVN) { goto G5knG; } goto wl_qK; gM9ee: dGQga: goto PX27d; DpkK6: fHx_v: goto UiaH8; UiaH8: $QkoVN = FALSE; goto bLGjR; bLGjR: foreach ($G0vkX as $LQYJ4) { goto r711E; h0r7v: if (!str_contains($XVs3w, 'trial')) { goto j38Ls; } goto hiK2e; ojYku: $ucQUZ['status'] = $w_O2V->UFd6C; goto N7xhR; E2GYC: Addons::update_key($XVs3w, $ucQUZ); goto m4Jlg; tYD7N: if (!(!is_wp_error($F0p_Q) && isset($CgTWE['status']) && 'valid' === $CgTWE['status'])) { goto bOWqD; } goto ExLge; ez_76: $ucQUZ['trial'] = TRUE; goto mJ5ti; Ifsfe: if (!($w_O2V && !empty($w_O2V->UFd6C))) { goto v6zuo; } goto Sh7G_; dKp0o: $CgTWE = $CWXYJ[$P0EY3]; goto UvPdL; Io28Z: j38Ls: goto lvKWt; h3Ge4: eQ2OU: goto Io28Z; ExLge: $w_O2V = json_decode(wp_remote_retrieve_body($F0p_Q)); goto F94TG; Sh7G_: if (!($CgTWE['status'] !== $w_O2V->UFd6C)) { goto K_0JT; } goto ojYku; F94TG: $ucQUZ = $CgTWE; goto Ifsfe; rbFEB: $QkoVN = TRUE; goto dKp0o; mJ5ti: l1GAj: goto fWTqo; UNjb5: if (!(empty($CgTWE['trial']) && isset($w_O2V->Tn_TY) && TRUE === $w_O2V->Tn_TY)) { goto l1GAj; } goto ez_76; hiK2e: $P0EY3 = trim(str_replace('trial', '', $XVs3w)); goto q4Zne; A3mte: FBhxE: goto UNjb5; pv3Sl: $ucQUZ['expires'] = $w_O2V->aroJb ?? date_i18n('Y-m-d H:i:s'); goto A3mte; lvKWt: GSgn_: goto RaSFK; UvPdL: $F0p_Q = Addons::check_license($XVs3w, $CgTWE['key']); goto tYD7N; HrsYS: $ucQUZ['extended'] = TRUE; goto C7uzz; TuDF_: if (empty(array_diff_assoc($CgTWE, $ucQUZ))) { goto JLBv6; } goto E2GYC; Ovwvh: v6zuo: goto iWEMv; m4Jlg: JLBv6: goto Ovwvh; iWEMv: bOWqD: goto h3Ge4; r711E: $XVs3w = strtolower($LQYJ4['name']); goto h0r7v; wgr08: if (!(empty($CgTWE['expires']) || $CgTWE['expires'] !== $w_O2V->aroJb)) { goto FBhxE; } goto pv3Sl; fWTqo: if (!(empty($CgTWE['extended']) && (!isset($w_O2V->zS6Gi) || TRUE !== $w_O2V->zS6Gi))) { goto iHZdH; } goto HrsYS; C7uzz: iHZdH: goto TuDF_; q4Zne: if (!(is_array($CWXYJ) && array_key_exists($P0EY3, $CWXYJ))) { goto eQ2OU; } goto rbFEB; N7xhR: K_0JT: goto wgr08; RaSFK: } goto gM9ee; wl_qK: Addons::set_last_api_access('check_addons'); goto npU4l; npU4l: G5knG: goto qAaab; H0jFc: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto fHx_v; } goto R2En4; anZlk: $CWXYJ = Addons::get_keys(); goto tPjGY; qAaab: }); } private function show_notices($Ayvw_, $Ae4V9) { AtumAdminNotices::add_notice($Ae4V9, strtolower($Ayvw_['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $Ayvw_['basename'], function ($B77F8, $A2BrZ) use($Ae4V9) { goto zPmHx; Y91EE: echo esc_attr($B77F8); goto OeKti; OeKti: ?>"] th, tr[data-plugin="<?php  goto uGF0M; uGF0M: echo esc_attr($B77F8); goto k0aH5; k0aH5: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto CzqiB; SCOz2: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto Y91EE; lbfAi: echo $Ae4V9; goto SCOz2; zPmHx: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto lbfAi; CzqiB: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$Rv2Cs; } public static function get_non_bootstrapped_addons() { return self::$HjqFn; } public static function check_addon($SY51M, $XVs3w, $rrF5z) { goto CKIVu; L1p71: if (!(stripos($rrF5z, '-trial.php') === FALSE)) { goto ybuqd; } goto yvpiS; gcUXm: saknY: goto N2PVl; yvpiS: return FALSE; goto gVlyU; gVlyU: ybuqd: goto m07h2; m07h2: return TRUE; goto to1mI; N2PVl: if (!(stripos($XVs3w, 'Trial') === FALSE)) { goto OH3HV; } goto IAANE; sTdQv: OH3HV: goto L1p71; Q6RVU: return FALSE; goto gcUXm; CKIVu: if (!(stripos($SY51M, '_trial') === FALSE)) { goto saknY; } goto Q6RVU; IAANE: return FALSE; goto sTdQv; to1mI: } }