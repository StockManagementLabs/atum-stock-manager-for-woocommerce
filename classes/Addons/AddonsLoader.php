<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $i3r_i = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $D3VO4 = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.2', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $QA8SZ = []; private static $XwDGE = []; private $qhcbJ; public function __construct() { goto aD3yO; OJ1ei: $this->check_addons(); goto IeGy8; N8m7I: if (empty($FmQIk)) { goto oP8_A; } goto ce9qk; cGa7K: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto OJ1ei; ce9qk: foreach ($FmQIk as $cS_Z5 => $FdZH_) { goto gPA97; mCBFm: $this->D3VO4[$cS_Z5] = $FdZH_; goto y2QCK; vrFIG: F2nFB: goto YojMv; y2QCK: KqJ1A: goto vrFIG; gPA97: if (!(!array_key_exists($cS_Z5, $this->D3VO4) && version_compare($FdZH_, '0.0', '>'))) { goto KqJ1A; } goto mCBFm; YojMv: } goto LCX0x; aD3yO: $this->qhcbJ = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto tHfx2; tHfx2: $FmQIk = (array) apply_filters('atum/addons/loader/extra_addons', []); goto N8m7I; oKSpZ: oP8_A: goto cGa7K; LCX0x: kAre2: goto oKSpZ; IeGy8: } public function load_addons() { goto EgbPI; EgbPI: $xv1QE = Addons::get_installed_addons(); goto vKnHA; NLq15: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto Bil1P; qt5A3: Ag_mH: goto LYviX; b3cD1: IDE9s: goto qt5A3; MphVx: Addons::set_installed_addons($xv1QE); goto b3cD1; KKxtN: $tTI1i = Addons::get_keys(); goto FAFes; kOWKV: KPf19: goto d3wqZ; Bil1P: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto x3KEc; X9a3q: q08o3: goto uxG9J; Nci8b: $sXHJc = []; goto KKxtN; qRyqn: foreach ($xv1QE as $lqu9B => $xpW7R) { goto Ssc_G; DC3SY: $this->show_notices($xpW7R, $BXhmi); goto IqWx9; nkuxk: goto ZZVSk; goto N2pv8; pfzVS: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto xbIvp; jshxE: if (!(empty($tTI1i) || empty($tTI1i[$lNiM0]) || empty($tTI1i[$lNiM0]['key']))) { goto DB8Jj; } goto lKS2w; eNVXS: $l_bc5 = array('key' => $tTI1i[$lNiM0]['key'], 'url' => home_url()); goto fRAsJ; QRibE: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto ASz0c; fRAsJ: $LKwaG = add_query_arg($l_bc5, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto gXRsC; Tl68W: ovCqp: goto qq1gk; NXpgO: $BXhmi = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $xpW7R['name']); goto ANb_G; ftfJk: self::$XwDGE[] = $lqu9B; goto I5ItP; j2bt3: self::$XwDGE[] = $lqu9B; goto vDfvC; mxMSP: if ('now' === $sXHJc[$lqu9B]['expires']) { goto p1pZ0; } goto Z4KQN; bMlOC: self::$XwDGE[] = $lqu9B; goto XvWF1; b2lOQ: if (!in_array($tTI1i[$lNiM0]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto I5OME; } goto eNVXS; Xu1SF: $this->show_notices($xpW7R, $BXhmi . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $xpW7R['addon_url'] . '" target="_blank">', '</a>')); goto PRJhi; WhvUj: $BXhmi = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $xpW7R['name'], $this->D3VO4[$ahCsn]); goto U1GT1; Z4KQN: $BXhmi = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $xpW7R['name'], date_i18n(get_option('date_format'), strtotime($tTI1i[$lNiM0]['expires']))); goto qUnyW; qw8YT: if (!version_compare($this->D3VO4[$ahCsn], $xpW7R['version'], '>')) { goto Da85v; } goto WhvUj; PRJhi: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto j2bt3; sucIM: if (!(!$EaFFr && !empty($this->i3r_i[$lqu9B]) && version_compare($this->i3r_i[$lqu9B], $xpW7R['version'], '<'))) { goto zP4m2; } goto pfzVS; Ssc_G: $AxUz2 = strpos($lqu9B, '_trial') !== FALSE || strpos($xpW7R['basename'], 'trial') !== FALSE; goto tcoJ8; N2pv8: PC9Oi: goto qw8YT; VRx1D: $sXHJc[$lqu9B]['extended'] = $tTI1i[$lNiM0]['extended'] ?? FALSE; goto mxMSP; HW8V9: DB8Jj: goto b2lOQ; gXRsC: $BXhmi = sprintf('trial_used' === $tTI1i[$lNiM0]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $xpW7R['name'], '<a href="' . $LKwaG . '" target="_blank">', '</a>'); goto afj3Q; iH3AI: $sXHJc[$lqu9B]['expires'] = $tTI1i[$lNiM0]['expires'] ?? 'now'; goto KnoLk; arH2U: p1pZ0: goto NXpgO; afj3Q: $this->show_notices($xpW7R, $BXhmi); goto HAeA6; u8shk: YAKmu: goto jshxE; vDfvC: goto ZZVSk; goto fNW2K; U1GT1: $this->show_notices($xpW7R, $BXhmi); goto QRibE; TK8VD: Addons::delete_status_transient($lNiM0); goto U8xbm; CpUc4: self::$XwDGE[] = $lqu9B; goto TK8VD; znY5K: self::$XwDGE[] = $lqu9B; goto nkuxk; Li9GK: goto ZZVSk; goto pIO0v; e0fg0: $BXhmi = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $xpW7R['name']); goto J7GzA; kczFN: goto ZZVSk; goto dptUW; bDh2B: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto znY5K; egOZm: if (!$AxUz2) { goto NjC33; } goto Nsns2; lKS2w: $BXhmi = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $xpW7R['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto OLMhr; pIO0v: Da85v: goto egOZm; tcoJ8: $ahCsn = $AxUz2 ? str_replace('_trial', '', $lqu9B) : $lqu9B; goto FDhx5; XvWF1: zP4m2: goto Tl68W; fNW2K: hIoEM: goto IiAKf; KnoLk: $sXHJc[$lqu9B]['key'] = $tTI1i[$lNiM0]['key']; goto VRx1D; xbIvp: array_pop(self::$QA8SZ); goto bMlOC; Nsns2: if (!(isset($xv1QE[$ahCsn]) || !$this->qhcbJ && !empty($iQlog[$ahCsn]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $iQlog[$ahCsn]['basename']))) { goto YAKmu; } goto Z7Txw; HAeA6: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto ftfJk; Z7Txw: $BXhmi = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $xpW7R['name']); goto DC3SY; ENaOh: if (!(!empty($xpW7R['bootstrap']) && is_callable($xpW7R['bootstrap']))) { goto ovCqp; } goto a8Lrv; I5ItP: Addons::delete_status_transient($lNiM0); goto kczFN; tFQ5Z: $EaFFr = call_user_func($xpW7R['bootstrap']); goto sucIM; a8Lrv: self::$QA8SZ[] = $lqu9B; goto tFQ5Z; FDhx5: $lNiM0 = strtolower($iQlog[$ahCsn]['name'] ?? ''); goto BPMWy; jFcH1: self::$XwDGE[] = $lqu9B; goto d8CJh; U8xbm: goto ZZVSk; goto HW8V9; BPMWy: if (isset($this->D3VO4[$ahCsn])) { goto PC9Oi; } goto e0fg0; ASz0c: self::$XwDGE[] = $lqu9B; goto Li9GK; d8CJh: Addons::delete_status_transient($lNiM0); goto j7qnp; j7qnp: goto ZZVSk; goto u8shk; ANb_G: XCaHT: goto Xu1SF; OLMhr: $this->show_notices($xpW7R, $BXhmi); goto dsbcj; IiAKf: NjC33: goto ENaOh; qq1gk: ZZVSk: goto oeq21; ymQ3_: if (!(empty($tTI1i[$lNiM0]['expires']) || strtotime($tTI1i[$lNiM0]['expires']) <= time())) { goto hIoEM; } goto Ol9M8; IqWx9: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto jFcH1; Ol9M8: $sXHJc[$lqu9B] = $xpW7R; goto iH3AI; J7GzA: $this->show_notices($xpW7R, $BXhmi); goto bDh2B; dsbcj: $xv1QE[$lqu9B]['bootstrap'] = NULL; goto CpUc4; qUnyW: goto XCaHT; goto arH2U; dptUW: I5OME: goto ymQ3_; oeq21: } goto kOWKV; d3wqZ: if (empty($sXHJc)) { goto q08o3; } goto NLq15; FAFes: $iQlog = Addons::get_addons_paths(); goto qRyqn; uxG9J: if (!(count(self::$XwDGE) > 0)) { goto IDE9s; } goto MphVx; vUeKi: $wDyst->set_js_dependencies(['atum-trials-modal']); goto EkefT; x3KEc: $wDyst = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto vUeKi; EkefT: $wDyst->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($sXHJc), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $sXHJc])); goto X9a3q; vKnHA: if (empty($xv1QE)) { goto Ag_mH; } goto Nci8b; LYviX: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($oZRVf) { $oZRVf['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $oZRVf; }); add_action('atum/check_addons', function () { goto nl8DP; nxAx1: N7qvm: goto uu8Ib; bFQXc: $AQXnI = FALSE; goto wjKcV; msR97: if (!$AQXnI) { goto N7qvm; } goto HlrWb; gRJnP: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto aeAuc; } goto Wt5v5; U27tO: aeAuc: goto bFQXc; OaCoW: $qcbHG = Addons::get_installed_addons(); goto gRJnP; wjKcV: foreach ($qcbHG as $FBKN4) { goto NvCLf; tSRT2: XxYez: goto ct42e; SGAic: if (!(empty($zyWfR['trial']) && isset($GMQrf->KUN2_) && TRUE === $GMQrf->KUN2_)) { goto KTYk_; } goto XWWbT; lpNne: $zyWfR = $noa0V[$lNiM0]; goto oCqSM; XWWbT: $a4mVD['trial'] = TRUE; goto rj4LX; eAENg: if (!(empty($zyWfR['expires']) || $zyWfR['expires'] !== $GMQrf->Z_nc6)) { goto sOvKX; } goto orJIZ; snDkX: if (!(empty($zyWfR['extended']) && (!isset($GMQrf->WSF3O) || TRUE !== $GMQrf->WSF3O))) { goto r4FZF; } goto DO6Pd; oCqSM: $uSaFi = Addons::check_license($snqEJ, $zyWfR['key']); goto aXLnB; eUDl9: if (!(is_array($noa0V) && array_key_exists($lNiM0, $noa0V))) { goto xOcVx; } goto bgdzC; NvCLf: $snqEJ = strtolower($FBKN4['name']); goto gTn3p; ct42e: UAodG: goto eb030; orJIZ: $a4mVD['expires'] = $GMQrf->Z_nc6 ?? date_i18n('Y-m-d H:i:s'); goto zq9zG; zq9zG: sOvKX: goto SGAic; DO6Pd: $a4mVD['extended'] = TRUE; goto Zgt8W; mkwIe: $a4mVD['status'] = $GMQrf->kPQgK; goto mtK3q; mtK3q: vVzBy: goto eAENg; aXLnB: if (!(!is_wp_error($uSaFi) && isset($zyWfR['status']) && 'valid' === $zyWfR['status'])) { goto UAodG; } goto nii7G; R94as: Addons::update_key($snqEJ, $a4mVD); goto FXm_g; gTn3p: if (!(strpos($snqEJ, 'trial') !== FALSE)) { goto VOvnY; } goto LaOKq; ho8sE: if (!$GMQrf) { goto XxYez; } goto L6NzR; rj4LX: KTYk_: goto snDkX; L6NzR: if (!($zyWfR['status'] !== $GMQrf->kPQgK)) { goto vVzBy; } goto mkwIe; Zgt8W: r4FZF: goto V1xVc; bgdzC: $AQXnI = TRUE; goto lpNne; LaOKq: $lNiM0 = trim(str_replace('trial', '', $snqEJ)); goto eUDl9; eb030: xOcVx: goto eJAE2; FXm_g: K3HZU: goto tSRT2; GlE1Y: $a4mVD = $zyWfR; goto ho8sE; nii7G: $GMQrf = json_decode(wp_remote_retrieve_body($uSaFi)); goto GlE1Y; GL362: WY8Wv: goto utq1M; V1xVc: if (empty(array_diff_assoc($zyWfR, $a4mVD))) { goto K3HZU; } goto R94as; eJAE2: VOvnY: goto GL362; utq1M: } goto ItLhU; Wt5v5: return; goto U27tO; ItLhU: Tq7bP: goto msR97; HlrWb: Addons::set_last_api_access('check_addons'); goto nxAx1; nl8DP: $noa0V = Addons::get_keys(); goto OaCoW; uu8Ib: }); } private function show_notices($xpW7R, $BXhmi) { AtumAdminNotices::add_notice($BXhmi, strtolower($xpW7R['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $xpW7R['basename'], function ($k_V06, $eyFdR) use($BXhmi) { goto RezYZ; ou7dW: echo esc_attr($k_V06); goto aX0Us; MYMv4: echo esc_attr($k_V06); goto x8hRR; g2V68: echo $BXhmi; goto b77pp; aX0Us: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto P8xmj; RezYZ: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto g2V68; b77pp: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto MYMv4; x8hRR: ?>"] th, tr[data-plugin="<?php  goto ou7dW; P8xmj: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$QA8SZ; } public static function get_non_bootstrapped_addons() { return self::$XwDGE; } public static function check_addon($cS_Z5, $snqEJ, $zrLHr) { goto X1PJP; vK07R: return FALSE; goto KfP3f; hK27j: if (!(stripos($zrLHr, '-trial.php') === FALSE)) { goto ViWTk; } goto abuHF; KfP3f: Mk_TZ: goto hK27j; mBqRK: ViWTk: goto quTkd; abuHF: return FALSE; goto mBqRK; AOzR_: return FALSE; goto GU289; ltmPX: if (!(stripos($snqEJ, 'Trial') === FALSE)) { goto Mk_TZ; } goto vK07R; quTkd: return TRUE; goto bmJpp; X1PJP: if (!(stripos($cS_Z5, '_trial') === FALSE)) { goto PENCc; } goto AOzR_; GU289: PENCc: goto ltmPX; bmJpp: } }