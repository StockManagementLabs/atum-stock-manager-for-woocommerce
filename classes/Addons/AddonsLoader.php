<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $tttCA = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1'); private $yK7qS = array('action_logs' => '1.3.4', 'export_pro' => '1.5.4', 'multi_inventory' => '1.7.9', 'product_levels' => '1.8.6', 'purchase_orders' => '1.0.9', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0'); private static $wpTqv = []; private static $urZfK = []; private $M0O0U; public function __construct() { goto cOE43; WZhz7: $this->check_trials(); goto qMVRN; cOE43: $this->M0O0U = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto H3VYV; H3VYV: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto WZhz7; qMVRN: } public function load_addons() { goto KAJAQ; sz5F8: Addons::set_installed_addons($pkcKr); goto hvvSO; Aay33: if (empty($pkcKr)) { goto qpH9J; } goto YilKU; S9vQu: XRLyn: goto BLIzY; D0zR5: foreach ($pkcKr as $xf5D8 => $T9rut) { goto Dyjxx; f5I9y: self::$urZfK[] = $xf5D8; goto ujG5u; C0j73: AtumAdminNotices::add_notice($MDPvs, strtolower($T9rut['name']), 'error', FALSE, TRUE); goto OTb0X; fpWz8: if (!(isset($pkcKr[$LJeDP]) || !$this->M0O0U && !empty($XyMNC[$LJeDP]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $XyMNC[$LJeDP]['basename']))) { goto HnH_L; } goto VEsgM; TqMyc: $MDPvs = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $T9rut['name'], $this->yK7qS[$LJeDP]); goto u8XwH; WQh_n: self::$urZfK[] = $xf5D8; goto QbXHd; scbsh: $pkcKr[$xf5D8]['bootstrap'] = NULL; goto f5I9y; rJhH9: AtumAdminNotices::add_notice($MDPvs . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $T9rut['addon_url'] . '" target="_blank">', '</a>'), strtolower($T9rut['name']), 'error', FALSE, TRUE); goto Ncxmi; WYI3f: $pkcKr[$xf5D8]['bootstrap'] = NULL; goto FX7dC; dezaX: bfTvb: goto hrdMK; QGPHS: $lXDz0 = call_user_func($T9rut['bootstrap']); goto xmjbo; HfKNh: Bj5yr: goto XYxv7; Y16ah: $oKCxM[$xf5D8]['expires'] = $p8rD5[$g65hg]['expires'] ?? 'now'; goto QJrAo; FX7dC: self::$urZfK[] = $xf5D8; goto P1b22; Dffg2: jvDLJ: goto XoBcg; Ncxmi: $pkcKr[$xf5D8]['bootstrap'] = NULL; goto U0p14; ZwhPe: if (!(empty($p8rD5) || empty($p8rD5[$g65hg]) || empty($p8rD5[$g65hg]['key']))) { goto RzprL; } goto Wjfuq; RCMYF: HnH_L: goto k7jFt; s4X1u: $MDPvs = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $T9rut['name'], date_i18n(get_option('date_format'), strtotime($p8rD5[$g65hg]['expires']))); goto atVox; gxXnc: $MDPvs = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $T9rut['name']); goto HtgcO; ujG5u: goto jvDLJ; goto vS2pW; Uqsi6: self::$wpTqv[] = $xf5D8; goto QGPHS; VEsgM: $MDPvs = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $T9rut['name']); goto C0j73; aFppC: AtumAdminNotices::add_notice($MDPvs, strtolower($T9rut['name']), 'error', FALSE, TRUE); goto WYI3f; k7jFt: $g65hg = strtolower($XyMNC[$LJeDP]['name'] ?? ''); goto ZwhPe; mOlH5: $LJeDP = $Q9s_t ? str_replace('_trial', '', $xf5D8) : $xf5D8; goto XId8c; QJrAo: $oKCxM[$xf5D8]['key'] = $p8rD5[$g65hg]['key']; goto wHbth; P1b22: goto jvDLJ; goto eceC9; XId8c: if (isset($this->yK7qS[$LJeDP])) { goto LBa9A; } goto gxXnc; kpxVK: YfcKs: goto BoRYS; QbXHd: goto jvDLJ; goto b5YV3; Zx7Ov: $oKCxM[$xf5D8] = $T9rut; goto Y16ah; u8XwH: AtumAdminNotices::add_notice($MDPvs, strtolower($T9rut['name']), 'error', FALSE, TRUE); goto xPjRk; atVox: goto mc0PR; goto kpxVK; CkzDC: array_pop(self::$wpTqv); goto VGj4l; wOMIc: goto jvDLJ; goto dezaX; Qkf0F: mc0PR: goto rJhH9; eceC9: RzprL: goto zFtHd; ICQ3y: self::$urZfK[] = $xf5D8; goto REXc_; Dyjxx: $Q9s_t = strpos($xf5D8, '_trial') !== FALSE || strpos($T9rut['basename'], 'trial') !== FALSE; goto mOlH5; U0p14: self::$urZfK[] = $xf5D8; goto wOMIc; HtgcO: AtumAdminNotices::add_notice($MDPvs, strtolower($T9rut['name']), 'error', FALSE, TRUE); goto scbsh; hmHDG: if (!version_compare($this->yK7qS[$LJeDP], $T9rut['version'], '>')) { goto fffzL; } goto TqMyc; Wjfuq: $MDPvs = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $T9rut['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto aFppC; VGj4l: self::$urZfK[] = $xf5D8; goto HfKNh; zFtHd: if (!(empty($p8rD5[$g65hg]['expires']) || strtotime($p8rD5[$g65hg]['expires']) <= time())) { goto bfTvb; } goto Zx7Ov; wHbth: $oKCxM[$xf5D8]['extended'] = $p8rD5[$g65hg]['extended'] ?? FALSE; goto h5MQk; b5YV3: fffzL: goto YPnSX; REXc_: goto jvDLJ; goto RCMYF; xmjbo: if (!(!$lXDz0 && !empty($this->tttCA[$xf5D8]) && version_compare($this->tttCA[$xf5D8], $T9rut['version'], '<'))) { goto Bj5yr; } goto D_QOr; cK03I: if (!(!empty($T9rut['bootstrap']) && is_callable($T9rut['bootstrap']))) { goto bTNPa; } goto Uqsi6; OTb0X: $pkcKr[$xf5D8]['bootstrap'] = NULL; goto ICQ3y; xPjRk: $pkcKr[$xf5D8]['bootstrap'] = NULL; goto WQh_n; vS2pW: LBa9A: goto hmHDG; h5MQk: if ('now' === $oKCxM[$xf5D8]['expires']) { goto YfcKs; } goto s4X1u; hrdMK: mIYGG: goto cK03I; D_QOr: $pkcKr[$xf5D8]['bootstrap'] = NULL; goto CkzDC; BoRYS: $MDPvs = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $T9rut['name']); goto Qkf0F; XYxv7: bTNPa: goto Dffg2; YPnSX: if (!$Q9s_t) { goto mIYGG; } goto fpWz8; XoBcg: } goto we16I; KRp05: qpH9J: goto trHO7; R9Z1P: $sYhrB->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($oKCxM), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $oKCxM])); goto S9vQu; we16I: lr3e5: goto RjZzk; YilKU: $oKCxM = []; goto RdfUM; RjZzk: if (empty($oKCxM)) { goto XRLyn; } goto OVd0Q; RdfUM: $p8rD5 = Addons::get_keys(); goto xsH0N; OVd0Q: $sYhrB = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto R9Z1P; hvvSO: gJ3ox: goto KRp05; xsH0N: $XyMNC = Addons::get_addons_paths(); goto D0zR5; BLIzY: if (!(count(self::$urZfK) > 0)) { goto gJ3ox; } goto sz5F8; KAJAQ: $pkcKr = Addons::get_installed_addons(); goto Aay33; trHO7: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($HYqBy) { $HYqBy['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $HYqBy; }); add_action('atum/check_trials', function () { goto xQNQN; NoNiE: foreach ($fSlEh as $V9xoF => $KOPaF) { goto c7GOu; ICCZC: pJtUm: goto PC8Gx; HLQHD: WscNH: goto Si0D3; kGQBx: $wulaQ = Addons::check_license($V9xoF, $KOPaF['key']); goto lXynL; u1jeZ: $XmE4S['status'] = $BP4lN->vI7jO; goto l8ZQ4; HDrU8: $XmE4S['extended'] = TRUE; goto TzRlV; CYGYA: if (!(empty($KOPaF['extended']) && (!isset($BP4lN->Nvv3d) || TRUE !== $BP4lN->Nvv3d))) { goto tip2n; } goto HDrU8; LpoXr: rZi5F: goto HLQHD; Si0D3: P1A2C: goto BXsSt; c7GOu: if (!(!empty($KOPaF['trial']) && TRUE === $KOPaF['trial'])) { goto WscNH; } goto kGQBx; JCUcA: Addons::update_key($V9xoF, $XmE4S); goto N25yW; ooPv7: if (!(empty($KOPaF['expires']) || $KOPaF['expires'] !== $BP4lN->Ax2RX)) { goto M2yjp; } goto F2tvL; Gy5fc: $XmE4S['key'] = $KOPaF['key']; goto JCUcA; PC8Gx: if (empty($XmE4S)) { goto wjoHe; } goto Gy5fc; F2tvL: $XmE4S['expires'] = $BP4lN->Ax2RX; goto rnjoN; l8ZQ4: KiVZk: goto ooPv7; N25yW: wjoHe: goto LpoXr; TzRlV: tip2n: goto ICCZC; rnjoN: M2yjp: goto CYGYA; q86FG: if (!$BP4lN) { goto pJtUm; } goto JVHmT; BsCdx: $BP4lN = json_decode(wp_remote_retrieve_body($wulaQ)); goto Jm5W6; Jm5W6: $XmE4S = []; goto q86FG; JVHmT: if (!($KOPaF['status'] !== $BP4lN->vI7jO)) { goto KiVZk; } goto u1jeZ; lXynL: if (!(!is_wp_error($wulaQ) && isset($KOPaF['status']) && 'valid' === $KOPaF['status'])) { goto rZi5F; } goto BsCdx; BXsSt: } goto SFymF; SFymF: QsfxT: goto JZQ8Y; xQNQN: $fSlEh = Addons::get_keys(); goto NoNiE; JZQ8Y: }); } public static function get_bootstrapped_addons() { return self::$wpTqv; } public static function get_non_bootstrapped_addons() { return self::$urZfK; } }