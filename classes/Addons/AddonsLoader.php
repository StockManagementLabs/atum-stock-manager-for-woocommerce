<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $g3JmG = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $WCpNp = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.2', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $VBQ6H = []; private static $pp3Zm = []; private $DSaxC; public function __construct() { goto oK2Iv; QVOyb: $QSDHG = (array) apply_filters('atum/addons/loader/extra_addons', []); goto WU6mi; oK2Iv: $this->DSaxC = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto QVOyb; WU6mi: if (empty($QSDHG)) { goto UmDON; } goto jzlKd; H9Ttd: $this->check_addons(); goto tSC70; cEctG: UmDON: goto gPUaW; jzlKd: foreach ($QSDHG as $uHABy => $h2B1M) { goto mIyMJ; IzX8b: BZEqB: goto SU1aD; JAoT5: $this->WCpNp[$uHABy] = $h2B1M; goto IzX8b; SU1aD: VmyOX: goto GV35J; mIyMJ: if (!(!array_key_exists($uHABy, $this->WCpNp) && version_compare($h2B1M, '0.0', '>'))) { goto BZEqB; } goto JAoT5; GV35J: } goto FHwsw; FHwsw: hSL59: goto cEctG; gPUaW: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto H9Ttd; tSC70: } public function load_addons() { goto NN1YD; iV3VP: $jUUtj->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($eMdrI), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $eMdrI])); goto r2ysN; QyjTK: $eMdrI = []; goto VBEOS; E1MpI: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto YWmiM; UjbRc: s3QOL: goto iwNBm; iwNBm: LEVK3: goto ttRaO; aZgnY: if (empty($T9Lrm)) { goto LEVK3; } goto QyjTK; UK84A: Addons::set_installed_addons($T9Lrm); goto UjbRc; NwL07: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto E1MpI; Ue8Sn: $jUUtj->set_js_dependencies(['atum-trials-modal']); goto iV3VP; opU1C: if (empty($eMdrI)) { goto x12yA; } goto NwL07; o3YaT: foreach ($T9Lrm as $D80DV => $xrm0g) { goto ehsih; WRFTl: M5u_l: goto FdEyF; WGugY: $MFagY = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $xrm0g['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto XXtUL; Nykmh: $O5QoG = $ZAJ2j ? str_replace('_trial', '', $D80DV) : $D80DV; goto AnUU4; Iejbu: $MFagY = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $xrm0g['name']); goto WRFTl; Kn1MM: $this->show_notices($xrm0g, $MFagY); goto zdYs1; IJOyX: if (!version_compare($this->WCpNp[$O5QoG], $xrm0g['version'], '>')) { goto OxPqs; } goto r1b10; FdEyF: $this->show_notices($xrm0g, $MFagY . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $xrm0g['addon_url'] . '" target="_blank">', '</a>')); goto VI2Lc; EQZLO: if (!(empty($wEkji[$UciSr]['expires']) || strtotime($wEkji[$UciSr]['expires']) <= time())) { goto ZBBI3; } goto dlOkc; KVtq_: $eMdrI[$D80DV]['expires'] = $wEkji[$UciSr]['expires'] ?? 'now'; goto WeUXl; OUXSp: if (!(isset($T9Lrm[$O5QoG]) || !$this->DSaxC && !empty($XJQZ5[$O5QoG]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $XJQZ5[$O5QoG]['basename']))) { goto PmaV2; } goto baRDu; owG_S: $UciSr = strtolower($XJQZ5[$O5QoG]['name'] ?? ''); goto P4pS1; nh15d: OxPqs: goto RD1kl; TMWvo: TYnSn: goto k0oQv; N7NV3: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto UGHgN; c7nFm: $eMdrI[$D80DV]['extended'] = $wEkji[$UciSr]['extended'] ?? FALSE; goto Iq9D6; XXtUL: $this->show_notices($xrm0g, $MFagY); goto gw2kw; ehsih: $ZAJ2j = strpos($D80DV, '_trial') !== FALSE || strpos($xrm0g['basename'], 'trial') !== FALSE; goto Nykmh; Hy5TK: if (!('trial_used' === $wEkji[$UciSr]['status'])) { goto TrZqn; } goto BaP0o; k0oQv: ImKgZ: goto h0vvm; Fw9Xz: goto ImKgZ; goto nh15d; rDxuv: goto ImKgZ; goto zCjEC; tHldu: PmaV2: goto owG_S; DEOE4: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto W66QA; r1b10: $MFagY = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $xrm0g['name'], $this->WCpNp[$O5QoG]); goto EKJIB; BaP0o: $cYqIp = array('key' => $wEkji[$UciSr]['key'], 'url' => home_url()); goto OK60o; JzOsv: self::$pp3Zm[] = $D80DV; goto za97x; HNtfn: $this->show_notices($xrm0g, $MFagY); goto TIN0z; jgLSO: $MFagY = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $xrm0g['name'], date_i18n(get_option('date_format'), strtotime($wEkji[$UciSr]['expires']))); goto vlYy6; dlOkc: $eMdrI[$D80DV] = $xrm0g; goto KVtq_; Eddk5: self::$pp3Zm[] = $D80DV; goto oCiaj; KGTTA: $CHyEI = call_user_func($xrm0g['bootstrap']); goto GDaKF; zCjEC: TrZqn: goto EQZLO; mUEDc: self::$pp3Zm[] = $D80DV; goto Iq5su; gw2kw: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto W9bXd; oCiaj: goto ImKgZ; goto t2O85; Iq9D6: if ('now' === $eMdrI[$D80DV]['expires']) { goto QoERI; } goto jgLSO; zdYs1: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto Eddk5; AnUU4: if (isset($this->WCpNp[$O5QoG])) { goto Kh0mm; } goto wJ5Vi; m8ih9: $this->show_notices($xrm0g, $MFagY); goto d_O6a; wJ5Vi: $MFagY = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $xrm0g['name']); goto Kn1MM; d_O6a: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto H_nYn; WeUXl: $eMdrI[$D80DV]['key'] = $wEkji[$UciSr]['key']; goto c7nFm; W4Yu0: if (!(!empty($xrm0g['bootstrap']) && is_callable($xrm0g['bootstrap']))) { goto TYnSn; } goto aiJ7i; SFi3w: goto ImKgZ; goto ytnYG; VI2Lc: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto iwDG0; W66QA: self::$pp3Zm[] = $D80DV; goto Fw9Xz; RD1kl: if (!$ZAJ2j) { goto BJZLK; } goto OUXSp; EKJIB: $this->show_notices($xrm0g, $MFagY); goto DEOE4; baRDu: $MFagY = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $xrm0g['name']); goto HNtfn; P4pS1: if (!(empty($wEkji) || empty($wEkji[$UciSr]) || empty($wEkji[$UciSr]['key']))) { goto Vm01l; } goto WGugY; TIN0z: $T9Lrm[$D80DV]['bootstrap'] = NULL; goto JzOsv; yzHgB: goto ImKgZ; goto Hk3hv; OK60o: $SOxCq = add_query_arg($cYqIp, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto oEKWV; t2O85: Kh0mm: goto IJOyX; Hk3hv: ZBBI3: goto e01PR; ytnYG: Vm01l: goto Hy5TK; GDaKF: if (!(!$CHyEI && !empty($this->g3JmG[$D80DV]) && version_compare($this->g3JmG[$D80DV], $xrm0g['version'], '<'))) { goto Ipv79; } goto N7NV3; UGHgN: array_pop(self::$VBQ6H); goto mUEDc; W9bXd: self::$pp3Zm[] = $D80DV; goto SFi3w; iwDG0: self::$pp3Zm[] = $D80DV; goto yzHgB; aiJ7i: self::$VBQ6H[] = $D80DV; goto KGTTA; za97x: goto ImKgZ; goto tHldu; e01PR: BJZLK: goto W4Yu0; EaEQ_: QoERI: goto Iejbu; vlYy6: goto M5u_l; goto EaEQ_; oEKWV: $MFagY = sprintf(__('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $xrm0g['name'], '<a href="' . $SOxCq . '" target="_blank">', '</a>'); goto m8ih9; H_nYn: self::$pp3Zm[] = $D80DV; goto rDxuv; Iq5su: Ipv79: goto TMWvo; h0vvm: } goto VNWow; r2ysN: x12yA: goto ozbP3; YWmiM: $jUUtj = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto Ue8Sn; ozbP3: if (!(count(self::$pp3Zm) > 0)) { goto s3QOL; } goto UK84A; VBEOS: $wEkji = Addons::get_keys(); goto hJ3DW; NN1YD: $T9Lrm = Addons::get_installed_addons(); goto aZgnY; hJ3DW: $XJQZ5 = Addons::get_addons_paths(); goto o3YaT; VNWow: YH7k8: goto opU1C; ttRaO: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($KzBGr) { $KzBGr['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $KzBGr; }); add_action('atum/check_addons', function () { goto fk9z2; eWKII: N0fND: goto M70Kd; uRIXv: $wwdVt = Addons::get_installed_addons(); goto ekXOH; DYZpd: return; goto fL7v3; JhPUt: nhVQc: goto JzVPV; fL7v3: n3Tcn: goto dXy6l; jwmbQ: Addons::set_last_api_access('check_addons'); goto eWKII; dXy6l: $sLEvs = FALSE; goto BiPYE; BiPYE: foreach ($wwdVt as $jtc4w) { goto Djcuq; F7zWG: $rAXtw = json_decode(wp_remote_retrieve_body($icuvN)); goto H2SZy; qptRD: $UciSr = trim(str_replace('trial', '', $V0o3d)); goto UwK6g; H2SZy: $noD8a = $HxJ7N; goto upsDP; vTmGR: vadBL: goto qxlPT; QtVQH: Addons::update_key($V0o3d, $noD8a); goto c4nhX; NsyTW: mN_4c: goto wVjZV; UODrj: if (!(empty($HxJ7N['expires']) || $HxJ7N['expires'] !== $rAXtw->FYSwH)) { goto SzfnN; } goto bqHvQ; wREtt: if (!(empty($HxJ7N['trial']) && isset($rAXtw->yGx1A) && TRUE === $rAXtw->yGx1A)) { goto OvNys; } goto QyF28; nSfeT: if (!(empty($HxJ7N['extended']) && (!isset($rAXtw->LTyhN) || TRUE !== $rAXtw->LTyhN))) { goto GrcP1; } goto vVAZt; bGt1l: GrcP1: goto j7m7J; dFTr6: w3Wo3: goto UODrj; upsDP: if (!$rAXtw) { goto nCuvi; } goto Q_q8c; TNFqn: $sLEvs = TRUE; goto CoXHl; UwK6g: if (!(is_array($ZP2so) && array_key_exists($UciSr, $ZP2so))) { goto mN_4c; } goto TNFqn; wVjZV: VhaXQ: goto vTmGR; oQabW: if (!(strpos($V0o3d, 'trial') !== FALSE)) { goto VhaXQ; } goto qptRD; qtjlk: if (!(!is_wp_error($icuvN) && isset($HxJ7N['status']) && 'valid' === $HxJ7N['status'])) { goto KLVbT; } goto F7zWG; CoXHl: $HxJ7N = $ZP2so[$UciSr]; goto cOeOX; kspGy: OvNys: goto nSfeT; cOeOX: $icuvN = Addons::check_license($V0o3d, $HxJ7N['key']); goto qtjlk; BVW50: KLVbT: goto NsyTW; rP2J4: $noD8a['status'] = $rAXtw->DQLR6; goto dFTr6; c4nhX: RwB2V: goto DWx5m; Hcfxf: SzfnN: goto wREtt; vVAZt: $noD8a['extended'] = TRUE; goto bGt1l; j7m7J: if (empty(array_diff_assoc($HxJ7N, $noD8a))) { goto RwB2V; } goto QtVQH; bqHvQ: $noD8a['expires'] = $rAXtw->FYSwH ?? date_i18n('Y-m-d H:i:s'); goto Hcfxf; DWx5m: nCuvi: goto BVW50; Q_q8c: if (!($HxJ7N['status'] !== $rAXtw->DQLR6)) { goto w3Wo3; } goto rP2J4; QyF28: $noD8a['trial'] = TRUE; goto kspGy; Djcuq: $V0o3d = strtolower($jtc4w['name']); goto oQabW; qxlPT: } goto JhPUt; JzVPV: if (!$sLEvs) { goto N0fND; } goto jwmbQ; ekXOH: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto n3Tcn; } goto DYZpd; fk9z2: $ZP2so = Addons::get_keys(); goto uRIXv; M70Kd: }); } private function show_notices($xrm0g, $MFagY) { AtumAdminNotices::add_notice($MFagY, strtolower($xrm0g['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $xrm0g['basename'], function ($JdupK, $EFxJI) use($MFagY) { goto RAN52; gIXEC: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto RWlMQ; GOlAa: echo esc_attr($JdupK); goto gIXEC; UWOjg: echo $MFagY; goto AmVIk; RAN52: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto UWOjg; AmVIk: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto CyoP4; tvRzk: ?>"] th, tr[data-plugin="<?php  goto GOlAa; CyoP4: echo esc_attr($JdupK); goto tvRzk; RWlMQ: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$VBQ6H; } public static function get_non_bootstrapped_addons() { return self::$pp3Zm; } public static function check_addon($uHABy, $V0o3d, $TtsPM) { goto HU4Us; zzx4x: return FALSE; goto y5ij6; HU4Us: if (!(stripos($uHABy, '_trial') === FALSE)) { goto I3jLf; } goto N05R0; pAmSC: I3jLf: goto M0iCg; y5ij6: UR1pR: goto vhaES; gtrTY: if (!(stripos($TtsPM, '-trial.php') === FALSE)) { goto UR1pR; } goto zzx4x; M0iCg: if (!(stripos($V0o3d, 'Trial') === FALSE)) { goto OXarc; } goto cp85h; czXVf: OXarc: goto gtrTY; cp85h: return FALSE; goto czXVf; N05R0: return FALSE; goto pAmSC; vhaES: return TRUE; goto lkD38; lkD38: } }