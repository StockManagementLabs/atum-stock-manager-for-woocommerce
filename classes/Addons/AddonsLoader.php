<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $G71Cc = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private $Clr4h = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.6', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private static $thIts = []; private static $c3ZL8 = []; private $yWhVE; public function __construct() { goto RjMHs; dSVbi: foreach ($jaEbF as $ZQD_O => $n1oSZ) { goto geESH; EbrMP: Zs77J: goto mlwDK; mlwDK: Crt6u: goto xO_aX; C9x9V: $this->Clr4h[$ZQD_O] = $n1oSZ; goto EbrMP; geESH: if (!(!array_key_exists($ZQD_O, $this->Clr4h) && version_compare($n1oSZ, '0.0', '>'))) { goto Zs77J; } goto C9x9V; xO_aX: } goto tI_4C; jGWrW: $this->check_addons(); goto Gx2Sz; rPpEj: $jaEbF = (array) apply_filters('atum/addons/loader/extra_addons', []); goto SyJVK; XokzO: HsPAY: goto QQh6F; RjMHs: $this->yWhVE = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto rPpEj; SyJVK: if (empty($jaEbF)) { goto HsPAY; } goto dSVbi; tI_4C: rzyEU: goto XokzO; QQh6F: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto jGWrW; Gx2Sz: } public function load_addons() { goto DPjeL; ksv5t: $BPd_C->set_js_dependencies(['atum-trials-modal']); goto Iodyv; e0QUD: if (!(count(self::$c3ZL8) > 0)) { goto rZBvY; } goto nSF6Q; nSF6Q: Addons::set_installed_addons($qSFUn); goto KpIgF; BaTq1: $qxkaj = []; goto QDXo9; s2eCs: qGfcj: goto WshDc; QDXo9: $HL8_0 = Addons::get_keys(); goto ZKXqz; zo0po: add_action('admin_enqueue_scripts', function () { goto wgUeE; wgUeE: Helpers::register_swal_scripts(); goto tYT4a; tYT4a: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto KQUqj; KQUqj: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto nLnBo; nLnBo: }, 1); goto mjt94; WshDc: if (empty($qxkaj)) { goto xTOFW; } goto zo0po; ZKXqz: $sZiMa = Addons::get_addons_paths(); goto I1K0_; I1K0_: foreach ($qSFUn as $jnUjO => $bb8LL) { goto a0FwL; vdQGM: $this->show_notices($bb8LL, $Qt44t); goto PGI6U; otoPT: gXqfF: goto KTTLy; OyS9L: $this->show_notices($bb8LL, $Qt44t); goto kqn3Z; kgsKq: if (!version_compare($this->Clr4h[$Jcrng], $bb8LL['version'], '>')) { goto HESV_; } goto yFtQb; PGI6U: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto uNBwK; ohNvJ: goto NeeYN; goto L4kxR; L4kxR: IISak: goto aPmLo; Rul6B: self::$c3ZL8[] = $jnUjO; goto bgT5Z; KTTLy: if (!(empty($HL8_0[$aOpEo]['expires']) || strtotime($HL8_0[$aOpEo]['expires']) <= time())) { goto Ds4RO; } goto vJeEP; VALqw: if (!$bzYNg) { goto f4xG5; } goto U7TXD; dhk1x: goto biYEv; goto otoPT; uNBwK: self::$c3ZL8[] = $jnUjO; goto zXCZ9; pGbec: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto OhEsb; yFtQb: $Qt44t = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $bb8LL['name'], $this->Clr4h[$Jcrng]); goto A1ykC; E0Sm1: Ds4RO: goto bFxVq; Vy3OT: $Qt44t = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $bb8LL['name']); goto qX1Q3; fcR15: if (!(!empty($bb8LL['bootstrap']) && is_callable($bb8LL['bootstrap']))) { goto AD7Fh; } goto FMI0M; yR60s: $aOpEo = strtolower($sZiMa[$Jcrng]['name'] ?? ''); goto MQhvZ; FMI0M: self::$thIts[] = $jnUjO; goto sXgYM; LEVVM: goto biYEv; goto E0Sm1; Xpg2k: self::$c3ZL8[] = $jnUjO; goto pbipm; d57h_: $dnX2m = array('key' => $HL8_0[$aOpEo]['key'], 'url' => home_url()); goto qqAam; a0FwL: $bzYNg = strpos($jnUjO, '_trial') !== FALSE || strpos($bb8LL['basename'], 'trial') !== FALSE; goto OB_wM; cCQl1: if (!(!$DKPgL && !empty($this->G71Cc[$jnUjO]) && version_compare($this->G71Cc[$jnUjO], $bb8LL['version'], '<'))) { goto Y3Zeb; } goto pGbec; zXCZ9: Addons::delete_status_transient($aOpEo); goto dhk1x; X6xhW: NeeYN: goto qJ85G; JFNN3: biYEv: goto VuPZr; KAkUb: $qxkaj[$jnUjO]['extended'] = $HL8_0[$aOpEo]['extended'] ?? FALSE; goto HxgKI; qqAam: $rBWbd = add_query_arg($dnX2m, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto XcAM_; nabxE: goto biYEv; goto QnpGM; cwSnw: self::$c3ZL8[] = $jnUjO; goto gULp0; aPmLo: $Qt44t = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $bb8LL['name']); goto X6xhW; MQhvZ: if (isset($this->Clr4h[$Jcrng])) { goto xoxQV; } goto ZgxC7; uA6ty: $Qt44t = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $bb8LL['name'], date_i18n(get_option('date_format'), strtotime($HL8_0[$aOpEo]['expires']))); goto ohNvJ; XcAM_: $Qt44t = sprintf('trial_used' === $HL8_0[$aOpEo]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $bb8LL['name'], '<a href="' . $rBWbd . '" target="_blank">', '</a>'); goto vdQGM; WgayU: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto cwSnw; QnpGM: GRN3D: goto kDSPw; OhEsb: array_pop(self::$thIts); goto xudMC; f4i0a: goto biYEv; goto Q5GQD; qJ85G: $this->show_notices($bb8LL, $Qt44t . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $bb8LL['addon_url'] . '" target="_blank">', '</a>')); goto GcO5T; Nx9wV: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto z3mBL; sXgYM: $DKPgL = call_user_func($bb8LL['bootstrap']); goto cCQl1; hF2Vy: goto biYEv; goto P7NUH; U7TXD: if (!(isset($qSFUn[$Jcrng]) || !$this->yWhVE && !empty($sZiMa[$Jcrng]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $sZiMa[$Jcrng]['basename']))) { goto GRN3D; } goto Vy3OT; RlY6g: self::$c3ZL8[] = $jnUjO; goto LEVVM; jxeqp: if (!in_array($HL8_0[$aOpEo]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto gXqfF; } goto d57h_; vJeEP: $qxkaj[$jnUjO] = $bb8LL; goto DJ56T; EQ9J8: $this->show_notices($bb8LL, $Qt44t); goto u5lpS; bFxVq: f4xG5: goto fcR15; YCWLC: xoxQV: goto kgsKq; iJQ0D: $qxkaj[$jnUjO]['key'] = $HL8_0[$aOpEo]['key']; goto KAkUb; ZgxC7: $Qt44t = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $bb8LL['name']); goto OyS9L; P7NUH: M2RL0: goto jxeqp; u5lpS: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto Xpg2k; GcO5T: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto RlY6g; DJ56T: $qxkaj[$jnUjO]['expires'] = $HL8_0[$aOpEo]['expires'] ?? 'now'; goto iJQ0D; qX1Q3: $this->show_notices($bb8LL, $Qt44t); goto WgayU; A1ykC: $this->show_notices($bb8LL, $Qt44t); goto Nx9wV; pbipm: Addons::delete_status_transient($aOpEo); goto hF2Vy; OB_wM: $Jcrng = $bzYNg ? str_replace('_trial', '', $jnUjO) : $jnUjO; goto yR60s; HxgKI: if ('now' === $qxkaj[$jnUjO]['expires']) { goto IISak; } goto uA6ty; EuVww: $Qt44t = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $bb8LL['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto EQ9J8; xudMC: self::$c3ZL8[] = $jnUjO; goto D7QBS; gULp0: Addons::delete_status_transient($aOpEo); goto nabxE; D7QBS: Y3Zeb: goto aWQGm; aWQGm: AD7Fh: goto JFNN3; kDSPw: if (!(empty($HL8_0) || empty($HL8_0[$aOpEo]) || empty($HL8_0[$aOpEo]['key']))) { goto M2RL0; } goto EuVww; bgT5Z: goto biYEv; goto YCWLC; Q5GQD: HESV_: goto VALqw; kqn3Z: $qSFUn[$jnUjO]['bootstrap'] = NULL; goto Rul6B; z3mBL: self::$c3ZL8[] = $jnUjO; goto f4i0a; VuPZr: } goto s2eCs; mh3av: xTOFW: goto e0QUD; Iodyv: $BPd_C->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($qxkaj), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $qxkaj])); goto mh3av; mjt94: $BPd_C = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto ksv5t; MLLNG: rPi93: goto zHPFC; DPjeL: $qSFUn = Addons::get_installed_addons(); goto giyJC; giyJC: if (empty($qSFUn)) { goto rPi93; } goto BaTq1; KpIgF: rZBvY: goto MLLNG; zHPFC: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($OxRMY) { $OxRMY['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $OxRMY; }); add_action('atum/check_addons', function () { goto eJKuH; ZEhq0: KaoPP: goto dYQng; O5g7p: return; goto GpWiS; dYQng: if (!$SbEzX) { goto tBEdg; } goto K7p7i; e5Mhq: tBEdg: goto cjHnT; WLGXb: $VJVZq = Addons::get_installed_addons(); goto K5uZx; suKk0: foreach ($VJVZq as $qz56T) { goto rU5K6; dWfFN: $lmS07 = $akBJT; goto o2eu_; wemIU: $lmS07['expires'] = $mp6nY->rSzQL ?? date_i18n('Y-m-d H:i:s'); goto f2Xpa; ynuJf: JakVR: goto BB5fB; UzYEB: $aOpEo = trim(str_replace('trial', '', $JUhI5)); goto oKJ3L; yEg0Y: AcLBd: goto V5XjM; BB5fB: if (!(empty($akBJT['extended']) && (!isset($mp6nY->r6Pjx) || TRUE !== $mp6nY->r6Pjx))) { goto m9UXx; } goto MTx4K; JyZiL: $mp6nY = json_decode(wp_remote_retrieve_body($YOmaW)); goto dWfFN; o2eu_: if (!$mp6nY) { goto SjSyh; } goto PNsv2; rNT7j: $YOmaW = Addons::check_license($JUhI5, $akBJT['key']); goto wNgUo; dNzcy: if (!(empty($akBJT['expires']) || $akBJT['expires'] !== $mp6nY->rSzQL)) { goto bcX9S; } goto wemIU; f2Xpa: bcX9S: goto zG8dW; NAhAo: Gomn0: goto jcV1v; wNgUo: if (!(!is_wp_error($YOmaW) && isset($akBJT['status']) && 'valid' === $akBJT['status'])) { goto PltLz; } goto JyZiL; rU5K6: $JUhI5 = strtolower($qz56T['name']); goto CW980; exkvS: Addons::update_key($JUhI5, $lmS07); goto yEg0Y; zG8dW: if (!(empty($akBJT['trial']) && isset($mp6nY->twx2b) && TRUE === $mp6nY->twx2b)) { goto JakVR; } goto ayvEs; dNZV_: PltLz: goto r6VMQ; MTx4K: $lmS07['extended'] = TRUE; goto Sft4z; X27w6: x4rB4: goto NAhAo; ayvEs: $lmS07['trial'] = TRUE; goto ynuJf; Sft4z: m9UXx: goto GmbAA; bgvR0: $akBJT = $NJC3v[$aOpEo]; goto rNT7j; PNsv2: if (!($akBJT['status'] !== $mp6nY->OJJCV)) { goto TTodc; } goto P7tDI; rmwVX: $SbEzX = TRUE; goto bgvR0; P7tDI: $lmS07['status'] = $mp6nY->OJJCV; goto F3PFB; V5XjM: SjSyh: goto dNZV_; oKJ3L: if (!(is_array($NJC3v) && array_key_exists($aOpEo, $NJC3v))) { goto lFWKp; } goto rmwVX; F3PFB: TTodc: goto dNzcy; GmbAA: if (empty(array_diff_assoc($akBJT, $lmS07))) { goto AcLBd; } goto exkvS; r6VMQ: lFWKp: goto X27w6; CW980: if (!(strpos($JUhI5, 'trial') !== FALSE)) { goto x4rB4; } goto UzYEB; jcV1v: } goto ZEhq0; BVz1e: $SbEzX = FALSE; goto suKk0; eJKuH: $NJC3v = Addons::get_keys(); goto WLGXb; GpWiS: nnPxH: goto BVz1e; K5uZx: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto nnPxH; } goto O5g7p; K7p7i: Addons::set_last_api_access('check_addons'); goto e5Mhq; cjHnT: }); } private function show_notices($bb8LL, $Qt44t) { AtumAdminNotices::add_notice($Qt44t, strtolower($bb8LL['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $bb8LL['basename'], function ($fYsBz, $ESqE0) use($Qt44t) { goto M03Xr; M03Xr: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto q4lxZ; TAbxY: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto wzdhd; d3Gb5: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto fEITK; q4lxZ: echo $Qt44t; goto TAbxY; v8PDz: ?>"] th, tr[data-plugin="<?php  goto q4JRc; wzdhd: echo esc_attr($fYsBz); goto v8PDz; q4JRc: echo esc_attr($fYsBz); goto d3Gb5; fEITK: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$thIts; } public static function get_non_bootstrapped_addons() { return self::$c3ZL8; } public static function check_addon($ZQD_O, $JUhI5, $ciNg2) { goto TPyrg; TPyrg: if (!(stripos($ZQD_O, '_trial') === FALSE)) { goto hA9T0; } goto iNY0D; qnuD8: hA9T0: goto bvnin; Y1cjv: return FALSE; goto DdQMz; mo20M: ERpT6: goto O61Ls; bvnin: if (!(stripos($JUhI5, 'Trial') === FALSE)) { goto qU0tm; } goto Y1cjv; DdQMz: qU0tm: goto cC6lA; O61Ls: return TRUE; goto srV0C; iNY0D: return FALSE; goto qnuD8; hdmJh: return FALSE; goto mo20M; cC6lA: if (!(stripos($ciNg2, '-trial.php') === FALSE)) { goto ERpT6; } goto hdmJh; srV0C: } }