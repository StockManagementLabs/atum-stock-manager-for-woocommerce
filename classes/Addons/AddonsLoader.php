<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $c71d1 = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $b8f59 = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.2', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $e9a79 = []; private static $Ae6b6 = []; private $d7da0; public function __construct() { goto Bae51; Bc05a: d7c56: goto F6a9c; Db7de: if (empty($c37a7)) { goto e5e7f; } goto f8ea3; cf07a: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto af16e; af16e: $this->check_addons(); goto fa57f; Bae51: $this->d7da0 = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto c40e6; F6a9c: e5e7f: goto cf07a; c40e6: $c37a7 = (array) apply_filters('atum/addons/loader/extra_addons', []); goto Db7de; f8ea3: foreach ($c37a7 as $B0035 => $F2dc4) { goto E2d97; db736: cc692: goto fc8df; fc8df: E47dc: goto Efde4; E2d97: if (!(!array_key_exists($B0035, $this->b8f59) && version_compare($F2dc4, '0.0', '>'))) { goto cc692; } goto Acab6; Acab6: $this->b8f59[$B0035] = $F2dc4; goto db736; Efde4: } goto Bc05a; fa57f: } public function load_addons() { goto cbf6a; Fe982: $ac00b = Addons::get_keys(); goto d9457; F041f: F9e2b: goto A9223; E6f05: A4d10: goto B6ff7; ed6df: $e5e85->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($Ad8b1), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $Ad8b1])); goto F041f; d5c6d: $e5e85->set_js_dependencies(['atum-trials-modal']); goto ed6df; Ef325: Addons::set_installed_addons($da338); goto E6f05; ba96c: foreach ($da338 as $ebe27 => $de496) { goto f925c; dc67c: E0e6a: goto f2fab; ac873: cd12a: goto Fa575; Fa575: Fe9d3: goto dc67c; B2994: $c2e88 = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $de496['name'], date_i18n(get_option('date_format'), strtotime($ac00b[$bd22d]['expires']))); goto a23ce; A3902: self::$Ae6b6[] = $ebe27; goto ac873; f925c: $F259d = strpos($ebe27, '_trial') !== FALSE || strpos($de496['basename'], 'trial') !== FALSE; goto C5852; B7aac: if (!(empty($ac00b) || empty($ac00b[$bd22d]) || empty($ac00b[$bd22d]['key']))) { goto Dda17; } goto D958f; Aaf0d: goto E0e6a; goto A0305; B2ae9: Dda17: goto c6bc7; ba09b: goto E0e6a; goto eaa2f; Ea910: $B291a = call_user_func($de496['bootstrap']); goto C6f6c; F6a4f: $this->show_notices($de496, $c2e88 . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $de496['addon_url'] . '" target="_blank">', '</a>')); goto E4f86; A5e97: e7e1a: goto fcb04; Af63b: goto E0e6a; goto B2ae9; f9dd5: $af987 = add_query_arg($bea7e, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto E9cf8; dee65: array_pop(self::$e9a79); goto A3902; aae57: $c2e88 = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $de496['name']); goto c2a20; C6f6c: if (!(!$B291a && !empty($this->c71d1[$ebe27]) && version_compare($this->c71d1[$ebe27], $de496['version'], '<'))) { goto cd12a; } goto A6fda; E9cf8: $c2e88 = sprintf(__('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $de496['name'], '<a href="' . $af987 . '" target="_blank">', '</a>'); goto Ae85a; A0305: ac1b6: goto b9a8e; c6bc7: if (!('trial_used' === $ac00b[$bd22d]['status'])) { goto B3d99; } goto c3c5d; D2597: self::$Ae6b6[] = $ebe27; goto ba09b; E1576: $da338[$ebe27]['bootstrap'] = NULL; goto d3391; f6192: if (!version_compare($this->b8f59[$d288e], $de496['version'], '>')) { goto fb39c; } goto bae9b; a23ce: goto F60d8; goto A5e97; fcb04: $c2e88 = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $de496['name']); goto b948c; Ba6bd: self::$Ae6b6[] = $ebe27; goto df7af; C72b7: $da338[$ebe27]['bootstrap'] = NULL; goto Ba6bd; A64d8: b0f04: goto D3495; B78f5: $Ad8b1[$ebe27]['key'] = $ac00b[$bd22d]['key']; goto Ede0c; bc896: $da338[$ebe27]['bootstrap'] = NULL; goto c8f6a; F464d: $this->show_notices($de496, $c2e88); goto bc896; F52c5: B3d99: goto Cca46; d4307: $Ad8b1[$ebe27] = $de496; goto F2771; D5754: ae855: goto A64d8; a8803: $da338[$ebe27]['bootstrap'] = NULL; goto D2597; Ede0c: $Ad8b1[$ebe27]['extended'] = $ac00b[$bd22d]['extended'] ?? FALSE; goto d2687; fc475: goto E0e6a; goto D5754; f69fd: $da338[$ebe27]['bootstrap'] = NULL; goto db9f8; b948c: F60d8: goto F6a4f; C5852: $d288e = $F259d ? str_replace('_trial', '', $ebe27) : $ebe27; goto e13b6; b9a8e: $bd22d = strtolower($e0c8b[$d288e]['name'] ?? ''); goto B7aac; F40ce: goto E0e6a; goto Ea799; eaa2f: be284: goto f6192; c8f6a: self::$Ae6b6[] = $ebe27; goto F40ce; dcdfe: if (!(isset($da338[$d288e]) || !$this->d7da0 && !empty($e0c8b[$d288e]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $e0c8b[$d288e]['basename']))) { goto ac1b6; } goto aae57; Cca46: if (!(empty($ac00b[$bd22d]['expires']) || strtotime($ac00b[$bd22d]['expires']) <= time())) { goto ae855; } goto d4307; c3c5d: $bea7e = array('key' => $ac00b[$bd22d]['key'], 'url' => home_url()); goto f9dd5; Ae85a: $this->show_notices($de496, $c2e88); goto C72b7; df7af: goto E0e6a; goto F52c5; F2771: $Ad8b1[$ebe27]['expires'] = $ac00b[$bd22d]['expires'] ?? 'now'; goto B78f5; E32c2: $this->show_notices($de496, $c2e88); goto f69fd; c2a20: $this->show_notices($de496, $c2e88); goto E1576; D958f: $c2e88 = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $de496['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto E32c2; db9f8: self::$Ae6b6[] = $ebe27; goto Af63b; B06a8: $c2e88 = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $de496['name']); goto eee3c; E4f86: $da338[$ebe27]['bootstrap'] = NULL; goto Cf845; E3657: if (!$F259d) { goto b0f04; } goto dcdfe; A6fda: $da338[$ebe27]['bootstrap'] = NULL; goto dee65; e13b6: if (isset($this->b8f59[$d288e])) { goto be284; } goto B06a8; Cf34b: self::$e9a79[] = $ebe27; goto Ea910; bae9b: $c2e88 = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $de496['name'], $this->b8f59[$d288e]); goto F464d; eee3c: $this->show_notices($de496, $c2e88); goto a8803; D3495: if (!(!empty($de496['bootstrap']) && is_callable($de496['bootstrap']))) { goto Fe9d3; } goto Cf34b; d2687: if ('now' === $Ad8b1[$ebe27]['expires']) { goto e7e1a; } goto B2994; d3391: self::$Ae6b6[] = $ebe27; goto Aaf0d; Cf845: self::$Ae6b6[] = $ebe27; goto fc475; Ea799: fb39c: goto E3657; f2fab: } goto f13a4; A9223: if (!(count(self::$Ae6b6) > 0)) { goto A4d10; } goto Ef325; cbf6a: $da338 = Addons::get_installed_addons(); goto a4d83; F4d7f: $Ad8b1 = []; goto Fe982; edea9: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto B5ccd; e501a: if (empty($Ad8b1)) { goto F9e2b; } goto edea9; f13a4: C06a6: goto e501a; Fb3fe: $e5e85 = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto d5c6d; a4d83: if (empty($da338)) { goto Fe69f; } goto F4d7f; B6ff7: Fe69f: goto f6f5e; d9457: $e0c8b = Addons::get_addons_paths(); goto ba96c; B5ccd: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto Fb3fe; f6f5e: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($c7c1c) { $c7c1c['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $c7c1c; }); add_action('atum/check_addons', function () { goto Be4b9; D0086: self::set_last_api_access('check_addons'); goto c479c; ffb8b: if (!$Ddf79) { goto b80d2; } goto D0086; E1b59: f8f34: goto Af535; Cee10: ed6b2: goto ffb8b; Be4b9: $a50ac = Addons::get_keys(); goto ac72c; c479c: b80d2: goto a51e3; Bb6ee: foreach ($Bc6bf as $C0fc2) { goto D0cf4; fc4a9: if (!$D25f1) { goto Eedb9; } goto a135c; A0df6: D5e7a: goto Ba062; dcb6d: D60ae: goto A0df6; e0561: $Ddf79 = TRUE; goto c7fcf; ec90a: a0f8b: goto c5dc5; c7fcf: $Dfdf9 = $a50ac[$bd22d]; goto C89a8; ce7e8: $C7207['extended'] = TRUE; goto Ddd04; Be790: if (!(strpos($d0cc6, 'trial') !== FALSE)) { goto D60ae; } goto a8971; Eb232: if (!(!is_wp_error($fbd1c) && isset($Dfdf9['status']) && 'valid' === $Dfdf9['status'])) { goto a0f8b; } goto abc58; D0cf4: $d0cc6 = strtolower($C0fc2['name']); goto Be790; a6ea0: eb962: goto f9677; C2828: E04e2: goto a1ff7; F5cc2: if (!(empty($Dfdf9['extended']) && (!isset($D25f1->a2804) || TRUE !== $D25f1->a2804))) { goto e8e64; } goto ce7e8; Cce01: $C7207['status'] = $D25f1->B9c64; goto a6ea0; c5dc5: d8904: goto dcb6d; bf76c: Addons::update_key($d0cc6, $C7207); goto F3f6e; C1528: $C7207['expires'] = $D25f1->Dcff1 ?? date_i18n('Y-m-d H:i:s'); goto C2828; a135c: if (!($Dfdf9['status'] !== $D25f1->B9c64)) { goto eb962; } goto Cce01; Ddd04: e8e64: goto F99c8; ebf20: $C7207['trial'] = TRUE; goto C95b3; a8971: $bd22d = trim(str_replace('trial', '', $d0cc6)); goto d5b04; F3f6e: a77d6: goto Dc2e6; A737a: $C7207 = $Dfdf9; goto fc4a9; Dc2e6: Eedb9: goto ec90a; C95b3: bb2b7: goto F5cc2; a1ff7: if (!(empty($Dfdf9['trial']) && isset($D25f1->a3adb) && TRUE === $D25f1->a3adb)) { goto bb2b7; } goto ebf20; abc58: $D25f1 = json_decode(wp_remote_retrieve_body($fbd1c)); goto A737a; C89a8: $fbd1c = Addons::check_license($d0cc6, $Dfdf9['key']); goto Eb232; d5b04: if (!array_key_exists($a50ac[$bd22d])) { goto d8904; } goto e0561; f9677: if (!(empty($Dfdf9['expires']) || $Dfdf9['expires'] !== $D25f1->Dcff1)) { goto E04e2; } goto C1528; F99c8: if (empty(array_diff_assoc($Dfdf9, $C7207))) { goto a77d6; } goto bf76c; Ba062: } goto Cee10; bda60: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto f8f34; } goto D1bf6; ac72c: $Bc6bf = Addons::get_installed_addons(); goto bda60; D1bf6: return; goto E1b59; Af535: $Ddf79 = FALSE; goto Bb6ee; a51e3: }); } private function show_notices($de496, $c2e88) { AtumAdminNotices::add_notice($c2e88, strtolower($de496['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $de496['basename'], function ($d0a48, $Fe2cc) use($c2e88) { goto E03fb; a9ba0: echo $c2e88; goto F8a36; d02a2: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto Fc8e9; df789: ?>"] th, tr[data-plugin="<?php  goto c5682; F8a36: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto bda37; bda37: echo esc_attr($d0a48); goto df789; c5682: echo esc_attr($d0a48); goto d02a2; E03fb: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto a9ba0; Fc8e9: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$e9a79; } public static function get_non_bootstrapped_addons() { return self::$Ae6b6; } public static function check_addon($B0035, $d0cc6, $Fcdb2) { goto E636c; Da0cd: return TRUE; goto C286d; E849b: if (!(stripos($d0cc6, 'Trial') === FALSE)) { goto Ae29a; } goto E60d2; cdf9d: if (!(stripos($Fcdb2, '-trial.php') === FALSE)) { goto A0713; } goto B6fe0; E636c: if (!(stripos($B0035, '_trial') === FALSE)) { goto Db021; } goto Aa721; D7d68: A0713: goto Da0cd; E60d2: return FALSE; goto Ede70; F1cc1: Db021: goto E849b; B6fe0: return FALSE; goto D7d68; Ede70: Ae29a: goto cdf9d; Aa721: return FALSE; goto F1cc1; C286d: } }