<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $v1j3Q = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1'); private $NtDxj = array('action_logs' => '1.3.4', 'export_pro' => '1.5.4', 'multi_inventory' => '1.7.9', 'product_levels' => '1.8.6', 'purchase_orders' => '1.0.9', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0'); private static $SaDLW = []; private static $JNT2i = []; private $FYaGS; public function __construct() { goto MjU0m; e4Z6P: $this->check_trials(); goto RVWco; ejIkv: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto e4Z6P; MjU0m: $this->FYaGS = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto ejIkv; RVWco: } public function load_addons() { goto YXKXG; xt9xf: $RDlTK = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto BjB1H; V3Hip: $P065K = []; goto KmOBi; OMJrI: $VrXLu = Addons::get_addons_paths(); goto kXxcV; DFLLn: if (!(count(self::$JNT2i) > 0)) { goto mzMlC; } goto rGyWG; KmOBi: $ct8SQ = Addons::get_keys(); goto OMJrI; GyLJE: if (empty($ZpaF3)) { goto XFGIm; } goto V3Hip; rGyWG: Addons::set_installed_addons($ZpaF3); goto kth06; UPylA: XFGIm: goto IxTzF; GGTIk: feQxB: goto DFLLn; kXxcV: foreach ($ZpaF3 as $bpOuP => $UR6uU) { goto IkhXN; EJ8Ix: $P065K[$bpOuP]['key'] = $ct8SQ[$FBVFn]['key']; goto fZCcb; FDD2O: if (!(isset($ZpaF3[$wz03N]) || !$this->FYaGS && !empty($VrXLu[$wz03N]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $VrXLu[$wz03N]['basename']))) { goto O6m1g; } goto tg5sH; qHn7z: ZxGs1: goto pARWz; l1MxR: self::$JNT2i[] = $bpOuP; goto n8K3x; Qk_m8: $ZpaF3[$bpOuP]['bootstrap'] = NULL; goto l1MxR; pARWz: $gsK2g = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $UR6uU['name']); goto CLUki; eqTz8: self::$JNT2i[] = $bpOuP; goto n74WH; J_QbJ: if (!$OH7H1) { goto EpUPq; } goto FDD2O; GR8y0: $FBVFn = strtolower($VrXLu[$wz03N]['name'] ?? ''); goto qjF3_; YfI3z: EpUPq: goto cYf51; JCz01: self::$JNT2i[] = $bpOuP; goto mM_rE; OP1pa: $gsK2g = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $UR6uU['name']); goto PeB82; tg5sH: $gsK2g = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $UR6uU['name']); goto BFimO; g_8uh: if (isset($this->NtDxj[$wz03N])) { goto GCOh2; } goto OP1pa; qjF3_: if (!(empty($ct8SQ) || empty($ct8SQ[$FBVFn]) || empty($ct8SQ[$FBVFn]['key']))) { goto DlgbA; } goto t7KWf; ZfJ0a: O6m1g: goto GR8y0; mM_rE: goto fDtTr; goto JESTR; c5e3q: goto fDtTr; goto ugBHs; xkzJt: $ZpaF3[$bpOuP]['bootstrap'] = NULL; goto bEjTx; PeB82: AtumAdminNotices::add_notice($gsK2g, strtolower($UR6uU['name']), 'error', FALSE, TRUE); goto yBaRP; BAhvW: if ('now' === $P065K[$bpOuP]['expires']) { goto ZxGs1; } goto qXbpy; yfngD: AtumAdminNotices::add_notice($gsK2g . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $UR6uU['addon_url'] . '" target="_blank">', '</a>'), strtolower($UR6uU['name']), 'error', FALSE, TRUE); goto lzFuc; yMAVh: $P065K[$bpOuP] = $UR6uU; goto Kq2jd; pBv6x: AtumAdminNotices::add_notice($gsK2g, strtolower($UR6uU['name']), 'error', FALSE, TRUE); goto Qk_m8; IkhXN: $OH7H1 = strpos($bpOuP, '_trial') !== FALSE || strpos($UR6uU['basename'], 'trial') !== FALSE; goto vTEWb; VBBjy: $ZpaF3[$bpOuP]['bootstrap'] = NULL; goto JCz01; nhPpw: if (!(empty($ct8SQ[$FBVFn]['expires']) || strtotime($ct8SQ[$FBVFn]['expires']) <= time())) { goto LVeWq; } goto yMAVh; owX44: DlgbA: goto nhPpw; CLUki: Z4kja: goto yfngD; fZCcb: $P065K[$bpOuP]['extended'] = $ct8SQ[$FBVFn]['extended'] ?? FALSE; goto BAhvW; gl5v1: oom0u: goto Puotw; vTEWb: $wz03N = $OH7H1 ? str_replace('_trial', '', $bpOuP) : $bpOuP; goto g_8uh; lzFuc: $ZpaF3[$bpOuP]['bootstrap'] = NULL; goto GH3Mp; n74WH: goto fDtTr; goto VUtnd; bsICM: array_pop(self::$SaDLW); goto pxH0c; WDn2b: $dxOpj = call_user_func($UR6uU['bootstrap']); goto pJAiz; ugBHs: LVeWq: goto YfI3z; Kq2jd: $P065K[$bpOuP]['expires'] = $ct8SQ[$FBVFn]['expires'] ?? 'now'; goto EJ8Ix; GH3Mp: self::$JNT2i[] = $bpOuP; goto c5e3q; VUtnd: GCOh2: goto iGeO3; JESTR: jyVoY: goto J_QbJ; yBaRP: $ZpaF3[$bpOuP]['bootstrap'] = NULL; goto eqTz8; QHcrz: goto fDtTr; goto ZfJ0a; t7KWf: $gsK2g = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $UR6uU['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto pBv6x; Y7cox: $ZpaF3[$bpOuP]['bootstrap'] = NULL; goto bsICM; fTjF_: $gsK2g = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $UR6uU['name'], $this->NtDxj[$wz03N]); goto GU_bs; Puotw: VtwAp: goto hOSWl; cYf51: if (!(!empty($UR6uU['bootstrap']) && is_callable($UR6uU['bootstrap']))) { goto VtwAp; } goto cKTvz; iGeO3: if (!version_compare($this->NtDxj[$wz03N], $UR6uU['version'], '>')) { goto jyVoY; } goto fTjF_; GU_bs: AtumAdminNotices::add_notice($gsK2g, strtolower($UR6uU['name']), 'error', FALSE, TRUE); goto VBBjy; BFimO: AtumAdminNotices::add_notice($gsK2g, strtolower($UR6uU['name']), 'error', FALSE, TRUE); goto xkzJt; bEjTx: self::$JNT2i[] = $bpOuP; goto QHcrz; n8K3x: goto fDtTr; goto owX44; Xmjmx: goto Z4kja; goto qHn7z; pxH0c: self::$JNT2i[] = $bpOuP; goto gl5v1; qXbpy: $gsK2g = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $UR6uU['name'], date_i18n(get_option('date_format'), strtotime($ct8SQ[$FBVFn]['expires']))); goto Xmjmx; cKTvz: self::$SaDLW[] = $bpOuP; goto WDn2b; hOSWl: fDtTr: goto rWo4U; pJAiz: if (!(!$dxOpj && !empty($this->v1j3Q[$bpOuP]) && version_compare($this->v1j3Q[$bpOuP], $UR6uU['version'], '<'))) { goto oom0u; } goto Y7cox; rWo4U: } goto fXDxV; YXKXG: $ZpaF3 = Addons::get_installed_addons(); goto GyLJE; r3Xeh: if (empty($P065K)) { goto feQxB; } goto xt9xf; fXDxV: im3Hz: goto r3Xeh; kth06: mzMlC: goto UPylA; BjB1H: $RDlTK->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($P065K), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $P065K])); goto GGTIk; IxTzF: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($gVpbk) { $gVpbk['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $gVpbk; }); add_action('atum/check_trials', function () { goto N72hX; IRFO2: mmMow: goto eXoFM; FTpkH: foreach ($RwC3K as $KncnE => $APl6Q) { goto FrO14; tJo2d: eUhrB: goto ISMzw; THawS: an57a: goto DVTlt; ISMzw: TK7ac: goto tbMOh; wUiuS: if (!(empty($APl6Q['extended']) && (!isset($iW2as->KH8Ei) || TRUE !== $iW2as->KH8Ei))) { goto eUhrB; } goto iq2zo; DVTlt: I94cy: goto hPa4u; wFHAS: rZXop: goto THawS; cQWU1: bDruC: goto wUiuS; WmMZO: IqKfH: goto k2XQK; iq2zo: $LFVSn['extended'] = TRUE; goto tJo2d; f0Ym6: $LFVSn['expires'] = $iW2as->ejhPi; goto cQWU1; jprRC: $LFVSn['key'] = $APl6Q['key']; goto RywV0; hPa4u: XzKv9: goto xVSjU; cE2lI: if (!$iW2as) { goto TK7ac; } goto i7OzH; NRhvv: $LFVSn = []; goto cE2lI; k2XQK: if (!(empty($APl6Q['expires']) || $APl6Q['expires'] !== $iW2as->ejhPi)) { goto bDruC; } goto f0Ym6; dwHak: if (!(!is_wp_error($a4Fh2) && isset($APl6Q['status']) && 'valid' === $APl6Q['status'])) { goto an57a; } goto Zin2B; i7OzH: if (!($APl6Q['status'] !== $iW2as->ZF3OG)) { goto IqKfH; } goto YTLjG; FrO14: if (!(!empty($APl6Q['trial']) && TRUE === $APl6Q['trial'])) { goto I94cy; } goto PUJF1; tbMOh: if (empty($LFVSn)) { goto rZXop; } goto jprRC; RywV0: Addons::update_key($KncnE, $LFVSn); goto wFHAS; YTLjG: $LFVSn['status'] = $iW2as->ZF3OG; goto WmMZO; PUJF1: $a4Fh2 = Addons::check_license($KncnE, $APl6Q['key']); goto dwHak; Zin2B: $iW2as = json_decode(wp_remote_retrieve_body($a4Fh2)); goto NRhvv; xVSjU: } goto IRFO2; N72hX: $RwC3K = Addons::get_keys(); goto FTpkH; eXoFM: }); } public static function get_bootstrapped_addons() { return self::$SaDLW; } public static function get_non_bootstrapped_addons() { return self::$JNT2i; } }