<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $TU6gt = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1'); private $oQDqH = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.1', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0'); private static $Ad3ie = []; private static $Z7K4o = []; private $Fq3F1; public function __construct() { goto aEObE; Ca02F: foreach ($j3d8J as $YqkO1 => $ckxdM) { goto J_roX; J_roX: if (!(!array_key_exists($YqkO1, $this->oQDqH) && version_compare($ckxdM, '0.0', '>'))) { goto vqWS4; } goto z1DjL; e_qhP: vqWS4: goto bJkn5; z1DjL: $this->oQDqH[$YqkO1] = $ckxdM; goto e_qhP; bJkn5: kr5c4: goto kksBJ; kksBJ: } goto rdm0q; rc67X: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto RhcVB; aEObE: $this->Fq3F1 = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto S97KK; rdm0q: Tv4eY: goto C1Z5z; C1Z5z: sCA5b: goto rc67X; S97KK: $j3d8J = (array) apply_filters('atum/addons/loader/extra_addons', []); goto B1kim; B1kim: if (empty($j3d8J)) { goto sCA5b; } goto Ca02F; RhcVB: $this->check_trials(); goto OySxf; OySxf: } public function load_addons() { goto U79fd; bnzoh: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto koDah; einNp: qrOnr: goto Wl0jy; OifVF: $T8x9f->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($yodaw), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $yodaw])); goto R5MEF; koDah: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto Y67We; jlCSQ: foreach ($hfDL2 as $SmmGh => $WP3en) { goto xhWX6; p84lU: $mrPQj = call_user_func($WP3en['bootstrap']); goto YjWdp; AZD1_: if (!version_compare($this->oQDqH[$vzVZV], $WP3en['version'], '>')) { goto Y96d6; } goto WjWG3; WgsN7: $HFvnr = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $WP3en['name']); goto A7C8q; XWPO6: Y96d6: goto DQZsV; vCank: self::$Z7K4o[] = $SmmGh; goto JnpLS; YYN9E: if (!(empty($Vpjzw[$qehSF]['expires']) || strtotime($Vpjzw[$qehSF]['expires']) <= time())) { goto UJE6i; } goto AeDMW; HBj39: self::$Z7K4o[] = $SmmGh; goto UVnKP; nN5Vz: $HFvnr = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $WP3en['name']); goto GzH3E; yxv12: AtumAdminNotices::add_notice($HFvnr, strtolower($WP3en['name']), 'error', FALSE, TRUE); goto gZkmW; AqhJk: self::$Z7K4o[] = $SmmGh; goto BiQPh; gx1uz: $yodaw[$SmmGh]['expires'] = $Vpjzw[$qehSF]['expires'] ?? 'now'; goto PXTp3; D8afE: $qehSF = strtolower($tgJW2[$vzVZV]['name'] ?? ''); goto tjjXX; SLDfB: if ('now' === $yodaw[$SmmGh]['expires']) { goto bAA90; } goto VdGo0; nPgj6: $hfDL2[$SmmGh]['bootstrap'] = NULL; goto AqhJk; dUAnP: $hfDL2[$SmmGh]['bootstrap'] = NULL; goto hmOuo; WjWG3: $HFvnr = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $WP3en['name'], $this->oQDqH[$vzVZV]); goto yxv12; vmWL5: goto Mqljs; goto vkVR0; gZkmW: $hfDL2[$SmmGh]['bootstrap'] = NULL; goto HBj39; JnpLS: goto Mqljs; goto o08bl; YjWdp: if (!(!$mrPQj && !empty($this->TU6gt[$SmmGh]) && version_compare($this->TU6gt[$SmmGh], $WP3en['version'], '<'))) { goto t_6f3; } goto dUAnP; g9sqs: $HFvnr = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $WP3en['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto a23FF; Mfj6k: AtumAdminNotices::add_notice($HFvnr . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $WP3en['addon_url'] . '" target="_blank">', '</a>'), strtolower($WP3en['name']), 'error', FALSE, TRUE); goto LbYSd; vkVR0: UJE6i: goto ClZhS; ClZhS: xHnkn: goto Hmu3o; xhWX6: $CDpdI = strpos($SmmGh, '_trial') !== FALSE || strpos($WP3en['basename'], 'trial') !== FALSE; goto wJgQ9; TiYkE: t_6f3: goto FBzUl; GzH3E: BrCnW: goto Mfj6k; o08bl: EvKjI: goto D8afE; hmOuo: array_pop(self::$Ad3ie); goto rzcvw; BiQPh: goto Mqljs; goto Pal4L; EXCYV: goto Mqljs; goto OmU5n; rzcvw: self::$Z7K4o[] = $SmmGh; goto TiYkE; CKdrS: $hfDL2[$SmmGh]['bootstrap'] = NULL; goto vCank; DQZsV: if (!$CDpdI) { goto xHnkn; } goto ELniL; OmU5n: qpJcA: goto AZD1_; qhIFP: self::$Z7K4o[] = $SmmGh; goto vmWL5; gSHlV: bAA90: goto nN5Vz; xBeDp: if (isset($this->oQDqH[$vzVZV])) { goto qpJcA; } goto SoIS3; bV1Av: goto BrCnW; goto gSHlV; qYfrq: $hfDL2[$SmmGh]['bootstrap'] = NULL; goto xbb9x; a23FF: AtumAdminNotices::add_notice($HFvnr, strtolower($WP3en['name']), 'error', FALSE, TRUE); goto nPgj6; PXTp3: $yodaw[$SmmGh]['key'] = $Vpjzw[$qehSF]['key']; goto EyoPG; UVnKP: goto Mqljs; goto XWPO6; SoIS3: $HFvnr = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $WP3en['name']); goto XCeJo; EyoPG: $yodaw[$SmmGh]['extended'] = $Vpjzw[$qehSF]['extended'] ?? FALSE; goto SLDfB; Fii33: self::$Ad3ie[] = $SmmGh; goto p84lU; wJgQ9: $vzVZV = $CDpdI ? str_replace('_trial', '', $SmmGh) : $SmmGh; goto xBeDp; FBzUl: RRt0U: goto nzJvx; Pal4L: be76x: goto YYN9E; A7C8q: AtumAdminNotices::add_notice($HFvnr, strtolower($WP3en['name']), 'error', FALSE, TRUE); goto CKdrS; VdGo0: $HFvnr = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $WP3en['name'], date_i18n(get_option('date_format'), strtotime($Vpjzw[$qehSF]['expires']))); goto bV1Av; nzJvx: Mqljs: goto qoCCQ; AeDMW: $yodaw[$SmmGh] = $WP3en; goto gx1uz; LbYSd: $hfDL2[$SmmGh]['bootstrap'] = NULL; goto qhIFP; Hmu3o: if (!(!empty($WP3en['bootstrap']) && is_callable($WP3en['bootstrap']))) { goto RRt0U; } goto Fii33; ELniL: if (!(isset($hfDL2[$vzVZV]) || !$this->Fq3F1 && !empty($tgJW2[$vzVZV]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $tgJW2[$vzVZV]['basename']))) { goto EvKjI; } goto WgsN7; XCeJo: AtumAdminNotices::add_notice($HFvnr, strtolower($WP3en['name']), 'error', FALSE, TRUE); goto qYfrq; xbb9x: self::$Z7K4o[] = $SmmGh; goto EXCYV; tjjXX: if (!(empty($Vpjzw) || empty($Vpjzw[$qehSF]) || empty($Vpjzw[$qehSF]['key']))) { goto be76x; } goto g9sqs; qoCCQ: } goto JMEMg; JMEMg: bU3UA: goto hFSmw; AlY3I: $Vpjzw = Addons::get_keys(); goto M7Ms9; Dv20H: Addons::set_installed_addons($hfDL2); goto eiGax; PLc4Q: if (!(count(self::$Z7K4o) > 0)) { goto F1PRB; } goto Dv20H; YotSs: if (empty($hfDL2)) { goto qrOnr; } goto ebP69; hFSmw: if (empty($yodaw)) { goto xMm2z; } goto bnzoh; M7Ms9: $tgJW2 = Addons::get_addons_paths(); goto jlCSQ; ebP69: $yodaw = []; goto AlY3I; U79fd: $hfDL2 = Addons::get_installed_addons(); goto YotSs; R5MEF: xMm2z: goto PLc4Q; eiGax: F1PRB: goto einNp; Y67We: $T8x9f = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto hvPCy; hvPCy: $T8x9f->set_js_dependencies(['atum-trials-modal']); goto OifVF; Wl0jy: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($JetQE) { $JetQE['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $JetQE; }); add_action('atum/check_trials', function () { goto uyozg; Iy3DF: aWM3O: goto b_713; F6qgO: foreach ($cDslh as $woZIh => $rJlOn) { goto v_JzM; d8czy: if (!($rJlOn['status'] !== $k1dnJ->RlCHx)) { goto XBnbG; } goto DMLIQ; jnXxZ: wL2bO: goto iKrbc; AAW_a: $k1dnJ = json_decode(wp_remote_retrieve_body($C9Uw1)); goto R7_cO; llVjY: Addons::update_key($woZIh, $PrLZ_); goto MOQ5D; ljgh9: $PrLZ_['extended'] = TRUE; goto ML9ri; MOQ5D: CupOy: goto jnXxZ; wiJLp: XBnbG: goto FCded; eteyu: if (!(!is_wp_error($C9Uw1) && isset($rJlOn['status']) && 'valid' === $rJlOn['status'])) { goto wL2bO; } goto AAW_a; iKrbc: u2acW: goto iZYSW; ML9ri: Af4mK: goto Grltl; VIFHE: if (!(empty($rJlOn['extended']) && (!isset($k1dnJ->cXp7z) || TRUE !== $k1dnJ->cXp7z))) { goto Af4mK; } goto ljgh9; Y1QHc: if (empty($PrLZ_)) { goto CupOy; } goto TVybd; DMLIQ: $PrLZ_['status'] = $k1dnJ->RlCHx; goto wiJLp; YQTvR: if (!$k1dnJ) { goto xKjSg; } goto d8czy; v_JzM: if (!(!empty($rJlOn['trial']) && TRUE === $rJlOn['trial'])) { goto u2acW; } goto Nr24_; FCded: if (!(empty($rJlOn['expires']) || $rJlOn['expires'] !== $k1dnJ->Amc3W)) { goto OxYWf; } goto aXVBD; vOrbF: OxYWf: goto VIFHE; TVybd: $PrLZ_['key'] = $rJlOn['key']; goto llVjY; iZYSW: us4Xz: goto sBJ2H; R7_cO: $PrLZ_ = []; goto YQTvR; Grltl: xKjSg: goto Y1QHc; aXVBD: $PrLZ_['expires'] = $k1dnJ->Amc3W; goto vOrbF; Nr24_: $C9Uw1 = Addons::check_license($woZIh, $rJlOn['key']); goto eteyu; sBJ2H: } goto Iy3DF; uyozg: $cDslh = Addons::get_keys(); goto F6qgO; b_713: }); } public static function get_bootstrapped_addons() { return self::$Ad3ie; } public static function get_non_bootstrapped_addons() { return self::$Z7K4o; } }