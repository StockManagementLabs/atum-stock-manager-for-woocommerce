<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $myg1B = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1'); private $iyaZT; public function __construct() { goto l0u6p; l0u6p: $this->iyaZT = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto aS7Xz; aS7Xz: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto eQZFR; eQZFR: $this->check_trials(); goto KjMXP; KjMXP: } public function load_addons() { goto Nonun; Mu4DY: p6SPd: goto ZZnCN; S2yCz: $uGxtH = []; goto CjYGV; CjYGV: $QwZfK = Addons::get_keys(); goto lb2nj; t0lrj: foreach ($OyAEM as $QfkTF => $CX2lI) { goto UsSyG; B2poM: $OyAEM[$QfkTF]['bootstrap'] = '__return_false'; goto CXu0N; Ksh09: $OyAEM[$QfkTF]['bootstrap'] = '__return_false'; goto x_ea3; RD1A4: if (!(isset($OyAEM[$Fs16s]) || !$this->iyaZT && !empty($DS_7u[$Fs16s]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $DS_7u[$Fs16s]['basename']))) { goto W6yy3; } goto jRben; DlhB9: ej_uG: goto VgRig; VgRig: boHPh: goto DgIof; XIKi3: goto boHPh; goto xtam5; WWMHR: $OyAEM[$QfkTF]['bootstrap'] = '__return_false'; goto Uwh4x; roil_: if (!(empty($QwZfK[$jmnd3]['expires']) || strtotime($QwZfK[$jmnd3]['expires']) <= time())) { goto krmiS; } goto JRjpG; b1V2M: KYiZ1: goto roil_; hjroL: $jmnd3 = strtolower($DS_7u[$Fs16s]['name']); goto RD1A4; HJfU0: if (!(!$oQhyS && !empty($this->myg1B[$QfkTF]) && version_compare($this->myg1B[$QfkTF], $CX2lI['version'], '<'))) { goto N8NhG; } goto B2poM; o8jYg: KVSX1: goto EvQV0; EK5jq: N8NhG: goto DlhB9; bbgK7: goto boHPh; goto b1V2M; jRben: $i79mZ = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $CX2lI['name']); goto qS7Qd; xeVDs: if (!(!empty($CX2lI['bootstrap']) && is_callable($CX2lI['bootstrap']))) { goto ej_uG; } goto W1E7x; nMbQu: if (!$D73Rd) { goto qpuD0; } goto DmoqU; EvQV0: AtumAdminNotices::add_notice($i79mZ . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $CX2lI['addon_url'] . '" target="_blank">', '</a>'), strtolower($CX2lI['name']), 'error', FALSE, TRUE); goto vPShc; vPShc: $OyAEM[$QfkTF]['bootstrap'] = '__return_false'; goto ibSbU; W1E7x: $oQhyS = call_user_func($CX2lI['bootstrap']); goto HJfU0; Uwh4x: $VnpW3++; goto xO1vN; BZEJ2: $i79mZ = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $CX2lI['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto mDrlp; hayxX: fTZN1: goto rLNMA; DmoqU: $Fs16s = str_replace('_trial', '', $QfkTF); goto hjroL; JDdA7: $uGxtH[$QfkTF]['key'] = $QwZfK[$jmnd3]['key']; goto BXIC1; LlcJ4: qpuD0: goto xeVDs; CXu0N: $VnpW3++; goto EK5jq; c1UfC: goto KVSX1; goto hayxX; x_ea3: $VnpW3++; goto bbgK7; qeouL: $i79mZ = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $CX2lI['name'], date_i18n(get_option('date_format'), strtotime($QwZfK[$jmnd3]['expires']))); goto c1UfC; rLNMA: $i79mZ = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $CX2lI['name']); goto o8jYg; q4P8u: W6yy3: goto Vuice; BXIC1: $uGxtH[$QfkTF]['extended'] = $QwZfK[$jmnd3]['extended'] ?? FALSE; goto p6oXc; JRjpG: $uGxtH[$QfkTF] = $CX2lI; goto KkgUH; p6oXc: if ('now' === $uGxtH[$QfkTF]['expires']) { goto fTZN1; } goto qeouL; KkgUH: $uGxtH[$QfkTF]['expires'] = $QwZfK[$jmnd3]['expires'] ?? 'now'; goto JDdA7; xO1vN: goto boHPh; goto q4P8u; UsSyG: $D73Rd = strpos($QfkTF, '_trial') !== FALSE || strpos($CX2lI['basename'], 'trial') !== FALSE; goto nMbQu; mDrlp: AtumAdminNotices::add_notice($i79mZ, strtolower($CX2lI['name']), 'error', FALSE, TRUE); goto Ksh09; Vuice: if (!(empty($QwZfK) || empty($QwZfK[$jmnd3]) || empty($QwZfK[$jmnd3]['key']))) { goto KYiZ1; } goto BZEJ2; qS7Qd: AtumAdminNotices::add_notice($i79mZ, strtolower($CX2lI['name']), 'error', FALSE, TRUE); goto WWMHR; xtam5: krmiS: goto LlcJ4; ibSbU: $VnpW3++; goto XIKi3; DgIof: } goto Iy7Pz; MNvK4: Addons::set_installed_addons($OyAEM); goto a8dgX; Iy7Pz: Ujr9y: goto yvz0f; BC7C5: if (!($VnpW3 > 0)) { goto RH62R; } goto MNvK4; E1qJI: if (empty($OyAEM)) { goto p6SPd; } goto CddeY; CddeY: $VnpW3 = 0; goto S2yCz; ZWu3P: $te5cL->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($uGxtH), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', compact('expired_trials'))); goto fi2t9; a8dgX: RH62R: goto Mu4DY; c64YR: $te5cL = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto ZWu3P; lb2nj: $DS_7u = Addons::get_addons_paths(); goto t0lrj; yvz0f: if (empty($uGxtH)) { goto D63z9; } goto c64YR; fi2t9: D63z9: goto BC7C5; Nonun: $OyAEM = Addons::get_installed_addons(); goto E1qJI; ZZnCN: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($eJScE) { $eJScE['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $eJScE; }); add_action('atum/check_trials', function () { goto OKq0i; uzkKT: foreach ($aAG9B as $sBVsA => $EwkW2) { goto qjXse; m5v_f: Yg7Ga: goto sq93O; c8ilS: if (empty($bU34X)) { goto JzOCl; } goto qB5pE; sq93O: K3GQt: goto iHaFn; BMdln: Addons::update_key($sBVsA, $bU34X); goto WLcM9; i0bIk: rD3TL: goto PvByU; M7ei5: xhmdv: goto sua2y; sua2y: if (!(empty($EwkW2['extended']) && (!isset($FMvzI->NARa2) || TRUE !== $FMvzI->NARa2))) { goto rD3TL; } goto E9bP8; afwB2: if (!$FMvzI) { goto R9rV_; } goto WOac1; Mithz: Q9QGJ: goto suA6s; gLXdN: $FMvzI = json_decode(wp_remote_retrieve_body($bidOb)); goto xf2vv; qjXse: if (!(!empty($EwkW2['trial']) && TRUE === $EwkW2['trial'])) { goto K3GQt; } goto CfTCH; WLcM9: JzOCl: goto m5v_f; CfTCH: $bidOb = Addons::check_license($sBVsA, $EwkW2['key']); goto BrUfP; Rpk6r: $bU34X['status'] = $FMvzI->tdRYx; goto Mithz; suA6s: if (!(empty($EwkW2['expires']) || $EwkW2['expires'] !== $FMvzI->UNNAV)) { goto xhmdv; } goto NAT1o; xf2vv: $bU34X = []; goto afwB2; qB5pE: $bU34X['key'] = $EwkW2['key']; goto BMdln; NAT1o: $bU34X['expires'] = $FMvzI->UNNAV; goto M7ei5; BrUfP: if (!(!is_wp_error($bidOb) && isset($EwkW2['status']) && 'valid' === $EwkW2['status'])) { goto Yg7Ga; } goto gLXdN; E9bP8: $bU34X['extended'] = TRUE; goto i0bIk; PvByU: R9rV_: goto c8ilS; WOac1: if (!($EwkW2['status'] !== $FMvzI->tdRYx)) { goto Q9QGJ; } goto Rpk6r; iHaFn: SpFUr: goto wUnRs; wUnRs: } goto NCas7; OKq0i: $aAG9B = Addons::get_keys(); goto uzkKT; NCas7: yXpg9: goto m0Mo_; m0Mo_: }); } }
