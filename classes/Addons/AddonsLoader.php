<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2025 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $pdc3K = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private $bSQ1M = array('action_logs' => '1.3.8', 'export_pro' => '1.6.5', 'multi_inventory' => '1.9.5', 'product_levels' => '1.9.9', 'purchase_orders' => '1.2.5', 'stock_takes' => '1.0.7', 'pick_pack' => '1.0.9', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.2.0'); private static $HpY5J = []; private static $A0q7w = []; private $wld3C; public function __construct() { goto X3MQW; mH3km: foreach ($GWBUg as $Kya3D => $dJUuR) { goto LMjMz; zXjGv: $this->bSQ1M[$Kya3D] = $dJUuR; goto XuytT; LMjMz: if (!(!array_key_exists($Kya3D, $this->bSQ1M) && version_compare($dJUuR, '0.0', '>'))) { goto PPG3k; } goto zXjGv; XuytT: PPG3k: goto dzlUC; dzlUC: OQZ7y: goto rAGGq; rAGGq: } goto NFdG9; HF7Tw: $this->check_addons(); goto Z_Y0F; X3MQW: $this->wld3C = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto bAiTF; AcBae: if (empty($GWBUg)) { goto mAqQc; } goto mH3km; bAiTF: $GWBUg = (array) apply_filters('atum/addons/loader/extra_addons', []); goto AcBae; M5rYZ: mAqQc: goto kqlfV; kqlfV: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto HF7Tw; NFdG9: dZWd7: goto M5rYZ; Z_Y0F: } public function load_addons() { goto LzXXu; y8KSw: foreach ($pIoj8 as $L6Q3Y => $kOpWq) { goto pTaT8; BAqHn: $eZPA9[$L6Q3Y]['expires'] = $ggW2O[$SkyUK]['expires'] ?? 'now'; goto qbreC; hnnOV: $PF0AA = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $kOpWq['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto azAVR; azAVR: $this->show_notices($kOpWq, $PF0AA); goto IUj6o; pk2LM: if (!(empty($ggW2O) || empty($ggW2O[$SkyUK]) || empty($ggW2O[$SkyUK]['key']))) { goto vXTtP; } goto hnnOV; DCF1u: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto F8e6N; BSkfU: self::$A0q7w[] = $L6Q3Y; goto nr2hM; FZV0s: EPYlx: goto dF6P1; uLv1Y: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto xjW1G; aXpnF: goto x1aQf; goto Mnp5U; OlBHi: goto VZvnm; goto AP2MU; ta0CW: ZFyIU: goto ZdrZs; sVMfz: if (!(!$DNpaO && !empty($this->pdc3K[$L6Q3Y]) && version_compare($this->pdc3K[$L6Q3Y], $kOpWq['version'], '<'))) { goto u6OrQ; } goto uLv1Y; ZdrZs: if (!version_compare($this->bSQ1M[$C4gXD], $kOpWq['version'], '>')) { goto u2I91; } goto CCbte; pTaT8: $mvwFe = str_contains($L6Q3Y, '_trial') || str_contains($kOpWq['basename'], 'trial'); goto YLXxB; s1TB_: G2mZ9: goto IJEOn; AP2MU: u2I91: goto O12pS; YR9R9: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto PNupY; O12pS: if (!$mvwFe) { goto P03o9; } goto MUCj1; ptxON: if (!in_array($ggW2O[$SkyUK]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto gdJul; } goto LnS73; qbreC: $eZPA9[$L6Q3Y]['key'] = $ggW2O[$SkyUK]['key']; goto DBFqN; DBFqN: $eZPA9[$L6Q3Y]['extended'] = $ggW2O[$SkyUK]['extended'] ?? FALSE; goto vwmsa; vwmsa: if ('now' === $eZPA9[$L6Q3Y]['expires']) { goto ELM3N; } goto wyrjG; sogAS: $this->show_notices($kOpWq, $PF0AA); goto DCF1u; qFHRf: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto Ck86b; azXaS: $PF0AA = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $kOpWq['name']); goto G1qai; OS9Sn: if (isset($this->bSQ1M[$C4gXD])) { goto ZFyIU; } goto azXaS; BITg2: $PF0AA = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $kOpWq['name']); goto m_dM5; PNupY: self::$A0q7w[] = $L6Q3Y; goto OlBHi; IJEOn: P03o9: goto ynO4I; ynO4I: if (!(!empty($kOpWq['bootstrap']) && is_callable($kOpWq['bootstrap']))) { goto EPYlx; } goto UyCJ2; YLXxB: $C4gXD = $mvwFe ? str_replace('_trial', '', $L6Q3Y) : $L6Q3Y; goto jOgxh; vKVob: $eZPA9[$L6Q3Y] = $kOpWq; goto BAqHn; OSGxk: self::$A0q7w[] = $L6Q3Y; goto xh_TG; QX_Fn: XGZuB: goto pk2LM; NXEUl: $WFmxJ = add_query_arg($HsAKv, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto sJK3D; toJ3P: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto Her0h; ttJVS: $DNpaO = call_user_func($kOpWq['bootstrap']); goto sVMfz; MUCj1: if (!(isset($pIoj8[$C4gXD]) || !$this->wld3C && !empty($avheu[$C4gXD]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $avheu[$C4gXD]['basename']))) { goto XGZuB; } goto BITg2; dF6P1: VZvnm: goto OZpvA; ilokq: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto OSGxk; G1qai: $this->show_notices($kOpWq, $PF0AA); goto toJ3P; nr2hM: u6OrQ: goto FZV0s; wyrjG: $PF0AA = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $kOpWq['name'], date_i18n(get_option('date_format'), strtotime($ggW2O[$SkyUK]['expires']))); goto aXpnF; sJK3D: $PF0AA = sprintf('trial_used' === $ggW2O[$SkyUK]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $kOpWq['name'], '<a href="' . $WFmxJ . '" target="_blank">', '</a>'); goto sogAS; CCbte: $PF0AA = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $kOpWq['name'], $this->bSQ1M[$C4gXD]); goto Ylpov; m_dM5: $this->show_notices($kOpWq, $PF0AA); goto qFHRf; W4kAm: goto VZvnm; goto ta0CW; jGiWt: x1aQf: goto vPO4P; xjW1G: array_pop(self::$HpY5J); goto BSkfU; jOgxh: $SkyUK = strtolower($avheu[$C4gXD]['name'] ?? ''); goto OS9Sn; RSsJz: goto VZvnm; goto QX_Fn; Ck86b: self::$A0q7w[] = $L6Q3Y; goto Zg4jx; MKmfb: vXTtP: goto ptxON; LnS73: $HsAKv = array('key' => $ggW2O[$SkyUK]['key'], 'url' => home_url()); goto NXEUl; qdRgm: gdJul: goto gqgds; w5smf: $PF0AA = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $kOpWq['name']); goto jGiWt; IUj6o: $pIoj8[$L6Q3Y]['bootstrap'] = NULL; goto qYxxA; GxWfp: goto VZvnm; goto MKmfb; Mnp5U: ELM3N: goto w5smf; xh_TG: goto VZvnm; goto s1TB_; Ylpov: $this->show_notices($kOpWq, $PF0AA); goto YR9R9; UmLpJ: goto VZvnm; goto qdRgm; UyCJ2: self::$HpY5J[] = $L6Q3Y; goto ttJVS; gqgds: if (!(empty($ggW2O[$SkyUK]['expires']) || strtotime($ggW2O[$SkyUK]['expires']) <= time())) { goto G2mZ9; } goto vKVob; bxwKT: Addons::delete_status_transient($SkyUK); goto GxWfp; Her0h: self::$A0q7w[] = $L6Q3Y; goto W4kAm; qYxxA: self::$A0q7w[] = $L6Q3Y; goto bxwKT; F8e6N: self::$A0q7w[] = $L6Q3Y; goto BdHsI; Zg4jx: Addons::delete_status_transient($SkyUK); goto RSsJz; vPO4P: $this->show_notices($kOpWq, $PF0AA . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $kOpWq['addon_url'] . '" target="_blank">', '</a>')); goto ilokq; BdHsI: Addons::delete_status_transient($SkyUK); goto UmLpJ; OZpvA: } goto aqLRQ; P4OYF: $avheu = Addons::get_addons_paths(); goto y8KSw; EvUKN: $ggW2O = Addons::get_keys(); goto P4OYF; KIK2n: $pb_Kg = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto OM4Eg; OM4Eg: $pb_Kg->set_js_dependencies(['atum-trials-modal']); goto kRQpJ; Bcjwx: Addons::set_installed_addons($pIoj8); goto ZHQFv; cjAy6: $eZPA9 = []; goto EvUKN; kRQpJ: $pb_Kg->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($eZPA9), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $eZPA9])); goto mRP7S; ZHQFv: wU6cH: goto JtA8o; aqLRQ: us9Ta: goto qGMOm; qGMOm: if (empty($eZPA9)) { goto XWFBi; } goto vi6cI; ADdsq: if (!(count(self::$A0q7w) > 0)) { goto wU6cH; } goto Bcjwx; JtA8o: obGvc: goto CCgqT; vi6cI: add_action('admin_enqueue_scripts', function () { goto EdxEC; rqIus: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto uPpP1; EdxEC: Helpers::register_swal_scripts(); goto w8lHQ; w8lHQ: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto rqIus; uPpP1: }, 1); goto KIK2n; KCs1n: if (empty($pIoj8)) { goto obGvc; } goto cjAy6; mRP7S: XWFBi: goto ADdsq; LzXXu: $pIoj8 = Addons::get_installed_addons(); goto KCs1n; CCgqT: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($IPh_I) { $IPh_I['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $IPh_I; }); add_action('atum/check_addons', function () { goto TM_8H; sZrqU: $d_Rqa = Addons::get_installed_addons(); goto CKwrT; J6dWH: cEqm2: goto madVS; OCnod: foreach ($d_Rqa as $FKsR1) { goto ClCpl; ClCpl: $khM0D = strtolower($FKsR1['name']); goto tC78w; h2HyR: if (!($z5nfa && !empty($z5nfa->EVmy2))) { goto hy1ix; } goto laPI_; stDsJ: if (!(is_array($Y_UlP) && array_key_exists($SkyUK, $Y_UlP))) { goto N5zRf; } goto qz7u0; laPI_: if (!($nzO1V['status'] !== $z5nfa->EVmy2)) { goto OrOzy; } goto dXKv5; yLLOZ: qLZMJ: goto OrTju; pfv0e: $DTO_A['trial'] = TRUE; goto pDwOh; Cli1B: if (!(empty($nzO1V['expires']) || $nzO1V['expires'] !== $z5nfa->YQBsc)) { goto qLZMJ; } goto l7QDw; LN39m: $DTO_A = $nzO1V; goto h2HyR; X84Iq: $SkyUK = trim(str_replace('trial', '', $khM0D)); goto stDsJ; wGWHo: $z5nfa = json_decode(wp_remote_retrieve_body($PVTqc)); goto LN39m; wY0jU: Addons::update_key($khM0D, $DTO_A); goto hsb9k; mMjW6: R1lTI: goto gPE6_; Y5QDt: RF4BT: goto gHi_P; hsb9k: H4IXp: goto aQfjO; pDwOh: ZMFT8: goto B1W3l; aQfjO: hy1ix: goto Y5QDt; NdKun: $PVTqc = Addons::check_license($khM0D, $nzO1V['key']); goto JQxx3; tC78w: if (!str_contains($khM0D, 'trial')) { goto I2bJe; } goto X84Iq; K9ELj: $nzO1V = $Y_UlP[$SkyUK]; goto NdKun; JQxx3: if (!(!is_wp_error($PVTqc) && isset($nzO1V['status']) && 'valid' === $nzO1V['status'])) { goto RF4BT; } goto wGWHo; gHi_P: N5zRf: goto vtfqg; vtfqg: I2bJe: goto tsGu_; qz7u0: $UjVaE = TRUE; goto K9ELj; dXKv5: $DTO_A['status'] = $z5nfa->EVmy2; goto ynaVc; B1W3l: if (!(empty($nzO1V['extended']) && (!isset($z5nfa->Dr3pt) || TRUE !== $z5nfa->Dr3pt))) { goto R1lTI; } goto cnbxy; tsGu_: R8WWV: goto K9Qd7; cnbxy: $DTO_A['extended'] = TRUE; goto mMjW6; OrTju: if (!(empty($nzO1V['trial']) && isset($z5nfa->FlIWf) && TRUE === $z5nfa->FlIWf)) { goto ZMFT8; } goto pfv0e; gPE6_: if (empty(array_diff_assoc($nzO1V, $DTO_A))) { goto H4IXp; } goto wY0jU; ynaVc: OrOzy: goto Cli1B; l7QDw: $DTO_A['expires'] = $z5nfa->YQBsc ?? date_i18n('Y-m-d H:i:s'); goto yLLOZ; K9Qd7: } goto NBVwZ; madVS: $UjVaE = FALSE; goto OCnod; GuyKz: return; goto J6dWH; GGpMQ: Addons::set_last_api_access('check_addons'); goto Mp8L4; NBVwZ: eRNLh: goto zGsNt; zGsNt: if (!$UjVaE) { goto BrRKd; } goto GGpMQ; Mp8L4: BrRKd: goto Ux_57; TM_8H: $Y_UlP = Addons::get_keys(); goto sZrqU; CKwrT: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto cEqm2; } goto GuyKz; Ux_57: }); } private function show_notices($kOpWq, $PF0AA) { AtumAdminNotices::add_notice($PF0AA, strtolower($kOpWq['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $kOpWq['basename'], function ($Hyz7g, $LWydM) use($PF0AA) { goto G2Q_J; Y0MuL: ?>"] th, tr[data-plugin="<?php  goto I8kzP; yeROW: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto H9JD4; Zeab4: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto zYx33; zwzqX: echo $PF0AA; goto Zeab4; I8kzP: echo esc_attr($Hyz7g); goto yeROW; zYx33: echo esc_attr($Hyz7g); goto Y0MuL; G2Q_J: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto zwzqX; H9JD4: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$HpY5J; } public static function get_non_bootstrapped_addons() { return self::$A0q7w; } public static function check_addon($Kya3D, $khM0D, $LfWbu) { goto w7RBf; W3Ilv: if (!(stripos($LfWbu, '-trial.php') === FALSE)) { goto Dgeqk; } goto WlHBS; WlHBS: return FALSE; goto KTBHP; YoTwf: y_ykk: goto jJuOp; KRBA_: xw_zm: goto W3Ilv; Hu82B: return TRUE; goto uGXTH; uoCIQ: return FALSE; goto KRBA_; w7RBf: if (!(stripos($Kya3D, '_trial') === FALSE)) { goto y_ykk; } goto VmVsX; KTBHP: Dgeqk: goto Hu82B; jJuOp: if (!(stripos($khM0D, 'Trial') === FALSE)) { goto xw_zm; } goto uoCIQ; VmVsX: return FALSE; goto YoTwf; uGXTH: } }