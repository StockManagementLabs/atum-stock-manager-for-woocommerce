<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2024 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $XIiFs = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private $L5q9T = array('action_logs' => '1.3.8', 'export_pro' => '1.5.8', 'multi_inventory' => '1.8.7', 'product_levels' => '1.9.3', 'purchase_orders' => '1.2.1', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private static $Obutw = []; private static $kbQzn = []; private $ShL2e; public function __construct() { goto bQusJ; gnXy4: $this->check_addons(); goto ogLfz; qmLMZ: foreach ($jKAJO as $KIblC => $Dg9Ho) { goto yPdpq; yPdpq: if (!(!array_key_exists($KIblC, $this->L5q9T) && version_compare($Dg9Ho, '0.0', '>'))) { goto jYLwo; } goto cwgaO; RLf3e: nd9L2: goto gmgpy; cwgaO: $this->L5q9T[$KIblC] = $Dg9Ho; goto v1ZKQ; v1ZKQ: jYLwo: goto RLf3e; gmgpy: } goto OzeMF; bQusJ: $this->ShL2e = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto DFgAK; OzeMF: M26_d: goto I745K; DFgAK: $jKAJO = (array) apply_filters('atum/addons/loader/extra_addons', []); goto MRwOH; vMmvm: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto gnXy4; I745K: QE1Q8: goto vMmvm; MRwOH: if (empty($jKAJO)) { goto QE1Q8; } goto qmLMZ; ogLfz: } public function load_addons() { goto nGTZM; O9mfJ: if (empty($CN90x)) { goto o03wL; } goto RD01a; ciPb1: C38oI: goto DaPV9; Uc1aZ: if (!(count(self::$kbQzn) > 0)) { goto C38oI; } goto y9mNW; knsS3: $lwmpg->set_js_dependencies(['atum-trials-modal']); goto ZvVO1; r2JRb: $SkjLw = Addons::get_addons_paths(); goto csCO1; cm0or: o03wL: goto Uc1aZ; ZvVO1: $lwmpg->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($CN90x), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $CN90x])); goto cm0or; RD01a: add_action('admin_enqueue_scripts', function () { goto MNQzD; MNQzD: Helpers::register_swal_scripts(); goto vnqlb; vnqlb: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto foP1P; foP1P: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto zTfYi; zTfYi: }, 1); goto Hzdsg; CXkcJ: QR0tz: goto O9mfJ; Hzdsg: $lwmpg = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto knsS3; M6MF0: $VPG04 = Addons::get_keys(); goto r2JRb; csCO1: foreach ($g8u_k as $dsP4i => $dzxtO) { goto C6Mck; csTmG: self::$kbQzn[] = $dsP4i; goto ACbsb; GW6kn: QooYG: goto M06Cb; IMfdA: $this->show_notices($dzxtO, $xTOa1); goto EjeM5; wHZ0n: mtltq: goto KeHfv; J7TV5: $xTOa1 = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $dzxtO['name']); goto CkZZQ; rVEph: $djoUJ = array('key' => $VPG04[$phaX9]['key'], 'url' => home_url()); goto bO7Ej; iKRVU: Fn02W: goto lM66k; bJBeF: self::$kbQzn[] = $dsP4i; goto z2PLD; YMgx4: jROzA: goto rEjCH; EjeM5: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto h5n5X; Fiam2: $CN90x[$dsP4i]['expires'] = $VPG04[$phaX9]['expires'] ?? 'now'; goto haSjQ; KxNQ4: goto ndOlp; goto id68d; piNGl: if (!version_compare($this->L5q9T[$LZrPC], $dzxtO['version'], '>')) { goto mtltq; } goto d2SGu; BTf0A: if (!(!$v1AtH && !empty($this->XIiFs[$dsP4i]) && version_compare($this->XIiFs[$dsP4i], $dzxtO['version'], '<'))) { goto Fn02W; } goto CZJho; SFhJC: self::$kbQzn[] = $dsP4i; goto D_Mrs; o4HqH: $xTOa1 = sprintf('trial_used' === $VPG04[$phaX9]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $dzxtO['name'], '<a href="' . $nn2Mc . '" target="_blank">', '</a>'); goto tkTTz; h5n5X: self::$kbQzn[] = $dsP4i; goto dk5o1; THodq: $this->show_notices($dzxtO, $xTOa1); goto rG21F; ucnM2: if (!(isset($g8u_k[$LZrPC]) || !$this->ShL2e && !empty($SkjLw[$LZrPC]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $SkjLw[$LZrPC]['basename']))) { goto UmQ2S; } goto J7TV5; TRFWd: self::$Obutw[] = $dsP4i; goto yIHA6; OEKiK: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto bJBeF; TufXS: $xTOa1 = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $dzxtO['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto THodq; calK0: goto rYEqr; goto OF4WC; bSPZx: $this->show_notices($dzxtO, $xTOa1 . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $dzxtO['addon_url'] . '" target="_blank">', '</a>')); goto u2xdA; dP4a8: ndOlp: goto LXRFm; FTeeK: $xTOa1 = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $dzxtO['name'], date_i18n(get_option('date_format'), strtotime($VPG04[$phaX9]['expires']))); goto calK0; KeHfv: if (!$c32P3) { goto Q1G5w; } goto ucnM2; pz2Tt: array_pop(self::$Obutw); goto inPB3; z2PLD: Addons::delete_status_transient($phaX9); goto ICyvw; u2xdA: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto qz38V; wj7yW: $LZrPC = $c32P3 ? str_replace('_trial', '', $dsP4i) : $dsP4i; goto CA7tx; SOQhd: goto ndOlp; goto zJF7c; ICyvw: goto ndOlp; goto YMgx4; UF4Vf: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto s_Gr5; haSjQ: $CN90x[$dsP4i]['key'] = $VPG04[$phaX9]['key']; goto J0yrC; XtIdI: if (!(empty($VPG04) || empty($VPG04[$phaX9]) || empty($VPG04[$phaX9]['key']))) { goto QooYG; } goto TufXS; uf2iY: $this->show_notices($dzxtO, $xTOa1); goto UF4Vf; qz38V: self::$kbQzn[] = $dsP4i; goto SOQhd; rEjCH: if (!(empty($VPG04[$phaX9]['expires']) || strtotime($VPG04[$phaX9]['expires']) <= time())) { goto YAfFm; } goto KCMN4; D_Mrs: Addons::delete_status_transient($phaX9); goto UgwrV; inPB3: self::$kbQzn[] = $dsP4i; goto iKRVU; CA7tx: $phaX9 = strtolower($SkjLw[$LZrPC]['name'] ?? ''); goto VX9Jy; wh7dY: $xTOa1 = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $dzxtO['name']); goto ZJjfA; ZJjfA: rYEqr: goto bSPZx; kJOT9: goto ndOlp; goto GW6kn; zJF7c: YAfFm: goto YNh9Q; tkTTz: $this->show_notices($dzxtO, $xTOa1); goto OEKiK; CZJho: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto pz2Tt; fiOhR: $xTOa1 = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $dzxtO['name']); goto uf2iY; UgwrV: goto ndOlp; goto bZUNe; C6Mck: $c32P3 = str_contains($dsP4i, '_trial') || str_contains($dzxtO['basename'], 'trial'); goto wj7yW; VX9Jy: if (isset($this->L5q9T[$LZrPC])) { goto U0boS; } goto fiOhR; KCMN4: $CN90x[$dsP4i] = $dzxtO; goto Fiam2; v_n7V: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto SFhJC; CkZZQ: $this->show_notices($dzxtO, $xTOa1); goto v_n7V; rG21F: $g8u_k[$dsP4i]['bootstrap'] = NULL; goto csTmG; lM66k: pCvIM: goto dP4a8; bZUNe: UmQ2S: goto XtIdI; bO7Ej: $nn2Mc = add_query_arg($djoUJ, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto o4HqH; yIHA6: $v1AtH = call_user_func($dzxtO['bootstrap']); goto BTf0A; M06Cb: if (!in_array($VPG04[$phaX9]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto jROzA; } goto rVEph; s_Gr5: self::$kbQzn[] = $dsP4i; goto KxNQ4; OF4WC: oesE5: goto wh7dY; dk5o1: goto ndOlp; goto wHZ0n; bkyeb: if ('now' === $CN90x[$dsP4i]['expires']) { goto oesE5; } goto FTeeK; gBEY7: if (!(!empty($dzxtO['bootstrap']) && is_callable($dzxtO['bootstrap']))) { goto pCvIM; } goto TRFWd; d2SGu: $xTOa1 = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $dzxtO['name'], $this->L5q9T[$LZrPC]); goto IMfdA; ACbsb: Addons::delete_status_transient($phaX9); goto kJOT9; YNh9Q: Q1G5w: goto gBEY7; J0yrC: $CN90x[$dsP4i]['extended'] = $VPG04[$phaX9]['extended'] ?? FALSE; goto bkyeb; id68d: U0boS: goto piNGl; LXRFm: } goto CXkcJ; EJ54t: if (empty($g8u_k)) { goto dSSbZ; } goto jdSHN; jdSHN: $CN90x = []; goto M6MF0; y9mNW: Addons::set_installed_addons($g8u_k); goto ciPb1; DaPV9: dSSbZ: goto zQuHo; nGTZM: $g8u_k = Addons::get_installed_addons(); goto EJ54t; zQuHo: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($abq4A) { $abq4A['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $abq4A; }); add_action('atum/check_addons', function () { goto dJQre; ASra4: NY_E6: goto ShZY_; m8tTp: jfwJ5: goto OexdP; fX4dO: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto s4Xfy; } goto LHctN; ShZY_: if (!$IyJHu) { goto jfwJ5; } goto oiyId; LHctN: return; goto k3tf_; R0_JW: foreach ($QzGv2 as $t1su4) { goto FjknX; BQ_5E: $OvI40['status'] = $INTuE->AEQGL; goto R4tDb; wa0r2: sZQDQ: goto Qoaaq; kj4e3: $OvI40['trial'] = TRUE; goto TmtEi; eLX8N: $FTyxF = $AESa2[$phaX9]; goto TrW7g; W0L1L: if (!(empty($FTyxF['extended']) && (!isset($INTuE->QRze4) || TRUE !== $INTuE->QRze4))) { goto mscbE; } goto kPTqd; FjknX: $BtbUJ = strtolower($t1su4['name']); goto M_1bU; ymHLL: if (!(empty($FTyxF['expires']) || $FTyxF['expires'] !== $INTuE->PKeWu)) { goto uVhw6; } goto K3ilt; bsJRo: CyMiY: goto z1Tsf; TmtEi: RliQf: goto W0L1L; Fxik0: LUzvF: goto wa0r2; glOT4: if (!$INTuE) { goto w0tIo; } goto wOJpM; eez0l: if (!(empty($FTyxF['trial']) && isset($INTuE->lmOoz) && TRUE === $INTuE->lmOoz)) { goto RliQf; } goto kj4e3; kxm_G: if (!(!is_wp_error($yK_Yw) && isset($FTyxF['status']) && 'valid' === $FTyxF['status'])) { goto LUzvF; } goto ZKnSi; R4tDb: Gj93S: goto ymHLL; BG_75: $IyJHu = TRUE; goto eLX8N; LVwn7: $phaX9 = trim(str_replace('trial', '', $BtbUJ)); goto nhuxW; kPTqd: $OvI40['extended'] = TRUE; goto N40np; LsAb2: Zlj0E: goto xjrK4; Qoaaq: cRw9y: goto bsJRo; vHIy3: if (empty(array_diff_assoc($FTyxF, $OvI40))) { goto Zlj0E; } goto Pco7G; Pco7G: Addons::update_key($BtbUJ, $OvI40); goto LsAb2; wOJpM: if (!($FTyxF['status'] !== $INTuE->AEQGL)) { goto Gj93S; } goto BQ_5E; K3ilt: $OvI40['expires'] = $INTuE->PKeWu ?? date_i18n('Y-m-d H:i:s'); goto PnL66; nhuxW: if (!(is_array($AESa2) && array_key_exists($phaX9, $AESa2))) { goto sZQDQ; } goto BG_75; PnL66: uVhw6: goto eez0l; orw4j: $OvI40 = $FTyxF; goto glOT4; M_1bU: if (!str_contains($BtbUJ, 'trial')) { goto cRw9y; } goto LVwn7; TrW7g: $yK_Yw = Addons::check_license($BtbUJ, $FTyxF['key']); goto kxm_G; ZKnSi: $INTuE = json_decode(wp_remote_retrieve_body($yK_Yw)); goto orw4j; N40np: mscbE: goto vHIy3; xjrK4: w0tIo: goto Fxik0; z1Tsf: } goto ASra4; xOFSL: $QzGv2 = Addons::get_installed_addons(); goto fX4dO; oiyId: Addons::set_last_api_access('check_addons'); goto m8tTp; dJQre: $AESa2 = Addons::get_keys(); goto xOFSL; Xmdnv: $IyJHu = FALSE; goto R0_JW; k3tf_: s4Xfy: goto Xmdnv; OexdP: }); } private function show_notices($dzxtO, $xTOa1) { AtumAdminNotices::add_notice($xTOa1, strtolower($dzxtO['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $dzxtO['basename'], function ($V5Bq0, $LIrVG) use($xTOa1) { goto cETuq; kyVEu: echo esc_attr($V5Bq0); goto JR7GR; UCcSh: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto kyVEu; MW47u: echo $xTOa1; goto UCcSh; JR7GR: ?>"] th, tr[data-plugin="<?php  goto wHjlm; cETuq: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto MW47u; wHjlm: echo esc_attr($V5Bq0); goto PXt_Q; PXt_Q: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto eu0DY; eu0DY: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$Obutw; } public static function get_non_bootstrapped_addons() { return self::$kbQzn; } public static function check_addon($KIblC, $BtbUJ, $U7xcD) { goto rmPo3; kw290: return FALSE; goto cDLaG; rmPo3: if (!(stripos($KIblC, '_trial') === FALSE)) { goto Hx8E0; } goto mYPfe; mYPfe: return FALSE; goto oeqIO; cDLaG: UGTWR: goto z_wI_; PqWLW: return TRUE; goto HhuJw; oeqIO: Hx8E0: goto mlGYf; WuEf5: rH9er: goto PqWLW; vrF87: return FALSE; goto WuEf5; mlGYf: if (!(stripos($BtbUJ, 'Trial') === FALSE)) { goto UGTWR; } goto kw290; z_wI_: if (!(stripos($U7xcD, '-trial.php') === FALSE)) { goto rH9er; } goto vrF87; HhuJw: } }