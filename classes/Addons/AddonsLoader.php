<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $zZGPr = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1'); private static $tkHaN = []; private static $bUdXP = []; private $sCUO5; public function __construct() { goto LI6NH; LI6NH: $this->sCUO5 = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto bSOZP; bSOZP: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto lXJvY; lXJvY: $this->check_trials(); goto E29_v; E29_v: } public function load_addons() { goto rvksC; esYtK: $xVc4c = []; goto rRFQD; Yw4b6: zmfqk: goto HCy53; rvksC: $r8zD2 = Addons::get_installed_addons(); goto b_r0c; SyzwK: sjkHH: goto GuJi0; F33tV: $peym7 = Addons::get_addons_paths(); goto N3clj; Lld2a: UAYdC: goto eUCmQ; GuJi0: if (!(count(self::$bUdXP) > 0)) { goto IEldz; } goto up_rx; up_rx: Addons::set_installed_addons($r8zD2); goto eTxYW; N3clj: foreach ($r8zD2 as $Rf0cV => $BS_IA) { goto RDn7P; c9nYV: QSAYS: goto L_J6u; b1J7v: $P_CRv = strtolower($peym7[$UmGNz]['name']); goto QTVem; CKHj5: CKY9R: goto pFPH0; il9GB: if (!(!$UKFgN && !empty($this->zZGPr[$Rf0cV]) && version_compare($this->zZGPr[$Rf0cV], $BS_IA['version'], '<'))) { goto bGWeZ; } goto j9jsp; Uju2i: self::$bUdXP[] = $Rf0cV; goto cFHVK; cFHVK: goto TYlT1; goto CKHj5; rPDVj: array_pop(self::$tkHaN); goto wOsHb; awGH7: $xVc4c[$Rf0cV]['expires'] = $VZg2s[$P_CRv]['expires'] ?? 'now'; goto E1cBg; L_J6u: XMRzR: goto ce_bv; XhdRc: $UKFgN = call_user_func($BS_IA['bootstrap']); goto il9GB; wTGny: $UmGNz = str_replace('_trial', '', $Rf0cV); goto b1J7v; XKsaN: $r8zD2[$Rf0cV]['bootstrap'] = NULL; goto XzjoV; LPRsn: self::$tkHaN[] = $Rf0cV; goto XhdRc; XvO7T: JYZ9t: goto w9ynX; BJ9Uq: j1pw5: goto g8cIc; QYUTE: $xVc4c[$Rf0cV] = $BS_IA; goto awGH7; XzjoV: self::$bUdXP[] = $Rf0cV; goto yz8w6; sxDVO: goto TYlT1; goto GhYZk; imY_K: bGWeZ: goto MQWPV; mPG8n: if (!$NR35b) { goto XMRzR; } goto wTGny; pFPH0: if (!(empty($VZg2s) || empty($VZg2s[$P_CRv]) || empty($VZg2s[$P_CRv]['key']))) { goto iuTbZ; } goto pTKOh; CegAP: $xVc4c[$Rf0cV]['extended'] = $VZg2s[$P_CRv]['extended'] ?? FALSE; goto GKrJY; ce_bv: if (!(!empty($BS_IA['bootstrap']) && is_callable($BS_IA['bootstrap']))) { goto uXw13; } goto LPRsn; E1cBg: $xVc4c[$Rf0cV]['key'] = $VZg2s[$P_CRv]['key']; goto CegAP; EZylO: TYlT1: goto Fx8GV; j9jsp: $r8zD2[$Rf0cV]['bootstrap'] = NULL; goto rPDVj; wOsHb: self::$bUdXP[] = $Rf0cV; goto imY_K; g8cIc: AtumAdminNotices::add_notice($WkBhH . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $BS_IA['addon_url'] . '" target="_blank">', '</a>'), strtolower($BS_IA['name']), 'error', FALSE, TRUE); goto XKsaN; luVui: $WkBhH = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $BS_IA['name'], date_i18n(get_option('date_format'), strtotime($VZg2s[$P_CRv]['expires']))); goto Ow6Dx; sbHVQ: $r8zD2[$Rf0cV]['bootstrap'] = NULL; goto DGiPO; pTKOh: $WkBhH = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $BS_IA['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto PkUpH; MQWPV: uXw13: goto EZylO; ke2_E: AtumAdminNotices::add_notice($WkBhH, strtolower($BS_IA['name']), 'error', FALSE, TRUE); goto qs65z; w9ynX: $WkBhH = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $BS_IA['name']); goto BJ9Uq; PkUpH: AtumAdminNotices::add_notice($WkBhH, strtolower($BS_IA['name']), 'error', FALSE, TRUE); goto sbHVQ; Ow6Dx: goto j1pw5; goto XvO7T; qs65z: $r8zD2[$Rf0cV]['bootstrap'] = NULL; goto Uju2i; DGiPO: self::$bUdXP[] = $Rf0cV; goto sxDVO; RDn7P: $NR35b = strpos($Rf0cV, '_trial') !== FALSE || strpos($BS_IA['basename'], 'trial') !== FALSE; goto mPG8n; CkODR: if (!(empty($VZg2s[$P_CRv]['expires']) || strtotime($VZg2s[$P_CRv]['expires']) <= time())) { goto QSAYS; } goto QYUTE; zczqg: $WkBhH = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $BS_IA['name']); goto ke2_E; GhYZk: iuTbZ: goto CkODR; yz8w6: goto TYlT1; goto c9nYV; QTVem: if (!(isset($r8zD2[$UmGNz]) || !$this->sCUO5 && !empty($peym7[$UmGNz]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $peym7[$UmGNz]['basename']))) { goto CKY9R; } goto zczqg; GKrJY: if ('now' === $xVc4c[$Rf0cV]['expires']) { goto JYZ9t; } goto luVui; Fx8GV: } goto Lld2a; srXTc: $rbKF3->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($xVc4c), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', compact('expired_trials'))); goto SyzwK; b_r0c: if (empty($r8zD2)) { goto zmfqk; } goto esYtK; yt5qN: $rbKF3 = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto srXTc; eUCmQ: if (empty($xVc4c)) { goto sjkHH; } goto yt5qN; eTxYW: IEldz: goto Yw4b6; rRFQD: $VZg2s = Addons::get_keys(); goto F33tV; HCy53: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($Aq3_n) { $Aq3_n['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $Aq3_n; }); add_action('atum/check_trials', function () { goto ROtC5; e4B5r: foreach ($GoI7S as $PUQTm => $RwL_Z) { goto Z1jd4; hKXq1: if (empty($Dj44G)) { goto yFMHW; } goto aDPP3; Z1jd4: if (!(!empty($RwL_Z['trial']) && TRUE === $RwL_Z['trial'])) { goto bh1Bj; } goto ejPvZ; DsEMv: $Dj44G['expires'] = $ocof7->ZXqHs; goto le4J1; rLoAU: $Dj44G['status'] = $ocof7->vPN59; goto VtoJH; VtoJH: fwY_4: goto XPeT9; qPPr7: if (!$ocof7) { goto wT0V5; } goto cnw_A; a_0tg: $Dj44G = []; goto qPPr7; Ov1xk: SaUH2: goto P2EsD; NxI0w: yFMHW: goto TBWHL; le4J1: qF7xX: goto ddPDb; ddPDb: if (!(empty($RwL_Z['extended']) && (!isset($ocof7->NlcoI) || TRUE !== $ocof7->NlcoI))) { goto SaUH2; } goto SdLaY; Zg_EB: nbIk2: goto hGZwz; aDPP3: $Dj44G['key'] = $RwL_Z['key']; goto K9IlJ; SdLaY: $Dj44G['extended'] = TRUE; goto Ov1xk; TBWHL: AF4eK: goto oHdI5; cnw_A: if (!($RwL_Z['status'] !== $ocof7->vPN59)) { goto fwY_4; } goto rLoAU; IcrYu: if (!(!is_wp_error($cL5P3) && isset($RwL_Z['status']) && 'valid' === $RwL_Z['status'])) { goto AF4eK; } goto tOiru; oHdI5: bh1Bj: goto Zg_EB; tOiru: $ocof7 = json_decode(wp_remote_retrieve_body($cL5P3)); goto a_0tg; ejPvZ: $cL5P3 = Addons::check_license($PUQTm, $RwL_Z['key']); goto IcrYu; K9IlJ: Addons::update_key($PUQTm, $Dj44G); goto NxI0w; XPeT9: if (!(empty($RwL_Z['expires']) || $RwL_Z['expires'] !== $ocof7->ZXqHs)) { goto qF7xX; } goto DsEMv; P2EsD: wT0V5: goto hKXq1; hGZwz: } goto dOn94; dOn94: DuYOQ: goto GOFv1; ROtC5: $GoI7S = Addons::get_keys(); goto e4B5r; GOFv1: }); } public static function get_bootstrapped_addons() { return self::$tkHaN; } public static function get_non_bootstrapped_addons() { return self::$bUdXP; } }