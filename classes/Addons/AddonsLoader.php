<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $X0jnO = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $KXoS5 = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.2', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $K0gQt = []; private static $EM6jr = []; private $t8S8Y; public function __construct() { goto F7qNH; F7qNH: $this->t8S8Y = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto r0bfy; lWDND: j4Y3O: goto v0GSz; kf9ct: if (empty($W9RYJ)) { goto j4Y3O; } goto zR_Ao; zR_Ao: foreach ($W9RYJ as $PaarN => $gb5yJ) { goto pEy4B; pEy4B: if (!(!array_key_exists($PaarN, $this->KXoS5) && version_compare($gb5yJ, '0.0', '>'))) { goto mITH8; } goto QpXOz; O6YUo: mITH8: goto bBuZs; bBuZs: U2uh_: goto lXxVO; QpXOz: $this->KXoS5[$PaarN] = $gb5yJ; goto O6YUo; lXxVO: } goto RaCwF; v0GSz: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto WzFSt; WzFSt: $this->check_addons(); goto avdr0; RaCwF: iBtH3: goto lWDND; r0bfy: $W9RYJ = (array) apply_filters('atum/addons/loader/extra_addons', []); goto kf9ct; avdr0: } public function load_addons() { goto whwPP; KXIH2: $MmhlI->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($x10VS), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $x10VS])); goto lDhtM; vpIib: $MmhlI->set_js_dependencies(['atum-trials-modal']); goto KXIH2; auKmi: if (empty($R14ic)) { goto CGji0; } goto VpIQc; ipNEX: CGji0: goto deC20; whwPP: $R14ic = Addons::get_installed_addons(); goto auKmi; o06oZ: yOTzd: goto vnCua; T1CKP: $qQ1v2 = Addons::get_addons_paths(); goto s2_zY; pGes4: $FYXvj = Addons::get_keys(); goto T1CKP; lDhtM: Xlsc2: goto EQIk9; GxPbv: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto I275L; EQIk9: if (!(count(self::$EM6jr) > 0)) { goto zY4qr; } goto X23fc; VpIQc: $x10VS = []; goto pGes4; vnCua: if (empty($x10VS)) { goto Xlsc2; } goto TE5mF; s2_zY: foreach ($R14ic as $MQ3H_ => $t188y) { goto ijX85; yYFWu: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto PYW3g; n0Pj_: oePfj: goto JVMNn; l4fsQ: Addons::delete_status_transient($Hku64); goto RAph2; oh9Dr: $x10VS[$MQ3H_]['expires'] = $FYXvj[$Hku64]['expires'] ?? 'now'; goto llUyO; gKPBv: $this->show_notices($t188y, $Xu2hX); goto d2nRT; XB6xY: mdFo7: goto GO5bK; d2nRT: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto Jvokh; AfX8W: HbUEy: goto krYKb; YJi1w: OzgZa: goto Q3VTs; Q3VTs: if (!(!empty($t188y['bootstrap']) && is_callable($t188y['bootstrap']))) { goto mdFo7; } goto xQFAf; edyBA: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto QbL6R; O67Yk: $x10VS[$MQ3H_] = $t188y; goto oh9Dr; wTWCm: if (!in_array($FYXvj[$Hku64]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto MU5jE; } goto uXOry; eE5oi: goto rU3NC; goto y5Mh8; Rz_nd: $jRKXP = add_query_arg($BhTy9, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto lhY0P; SoS4G: YUHQ5: goto XB6xY; mwyfJ: m4xLw: goto wTWCm; n4m_H: goto rU3NC; goto mwyfJ; p3ENd: if (!(isset($R14ic[$kEtHa]) || !$this->t8S8Y && !empty($qQ1v2[$kEtHa]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $qQ1v2[$kEtHa]['basename']))) { goto HbUEy; } goto Bd3Ro; zHplr: MU5jE: goto aSekF; GjRxY: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto UJfHA; P1Jbm: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto W2mgV; xY2fV: goto WrsS7; goto n0Pj_; W2mgV: self::$EM6jr[] = $MQ3H_; goto eE5oi; uXOry: $BhTy9 = array('key' => $FYXvj[$Hku64]['key'], 'url' => home_url()); goto Rz_nd; bgfrA: Addons::delete_status_transient($Hku64); goto n4m_H; y5Mh8: miA36: goto LL89M; nBDN2: $this->show_notices($t188y, $Xu2hX); goto UzjjR; ku2HC: $x10VS[$MQ3H_]['extended'] = $FYXvj[$Hku64]['extended'] ?? FALSE; goto aFH22; xQFAf: self::$K0gQt[] = $MQ3H_; goto vIcKJ; lhY0P: $Xu2hX = sprintf('trial_used' === $FYXvj[$Hku64]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $t188y['name'], '<a href="' . $jRKXP . '" target="_blank">', '</a>'); goto gKPBv; LL89M: if (!version_compare($this->KXoS5[$kEtHa], $t188y['version'], '>')) { goto pQ0t5; } goto Y49A0; aSekF: if (!(empty($FYXvj[$Hku64]['expires']) || strtotime($FYXvj[$Hku64]['expires']) <= time())) { goto uV_mB; } goto O67Yk; x_JC6: $Xu2hX = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $t188y['name']); goto Ka494; UzjjR: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto RaKO8; p2t6x: $this->show_notices($t188y, $Xu2hX . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $t188y['addon_url'] . '" target="_blank">', '</a>')); goto edyBA; Cm1r7: $Xu2hX = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $t188y['name'], date_i18n(get_option('date_format'), strtotime($FYXvj[$Hku64]['expires']))); goto xY2fV; ijX85: $r3eKF = strpos($MQ3H_, '_trial') !== FALSE || strpos($t188y['basename'], 'trial') !== FALSE; goto TShjE; uc1Lm: $Xu2hX = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $t188y['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto N8JVs; kiwBW: $this->show_notices($t188y, $Xu2hX); goto yYFWu; QbL6R: self::$EM6jr[] = $MQ3H_; goto C2gI7; qlpmw: $R14ic[$MQ3H_]['bootstrap'] = NULL; goto dqWUe; Y49A0: $Xu2hX = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $t188y['name'], $this->KXoS5[$kEtHa]); goto nBDN2; N8JVs: $this->show_notices($t188y, $Xu2hX); goto GjRxY; l7Ia7: WrsS7: goto p2t6x; krYKb: if (!(empty($FYXvj) || empty($FYXvj[$Hku64]) || empty($FYXvj[$Hku64]['key']))) { goto m4xLw; } goto uc1Lm; JEikN: goto rU3NC; goto AfX8W; L9w8m: goto rU3NC; goto JMSkp; dRE9D: uV_mB: goto YJi1w; PYW3g: self::$EM6jr[] = $MQ3H_; goto dCmDx; GO5bK: rU3NC: goto Zp2Xm; Ka494: $this->show_notices($t188y, $Xu2hX); goto P1Jbm; abixJ: self::$EM6jr[] = $MQ3H_; goto SoS4G; RAph2: goto rU3NC; goto zHplr; C2gI7: goto rU3NC; goto dRE9D; iiR7W: if (isset($this->KXoS5[$kEtHa])) { goto miA36; } goto x_JC6; llUyO: $x10VS[$MQ3H_]['key'] = $FYXvj[$Hku64]['key']; goto ku2HC; Jvokh: self::$EM6jr[] = $MQ3H_; goto l4fsQ; Bd3Ro: $Xu2hX = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $t188y['name']); goto kiwBW; GR3nj: $Hku64 = strtolower($qQ1v2[$kEtHa]['name'] ?? ''); goto iiR7W; TShjE: $kEtHa = $r3eKF ? str_replace('_trial', '', $MQ3H_) : $MQ3H_; goto GR3nj; vIcKJ: $eX5hB = call_user_func($t188y['bootstrap']); goto JcbXI; dqWUe: array_pop(self::$K0gQt); goto abixJ; JMSkp: pQ0t5: goto Kauof; UJfHA: self::$EM6jr[] = $MQ3H_; goto bgfrA; aFH22: if ('now' === $x10VS[$MQ3H_]['expires']) { goto oePfj; } goto Cm1r7; RaKO8: self::$EM6jr[] = $MQ3H_; goto L9w8m; dCmDx: Addons::delete_status_transient($Hku64); goto JEikN; Kauof: if (!$r3eKF) { goto OzgZa; } goto p3ENd; JVMNn: $Xu2hX = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $t188y['name']); goto l7Ia7; JcbXI: if (!(!$eX5hB && !empty($this->X0jnO[$MQ3H_]) && version_compare($this->X0jnO[$MQ3H_], $t188y['version'], '<'))) { goto YUHQ5; } goto qlpmw; Zp2Xm: } goto o06oZ; X23fc: Addons::set_installed_addons($R14ic); goto KaKVv; TE5mF: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto GxPbv; I275L: $MmhlI = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto vpIib; KaKVv: zY4qr: goto ipNEX; deC20: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($ipnWy) { $ipnWy['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $ipnWy; }); add_action('atum/check_addons', function () { goto MKbjC; eQtIK: B5Vgh: goto cDUdQ; MKbjC: $RPp2R = Addons::get_keys(); goto abAjO; A302W: ZCKD8: goto JsyhY; jIQCF: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto B5Vgh; } goto FWV6Z; rtjk8: A_LrR: goto sl8jn; cDUdQ: $TX8lN = FALSE; goto seIX3; abAjO: $yskdr = Addons::get_installed_addons(); goto jIQCF; seIX3: foreach ($yskdr as $iTeIx) { goto frgPi; shtnv: xHBQU: goto lPrwq; lPrwq: esOth: goto Swdf_; Swdf_: b0ccm: goto rbv_4; MIJQB: if (!(empty($okJLE['expires']) || $okJLE['expires'] !== $JGUIK->hg7D8)) { goto vCMoC; } goto WP50V; ttrOD: $QzDCk = Addons::check_license($V2LqS, $okJLE['key']); goto YSD5q; YgiwC: $Hku64 = trim(str_replace('trial', '', $V2LqS)); goto UNKwQ; qK5_2: bB23h: goto QfLDp; tv2pM: $okJLE = $RPp2R[$Hku64]; goto ttrOD; t1WAN: $KO0dh['extended'] = TRUE; goto LxPHO; PtqcZ: $KO0dh['status'] = $JGUIK->lZMYS; goto c9_xG; frgPi: $V2LqS = strtolower($iTeIx['name']); goto IFry_; UNKwQ: if (!(is_array($RPp2R) && array_key_exists($Hku64, $RPp2R))) { goto xHBQU; } goto Xm4V1; b5eab: $KO0dh['trial'] = TRUE; goto TJs1S; LxPHO: CE0ki: goto oMpvp; Eo0JW: vCMoC: goto p6laJ; oMpvp: if (empty(array_diff_assoc($okJLE, $KO0dh))) { goto bB23h; } goto A05TB; p6laJ: if (!(empty($okJLE['trial']) && isset($JGUIK->grATS) && TRUE === $JGUIK->grATS)) { goto sazG6; } goto b5eab; A05TB: Addons::update_key($V2LqS, $KO0dh); goto qK5_2; TJs1S: sazG6: goto mc24S; WP50V: $KO0dh['expires'] = $JGUIK->hg7D8 ?? date_i18n('Y-m-d H:i:s'); goto Eo0JW; IFry_: if (!(strpos($V2LqS, 'trial') !== FALSE)) { goto esOth; } goto YgiwC; YSD5q: if (!(!is_wp_error($QzDCk) && isset($okJLE['status']) && 'valid' === $okJLE['status'])) { goto OHOi3; } goto vBaJO; mc24S: if (!(empty($okJLE['extended']) && (!isset($JGUIK->aJEWO) || TRUE !== $JGUIK->aJEWO))) { goto CE0ki; } goto t1WAN; cmKx2: OHOi3: goto shtnv; c9_xG: VFSK3: goto MIJQB; gkeqk: if (!$JGUIK) { goto s6Y97; } goto B71qT; IuPwN: $KO0dh = $okJLE; goto gkeqk; vBaJO: $JGUIK = json_decode(wp_remote_retrieve_body($QzDCk)); goto IuPwN; B71qT: if (!($okJLE['status'] !== $JGUIK->lZMYS)) { goto VFSK3; } goto PtqcZ; QfLDp: s6Y97: goto cmKx2; Xm4V1: $TX8lN = TRUE; goto tv2pM; rbv_4: } goto rtjk8; sl8jn: if (!$TX8lN) { goto ZCKD8; } goto BP_Vz; BP_Vz: Addons::set_last_api_access('check_addons'); goto A302W; FWV6Z: return; goto eQtIK; JsyhY: }); } private function show_notices($t188y, $Xu2hX) { AtumAdminNotices::add_notice($Xu2hX, strtolower($t188y['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $t188y['basename'], function ($dsUNI, $PHJ6H) use($Xu2hX) { goto xZ3aR; CaAuy: ?>"] th, tr[data-plugin="<?php  goto k2Nrn; xGTCT: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto ypBF2; oeIsR: echo esc_attr($dsUNI); goto CaAuy; OqGEW: echo $Xu2hX; goto oFcI1; k2Nrn: echo esc_attr($dsUNI); goto xGTCT; oFcI1: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto oeIsR; xZ3aR: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto OqGEW; ypBF2: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$K0gQt; } public static function get_non_bootstrapped_addons() { return self::$EM6jr; } public static function check_addon($PaarN, $V2LqS, $z8UEp) { goto yy7FT; HSXKi: return FALSE; goto bwGOk; r1Z1U: RE9XA: goto Wbq1w; bwGOk: FTF32: goto ppid6; yy7FT: if (!(stripos($PaarN, '_trial') === FALSE)) { goto IidJ9; } goto X6ffA; X8YnY: IidJ9: goto gT3nE; Wbq1w: return TRUE; goto iIdL8; X6ffA: return FALSE; goto X8YnY; ppid6: if (!(stripos($z8UEp, '-trial.php') === FALSE)) { goto RE9XA; } goto fXNXh; gT3nE: if (!(stripos($V2LqS, 'Trial') === FALSE)) { goto FTF32; } goto HSXKi; fXNXh: return FALSE; goto r1Z1U; iIdL8: } }