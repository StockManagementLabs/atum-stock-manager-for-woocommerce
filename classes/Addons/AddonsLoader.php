<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $fH2wS = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $ExrHm = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.1', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $OOYhR = []; private static $InYaK = []; private $ufJHp; public function __construct() { goto j0eqc; DoDns: D6iO5: goto XhhXY; TGs2C: if (empty($YYvrj)) { goto guok4; } goto ucz4P; XhhXY: guok4: goto SsuYO; Kso2Y: $this->check_addons(); goto pVMdf; SsuYO: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto Kso2Y; j0eqc: $this->ufJHp = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto NBVu5; ucz4P: foreach ($YYvrj as $xRbw5 => $HyHbK) { goto dJ4wU; NJJxk: $this->ExrHm[$xRbw5] = $HyHbK; goto SxoR8; SxoR8: xaC9M: goto Z3osK; Z3osK: Ckai2: goto V4uLN; dJ4wU: if (!(!array_key_exists($xRbw5, $this->ExrHm) && version_compare($HyHbK, '0.0', '>'))) { goto xaC9M; } goto NJJxk; V4uLN: } goto DoDns; NBVu5: $YYvrj = (array) apply_filters('atum/addons/loader/extra_addons', []); goto TGs2C; pVMdf: } public function load_addons() { goto rtHGo; R1rUr: $dia_c->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($VCNZs), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $VCNZs])); goto v_CTo; xqC5H: if (!(count(self::$InYaK) > 0)) { goto PNrSr; } goto QHjZd; h1C6h: PNrSr: goto ihiub; rtHGo: $KfgLY = Addons::get_installed_addons(); goto JJmQl; QYBSU: $dia_c = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto Wm7dW; QfTtY: if (empty($VCNZs)) { goto uZWEw; } goto sGCCr; ElCJy: $aTLq3 = Addons::get_addons_paths(); goto vMLzZ; sGCCr: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto chrtj; Wm7dW: $dia_c->set_js_dependencies(['atum-trials-modal']); goto R1rUr; JJmQl: if (empty($KfgLY)) { goto FZf3K; } goto AQNYJ; v_CTo: uZWEw: goto xqC5H; chrtj: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto QYBSU; CbN7J: $ulbva = Addons::get_keys(); goto ElCJy; QHjZd: Addons::set_installed_addons($KfgLY); goto h1C6h; AQNYJ: $VCNZs = []; goto CbN7J; o6MGo: yatgL: goto QfTtY; ihiub: FZf3K: goto cbB3i; vMLzZ: foreach ($KfgLY as $yUv3m => $WGGFb) { goto T1RSI; ZhbTD: if (!version_compare($this->ExrHm[$A1Z3q], $WGGFb['version'], '>')) { goto DV3Dk; } goto X2zUS; j3vYq: C5lVd: goto zrGsK; IZXPI: goto jnkSs; goto j3vYq; NUdZD: DV3Dk: goto ySWWn; aKMnz: $VCNZs[$yUv3m]['key'] = $ulbva[$ZS_mu]['key']; goto RoARm; n4Jwp: goto nkDNC; goto v0Psd; dHQoW: $this->show_notices($WGGFb, $ib88b . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $WGGFb['addon_url'] . '" target="_blank">', '</a>')); goto FdxCw; nrlM_: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto jmkni; GLVMA: xgrMm: goto ZhbTD; InARJ: self::$InYaK[] = $yUv3m; goto ljHxf; ZQ3rp: $this->show_notices($WGGFb, $ib88b); goto thTZ6; HOxot: if (!(isset($KfgLY[$A1Z3q]) || !$this->ufJHp && !empty($aTLq3[$A1Z3q]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $aTLq3[$A1Z3q]['basename']))) { goto Hh8Qv; } goto cIlcj; lxSQX: goto nkDNC; goto TsaON; deh10: self::$InYaK[] = $yUv3m; goto ANwhx; v0aca: $b2O7w = add_query_arg($i6r_V, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto j2mp3; T1A0y: $this->show_notices($WGGFb, $ib88b); goto lmXfQ; qpq71: $A1Z3q = $G8G_8 ? str_replace('_trial', '', $yUv3m) : $yUv3m; goto JUIwB; v0Psd: UthTn: goto QTLBf; N3Pbc: zPSMg: goto QdMfV; TpUYB: goto nkDNC; goto x7r18; HwzWV: self::$InYaK[] = $yUv3m; goto TpUYB; K2tJP: $this->show_notices($WGGFb, $ib88b); goto nrlM_; TsaON: FCbUc: goto ZadOs; m0uW6: if (!(empty($ulbva) || empty($ulbva[$ZS_mu]) || empty($ulbva[$ZS_mu]['key']))) { goto UthTn; } goto o63Je; nlHob: self::$OOYhR[] = $yUv3m; goto qy210; o63Je: $ib88b = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $WGGFb['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto ZQ3rp; Z2GHG: goto nkDNC; goto NUdZD; ZadOs: yQ0RT: goto bmmlp; hhGOZ: OX1Dd: goto OMCah; QdMfV: if (!(empty($ulbva[$ZS_mu]['expires']) || strtotime($ulbva[$ZS_mu]['expires']) <= time())) { goto FCbUc; } goto ZxHAx; bqvMl: jnkSs: goto dHQoW; TK0VW: $ZS_mu = strtolower($aTLq3[$A1Z3q]['name'] ?? ''); goto m0uW6; AWORi: array_pop(self::$OOYhR); goto utYku; FtWa4: self::$InYaK[] = $yUv3m; goto n4Jwp; Cp12A: nkDNC: goto Us3Ph; ljHxf: goto nkDNC; goto N3Pbc; RoARm: $VCNZs[$yUv3m]['extended'] = $ulbva[$ZS_mu]['extended'] ?? FALSE; goto bXG9S; T1RSI: $G8G_8 = strpos($yUv3m, '_trial') !== FALSE || strpos($WGGFb['basename'], 'trial') !== FALSE; goto qpq71; j2mp3: $ib88b = sprintf(__('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $WGGFb['name'], '<a href="' . $b2O7w . '" target="_blank">', '</a>'); goto S7Mtm; Lpkvy: $ib88b = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $WGGFb['name'], date_i18n(get_option('date_format'), strtotime($ulbva[$ZS_mu]['expires']))); goto IZXPI; utYku: self::$InYaK[] = $yUv3m; goto hhGOZ; x7r18: Hh8Qv: goto TK0VW; ZxHAx: $VCNZs[$yUv3m] = $WGGFb; goto IKhmD; qy210: $ARnqV = call_user_func($WGGFb['bootstrap']); goto lZIEQ; X2zUS: $ib88b = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $WGGFb['name'], $this->ExrHm[$A1Z3q]); goto K2tJP; lZIEQ: if (!(!$ARnqV && !empty($this->fH2wS[$yUv3m]) && version_compare($this->fH2wS[$yUv3m], $WGGFb['version'], '<'))) { goto OX1Dd; } goto BPc7y; JUIwB: if (isset($this->ExrHm[$A1Z3q])) { goto xgrMm; } goto viLIp; TmPvM: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto deh10; ANwhx: goto nkDNC; goto GLVMA; FdxCw: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto HDIPz; RYuiq: $this->show_notices($WGGFb, $ib88b); goto TmPvM; zrGsK: $ib88b = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $WGGFb['name']); goto bqvMl; yGuUn: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto InARJ; ySWWn: if (!$G8G_8) { goto yQ0RT; } goto HOxot; cIlcj: $ib88b = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $WGGFb['name']); goto T1A0y; HDIPz: self::$InYaK[] = $yUv3m; goto lxSQX; bmmlp: if (!(!empty($WGGFb['bootstrap']) && is_callable($WGGFb['bootstrap']))) { goto l0O9x; } goto nlHob; QTLBf: if (!('trial_used' === $ulbva[$ZS_mu]['status'])) { goto zPSMg; } goto Rc09u; thTZ6: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto FtWa4; S7Mtm: $this->show_notices($WGGFb, $ib88b); goto yGuUn; BPc7y: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto AWORi; viLIp: $ib88b = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $WGGFb['name']); goto RYuiq; Rc09u: $i6r_V = array('key' => $ulbva[$ZS_mu]['key'], 'url' => home_url()); goto v0aca; lmXfQ: $KfgLY[$yUv3m]['bootstrap'] = NULL; goto HwzWV; IKhmD: $VCNZs[$yUv3m]['expires'] = $ulbva[$ZS_mu]['expires'] ?? 'now'; goto aKMnz; jmkni: self::$InYaK[] = $yUv3m; goto Z2GHG; OMCah: l0O9x: goto Cp12A; bXG9S: if ('now' === $VCNZs[$yUv3m]['expires']) { goto C5lVd; } goto Lpkvy; Us3Ph: } goto o6MGo; cbB3i: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($wCuDl) { $wCuDl['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $wCuDl; }); add_action('atum/check_addons', function () { goto JYQGG; K6Ytq: foreach ($IdeOO as $kX2xw) { goto VtTQW; X_K8f: $ZS_mu = trim(str_replace('trial', '', $orMma)); goto zJ6k2; CX12z: qff0G: goto FGWgB; f4jTY: Y4mKz: goto AKU9D; cmwnK: $U9OcI['extended'] = TRUE; goto EJdtQ; ylth1: BpgcN: goto Tpp8z; yAa3g: if (!$y0tUM) { goto hqNHd; } goto sNNyt; k1ooD: $U9OcI = $zfJXb; goto yAa3g; Tpp8z: if (!(empty($zfJXb['trial']) && isset($y0tUM->UbAfa) && TRUE === $y0tUM->UbAfa)) { goto qoTJq; } goto hYRHJ; AKU9D: if (!(empty($zfJXb['expires']) || $zfJXb['expires'] !== $y0tUM->rQDbo)) { goto BpgcN; } goto ip_AT; lOk3J: Addons::update_key($orMma, $U9OcI); goto X7KKm; lo18T: if (!(!is_wp_error($EP3Qy) && isset($zfJXb['status']) && 'valid' === $zfJXb['status'])) { goto HhMIL; } goto oDKOc; mCrM9: if (empty(array_diff_assoc($zfJXb, $U9OcI))) { goto iL_UH; } goto lOk3J; hYRHJ: $U9OcI['trial'] = TRUE; goto cXBfG; KoNBB: if (!(strpos($orMma, 'trial') !== FALSE)) { goto qff0G; } goto X_K8f; oDKOc: $y0tUM = json_decode(wp_remote_retrieve_body($EP3Qy)); goto k1ooD; VtTQW: $orMma = strtolower($kX2xw['name']); goto KoNBB; mxh14: if (!(empty($zfJXb['extended']) && (!isset($y0tUM->k3SJ0) || TRUE !== $y0tUM->k3SJ0))) { goto SAzn0; } goto cmwnK; FGWgB: fWivg: goto urddC; zRVb0: mVVH8: goto CX12z; X7KKm: iL_UH: goto twXrS; cXBfG: qoTJq: goto mxh14; vPd9V: $T4Ynt = TRUE; goto eoxQ4; zJ6k2: if (!array_key_exists($uXR7b[$ZS_mu])) { goto mVVH8; } goto vPd9V; j1rkq: $U9OcI['status'] = $y0tUM->ZgW_S; goto f4jTY; EJdtQ: SAzn0: goto mCrM9; WvbM3: HhMIL: goto zRVb0; oqEtU: $EP3Qy = Addons::check_license($orMma, $zfJXb['key']); goto lo18T; ip_AT: $U9OcI['expires'] = $y0tUM->rQDbo ?? date_i18n('Y-m-d H:i:s'); goto ylth1; sNNyt: if (!($zfJXb['status'] !== $y0tUM->ZgW_S)) { goto Y4mKz; } goto j1rkq; eoxQ4: $zfJXb = $uXR7b[$ZS_mu]; goto oqEtU; twXrS: hqNHd: goto WvbM3; urddC: } goto lkaBi; JYQGG: $uXR7b = Addons::get_keys(); goto DpgX4; NngYv: pms82: goto nMhbE; lTkdb: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto pdGmO; } goto RqWMA; RqWMA: return; goto my_81; wXiHz: self::set_last_api_access('check_addons'); goto NngYv; WSpOt: $T4Ynt = FALSE; goto K6Ytq; qqOCD: if (!$T4Ynt) { goto pms82; } goto wXiHz; my_81: pdGmO: goto WSpOt; DpgX4: $IdeOO = Addons::get_installed_addons(); goto lTkdb; lkaBi: vzJpn: goto qqOCD; nMhbE: }); } private function show_notices($WGGFb, $ib88b) { AtumAdminNotices::add_notice($ib88b, strtolower($WGGFb['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $WGGFb['basename'], function ($j3JVu, $hGa0m) use($ib88b) { goto ed0Zl; gPDFA: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto zZjTr; MDjxa: echo $ib88b; goto gPDFA; ed0Zl: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto MDjxa; zZjTr: echo esc_attr($j3JVu); goto kdyr2; zO5kQ: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto Bt9Uf; fMIj6: echo esc_attr($j3JVu); goto zO5kQ; kdyr2: ?>"] th, tr[data-plugin="<?php  goto fMIj6; Bt9Uf: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$OOYhR; } public static function get_non_bootstrapped_addons() { return self::$InYaK; } public static function check_addon($xRbw5, $orMma, $BpyZZ) { goto It_DW; IdM2s: return FALSE; goto RNVCK; fhTtQ: RFGrw: goto KGkRy; XvqWl: I_TGz: goto Ldw62; W7KGL: return FALSE; goto XvqWl; gb9hv: if (!(stripos($orMma, 'Trial') === FALSE)) { goto I_TGz; } goto W7KGL; KGkRy: return TRUE; goto cNIRs; It_DW: if (!(stripos($xRbw5, '_trial') === FALSE)) { goto hRnHA; } goto IdM2s; RNVCK: hRnHA: goto gb9hv; Ldw62: if (!(stripos($BpyZZ, '-trial.php') === FALSE)) { goto RFGrw; } goto Pp5PM; Pp5PM: return FALSE; goto fhTtQ; cNIRs: } }