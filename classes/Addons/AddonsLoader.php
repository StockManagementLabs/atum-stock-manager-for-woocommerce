<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $W6SYH = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $NuOoM = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.1', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $yTzsS = []; private static $PKFYi = []; private $yyHYc; public function __construct() { goto jP025; qGIVt: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto WMwjZ; Hd80d: if (empty($pmPff)) { goto THeDI; } goto Gsn6E; p35Wb: THeDI: goto qGIVt; ftayt: $pmPff = (array) apply_filters('atum/addons/loader/extra_addons', []); goto Hd80d; Gsn6E: foreach ($pmPff as $XpA1E => $g0enE) { goto FuyzM; FuyzM: if (!(!array_key_exists($XpA1E, $this->NuOoM) && version_compare($g0enE, '0.0', '>'))) { goto eex25; } goto JO6kZ; ZOHhH: aiJTN: goto RYCBA; JO6kZ: $this->NuOoM[$XpA1E] = $g0enE; goto Tqju5; Tqju5: eex25: goto ZOHhH; RYCBA: } goto l1SXR; l1SXR: lxV0s: goto p35Wb; WMwjZ: $this->check_addons(); goto qi1zq; jP025: $this->yyHYc = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto ftayt; qi1zq: } public function load_addons() { goto Oxr6q; Oxr6q: $z21ps = Addons::get_installed_addons(); goto fUjnD; obywt: if (empty($XJDsb)) { goto RqTfT; } goto JkxF6; fUjnD: if (empty($z21ps)) { goto mUXSV; } goto sw8oS; HYiwL: $yt2LY = Addons::get_keys(); goto n77IV; i3z42: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto JYqx7; g5zEX: $wHRj0->set_js_dependencies(['atum-trials-modal']); goto SQk1c; qo4o6: Addons::set_installed_addons($z21ps); goto qEu9O; n77IV: $RFS2T = Addons::get_addons_paths(); goto JPSxt; qEu9O: MqVcZ: goto rZit7; JkxF6: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto i3z42; NXgaD: if (!(count(self::$PKFYi) > 0)) { goto MqVcZ; } goto qo4o6; JYqx7: $wHRj0 = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto g5zEX; rZit7: mUXSV: goto c45mq; JPSxt: foreach ($z21ps as $QV1tt => $qtN4v) { goto E56or; cEIr1: $J4uYS = strtolower($RFS2T[$Jhefe]['name'] ?? ''); goto PU6NR; pLkPN: $qN3gi = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $qtN4v['name'], $this->NuOoM[$Jhefe]); goto H3fph; PU6NR: if (!(empty($yt2LY) || empty($yt2LY[$J4uYS]) || empty($yt2LY[$J4uYS]['key']))) { goto Zo30H; } goto MOXbz; opTVK: $z21ps[$QV1tt]['bootstrap'] = NULL; goto ENBzt; MS4Iu: array_pop(self::$yTzsS); goto ufLR8; gtXQ2: $z21ps[$QV1tt]['bootstrap'] = NULL; goto Hvmlz; MiONN: $this->show_notices($qtN4v, $qN3gi); goto qJDEc; cnBeu: Qt5EZ: goto EyAeE; UqYHV: self::$PKFYi[] = $QV1tt; goto vuYxz; AUSJA: goto mxiAj; goto BjzXV; MOXbz: $qN3gi = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $qtN4v['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto Jo2On; pbliw: h853b: goto rhFyk; iKLF1: if (!version_compare($this->NuOoM[$Jhefe], $qtN4v['version'], '>')) { goto nWogs; } goto pLkPN; BjzXV: DYRAK: goto lRoKr; gR4NQ: $JITTd = call_user_func($qtN4v['bootstrap']); goto zD60w; EIrpS: YZqVw: goto VpCI1; c2KFw: $HwMld = add_query_arg($wAeSi, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto jblRQ; xhLGp: if (!(!empty($qtN4v['bootstrap']) && is_callable($qtN4v['bootstrap']))) { goto Qt5EZ; } goto F779l; RbLzB: $qN3gi = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $qtN4v['name']); goto MiONN; iHFHL: $this->show_notices($qtN4v, $qN3gi . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $qtN4v['addon_url'] . '" target="_blank">', '</a>')); goto opTVK; lMFBG: $XJDsb[$QV1tt]['expires'] = $yt2LY[$J4uYS]['expires'] ?? 'now'; goto K7qtE; jbT1X: $z21ps[$QV1tt]['bootstrap'] = NULL; goto MS4Iu; pU7lC: $XJDsb[$QV1tt]['extended'] = $yt2LY[$J4uYS]['extended'] ?? FALSE; goto vXYDW; Hvmlz: self::$PKFYi[] = $QV1tt; goto vmP13; ENBzt: self::$PKFYi[] = $QV1tt; goto NbnBl; rnT2j: nWogs: goto TFCG8; x8Yu2: $Jhefe = $MpsMs ? str_replace('_trial', '', $QV1tt) : $QV1tt; goto iIJ73; Gqs0H: $z21ps[$QV1tt]['bootstrap'] = NULL; goto yGIze; EyAeE: JOIBE: goto D3ckP; d0ANR: self::$PKFYi[] = $QV1tt; goto Q96bC; Q82YB: $XJDsb[$QV1tt] = $qtN4v; goto lMFBG; K7qtE: $XJDsb[$QV1tt]['key'] = $yt2LY[$J4uYS]['key']; goto pU7lC; Aw_GT: Zo30H: goto fMFm4; Wj_gC: goto JOIBE; goto ruZj1; TLpoL: self::$PKFYi[] = $QV1tt; goto Wj_gC; Q96bC: goto JOIBE; goto rnT2j; iIJ73: if (isset($this->NuOoM[$Jhefe])) { goto jCZ28; } goto JFFde; vmP13: goto JOIBE; goto dFSr3; JFFde: $qN3gi = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $qtN4v['name']); goto JPhHL; VeVcz: mxiAj: goto iHFHL; dDRhn: goto JOIBE; goto pbliw; yGIze: self::$PKFYi[] = $QV1tt; goto dDRhn; IrL4a: $z21ps[$QV1tt]['bootstrap'] = NULL; goto UqYHV; aRT89: $qN3gi = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $qtN4v['name'], date_i18n(get_option('date_format'), strtotime($yt2LY[$J4uYS]['expires']))); goto AUSJA; H3fph: $this->show_notices($qtN4v, $qN3gi); goto kN9DJ; kN9DJ: $z21ps[$QV1tt]['bootstrap'] = NULL; goto d0ANR; VpCI1: oP_U0: goto xhLGp; zD60w: if (!(!$JITTd && !empty($this->W6SYH[$QV1tt]) && version_compare($this->W6SYH[$QV1tt], $qtN4v['version'], '<'))) { goto Cb7bU; } goto jbT1X; F779l: self::$yTzsS[] = $QV1tt; goto gR4NQ; fMFm4: if (!('trial_used' === $yt2LY[$J4uYS]['status'])) { goto h853b; } goto o7b5G; jblRQ: $qN3gi = sprintf(__('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $qtN4v['name'], '<a href="' . $HwMld . '" target="_blank">', '</a>'); goto ZQhEz; vXYDW: if ('now' === $XJDsb[$QV1tt]['expires']) { goto DYRAK; } goto aRT89; Jo2On: $this->show_notices($qtN4v, $qN3gi); goto IrL4a; TFCG8: if (!$MpsMs) { goto oP_U0; } goto m8L91; ozfRE: Cb7bU: goto cnBeu; E56or: $MpsMs = strpos($QV1tt, '_trial') !== FALSE || strpos($qtN4v['basename'], 'trial') !== FALSE; goto x8Yu2; m8L91: if (!(isset($z21ps[$Jhefe]) || !$this->yyHYc && !empty($RFS2T[$Jhefe]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $RFS2T[$Jhefe]['basename']))) { goto GqR79; } goto RbLzB; lRoKr: $qN3gi = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $qtN4v['name']); goto VeVcz; ufLR8: self::$PKFYi[] = $QV1tt; goto ozfRE; JPhHL: $this->show_notices($qtN4v, $qN3gi); goto gtXQ2; o7b5G: $wAeSi = array('key' => $yt2LY[$J4uYS]['key'], 'url' => home_url()); goto c2KFw; qJDEc: $z21ps[$QV1tt]['bootstrap'] = NULL; goto TLpoL; dFSr3: jCZ28: goto iKLF1; NbnBl: goto JOIBE; goto EIrpS; vuYxz: goto JOIBE; goto Aw_GT; ZQhEz: $this->show_notices($qtN4v, $qN3gi); goto Gqs0H; ruZj1: GqR79: goto cEIr1; rhFyk: if (!(empty($yt2LY[$J4uYS]['expires']) || strtotime($yt2LY[$J4uYS]['expires']) <= time())) { goto YZqVw; } goto Q82YB; D3ckP: } goto r0_kZ; r0_kZ: YCKBz: goto obywt; oTNDm: RqTfT: goto NXgaD; sw8oS: $XJDsb = []; goto HYiwL; SQk1c: $wHRj0->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($XJDsb), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $XJDsb])); goto oTNDm; c45mq: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($fBt2t) { $fBt2t['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $fBt2t; }); add_action('atum/check_addons', function () { goto j3gV1; iMirF: BL9Bu: goto rUDZ8; zBlio: return; goto Eo000; UF5PG: foreach ($yiOUQ as $KnaNm) { goto q2Om8; Of_Q8: if (!(empty($EkY5u['trial']) && isset($uNJdq->n_m5l) && TRUE === $uNJdq->n_m5l)) { goto FgRVI; } goto tLzN1; ygUEB: Addons::update_key($bATxk, $TJsjg); goto u3_is; YHTE4: $TJsjg['extended'] = TRUE; goto RVVa1; bzpwB: if (!(empty($EkY5u['expires']) || $EkY5u['expires'] !== $uNJdq->eBMbh)) { goto f2qMX; } goto qDebw; uuB2i: if (!(strpos($bATxk, 'trial') !== FALSE)) { goto GizKb; } goto h2N1a; YlOEy: VjRfD: goto om3Hp; u3_is: sJ6J6: goto aqiZ_; lXQXx: if (!(empty($EkY5u['extended']) && (!isset($uNJdq->wxkrU) || TRUE !== $uNJdq->wxkrU))) { goto T1fOC; } goto YHTE4; RUYZX: if (!$uNJdq) { goto Bv22g; } goto AOnlR; O8YYP: $zl88q = Addons::check_license($bATxk, $EkY5u['key']); goto hwfGa; T4NKF: YoltV: goto Q7IzG; RCNed: Togom: goto bzpwB; Q7IzG: nKZwY: goto RIy3J; hY36w: FgRVI: goto lXQXx; B6apM: if (empty(array_diff_assoc($EkY5u, $TJsjg))) { goto sJ6J6; } goto ygUEB; VyH8c: f2qMX: goto Of_Q8; hwfGa: if (!(!is_wp_error($zl88q) && isset($EkY5u['status']) && 'valid' === $EkY5u['status'])) { goto YoltV; } goto Ns4yQ; Ns4yQ: $uNJdq = json_decode(wp_remote_retrieve_body($zl88q)); goto cRK62; AOnlR: if (!($EkY5u['status'] !== $uNJdq->UE10x)) { goto Togom; } goto Ob0MZ; aqiZ_: Bv22g: goto T4NKF; tLzN1: $TJsjg['trial'] = TRUE; goto hY36w; NKa6D: $fJ2VE = TRUE; goto cUOGh; Ob0MZ: $TJsjg['status'] = $uNJdq->UE10x; goto RCNed; L4J1X: if (!array_key_exists($f1trf[$J4uYS])) { goto nKZwY; } goto NKa6D; RVVa1: T1fOC: goto B6apM; qDebw: $TJsjg['expires'] = $uNJdq->eBMbh ?? date_i18n('Y-m-d H:i:s'); goto VyH8c; cRK62: $TJsjg = $EkY5u; goto RUYZX; h2N1a: $J4uYS = trim(str_replace('trial', '', $bATxk)); goto L4J1X; RIy3J: GizKb: goto YlOEy; q2Om8: $bATxk = strtolower($KnaNm['name']); goto uuB2i; cUOGh: $EkY5u = $f1trf[$J4uYS]; goto O8YYP; om3Hp: } goto kywdF; b3VOP: $yiOUQ = Addons::get_installed_addons(); goto AEhP9; j3gV1: $f1trf = Addons::get_keys(); goto b3VOP; f5IX6: if (!$fJ2VE) { goto BL9Bu; } goto f0380; kywdF: FGYZz: goto f5IX6; Eo000: ZajG4: goto Wpikt; Wpikt: $fJ2VE = FALSE; goto UF5PG; AEhP9: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto ZajG4; } goto zBlio; f0380: self::set_last_api_access('check_addons'); goto iMirF; rUDZ8: }); } private function show_notices($qtN4v, $qN3gi) { AtumAdminNotices::add_notice($qN3gi, strtolower($qtN4v['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $qtN4v['basename'], function ($Q32H1, $DTAby) use($qN3gi) { goto TeTXs; mn_mT: echo esc_attr($Q32H1); goto ePAL1; XFwYx: echo esc_attr($Q32H1); goto AEdtY; TeTXs: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto qDHdO; R6OrS: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto mn_mT; AEdtY: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto rTsbz; ePAL1: ?>"] th, tr[data-plugin="<?php  goto XFwYx; qDHdO: echo $qN3gi; goto R6OrS; rTsbz: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$yTzsS; } public static function get_non_bootstrapped_addons() { return self::$PKFYi; } public static function check_addon($XpA1E, $bATxk, $M2nTV) { goto G1dOU; LHNir: if (!(stripos($bATxk, 'Trial') === FALSE)) { goto BiMgS; } goto pyCi_; pyCi_: return FALSE; goto xqDi6; VNY_o: if (!(stripos($M2nTV, '-trial.php') === FALSE)) { goto su3Pu; } goto tulvM; Cxvfq: su3Pu: goto s4s2f; xqDi6: BiMgS: goto VNY_o; GgGRu: return FALSE; goto YChHB; s4s2f: return TRUE; goto KJwc2; G1dOU: if (!(stripos($XpA1E, '_trial') === FALSE)) { goto AIBNh; } goto GgGRu; tulvM: return FALSE; goto Cxvfq; YChHB: AIBNh: goto LHNir; KJwc2: } }