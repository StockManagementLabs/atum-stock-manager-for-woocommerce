<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $E4130 = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $a6765 = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.2', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $A1786 = []; private static $e3f26 = []; private $Fbafe; public function __construct() { goto Ef8f0; D6ee7: $B1255 = (array) apply_filters('atum/addons/loader/extra_addons', []); goto E8c92; C49a0: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto Fff96; Fff96: $this->check_addons(); goto Cbea0; D11a7: E9c3c: goto bca31; E8c92: if (empty($B1255)) { goto d54de; } goto f4cd5; Ef8f0: $this->Fbafe = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto D6ee7; bca31: d54de: goto C49a0; f4cd5: foreach ($B1255 as $f2812 => $Cf907) { goto cb0f2; acc9b: f4ccc: goto c6fcc; cb0f2: if (!(!array_key_exists($f2812, $this->a6765) && version_compare($Cf907, '0.0', '>'))) { goto f4ccc; } goto A2ab0; c6fcc: Dbd02: goto d908f; A2ab0: $this->a6765[$f2812] = $Cf907; goto acc9b; d908f: } goto D11a7; Cbea0: } public function load_addons() { goto a76b2; A34ec: $B40a6 = []; goto a5139; Eca9f: if (!(count(self::$e3f26) > 0)) { goto D8633; } goto b8407; A8960: if (empty($B40a6)) { goto fad5c; } goto C94c9; Ca010: D8633: goto b14a9; a5349: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto Fcf2d; b14a9: A2102: goto A2c20; c9330: foreach ($bdaca as $Ca999 => $fc087) { goto E6dd9; E32ed: $f6ac5 = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $fc087['name'], date_i18n(get_option('date_format'), strtotime($c32ac[$ad766]['expires']))); goto b98aa; Ba9ad: if (!(!$c1a2a && !empty($this->E4130[$Ca999]) && version_compare($this->E4130[$Ca999], $fc087['version'], '<'))) { goto F4649; } goto be04c; ad264: D96aa: goto b8773; e962d: self::$e3f26[] = $Ca999; goto A623f; f2c9a: if (!$C234c) { goto A2295; } goto c1191; c94ea: if (!(!empty($fc087['bootstrap']) && is_callable($fc087['bootstrap']))) { goto b04c1; } goto be0fc; ff628: D92a3: goto Dc4fa; E9edd: if (!(empty($c32ac) || empty($c32ac[$ad766]) || empty($c32ac[$ad766]['key']))) { goto b2e98; } goto bded6; b98aa: goto D96aa; goto E15c2; b8086: self::$e3f26[] = $Ca999; goto C7f57; cc76d: $f6ac5 = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $fc087['name']); goto Abf79; b2a3f: Fd4e4: goto A6f70; bded6: $f6ac5 = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $fc087['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto da8a5; A623f: goto Fd4e4; goto e2361; be0fc: self::$A1786[] = $Ca999; goto A159e; C06cf: self::$e3f26[] = $Ca999; goto f09bd; F4667: array_pop(self::$A1786); goto A4463; f0eb3: $f6ac5 = sprintf(__('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $fc087['name'], '<a href="' . $c7763 . '" target="_blank">', '</a>'); goto ac3b7; E3d7a: b04c1: goto b2a3f; a048e: A55fa: goto f2c9a; Ca522: $bdaca[$Ca999]['bootstrap'] = NULL; goto e962d; Bafe5: $f6ac5 = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $fc087['name']); goto ad264; Eb41d: goto Fd4e4; goto a048e; a61a6: goto Fd4e4; goto ff628; d0032: $f6ac5 = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $fc087['name']); goto A9713; D0224: $B40a6[$Ca999]['expires'] = $c32ac[$ad766]['expires'] ?? 'now'; goto C6bfa; Dc4fa: A2295: goto c94ea; Fdf10: goto Fd4e4; goto F2bc6; Dff3e: A5c8b: goto fbf54; ac3b7: $this->show_notices($fc087, $f6ac5); goto e817e; C6bfa: $B40a6[$Ca999]['key'] = $c32ac[$ad766]['key']; goto F736c; dd064: if (isset($this->a6765[$E5eb4])) { goto A5c8b; } goto d0032; c1191: if (!(isset($bdaca[$E5eb4]) || !$this->Fbafe && !empty($d936d[$E5eb4]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $d936d[$E5eb4]['basename']))) { goto A19a7; } goto cc76d; D6e00: $f6ac5 = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $fc087['name'], $this->a6765[$E5eb4]); goto C6c34; A159e: $c1a2a = call_user_func($fc087['bootstrap']); goto Ba9ad; e32bb: if (!('trial_used' === $c32ac[$ad766]['status'])) { goto dc7f0; } goto a7797; b8773: $this->show_notices($fc087, $f6ac5 . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $fc087['addon_url'] . '" target="_blank">', '</a>')); goto f14a3; f4035: $E5eb4 = $C234c ? str_replace('_trial', '', $Ca999) : $Ca999; goto dd064; be04c: $bdaca[$Ca999]['bootstrap'] = NULL; goto F4667; f09bd: goto Fd4e4; goto Dff3e; a7797: $b6cb4 = array('key' => $c32ac[$ad766]['key'], 'url' => home_url()); goto c49eb; Aee00: if ('now' === $B40a6[$Ca999]['expires']) { goto A802a; } goto E32ed; a843f: $bdaca[$Ca999]['bootstrap'] = NULL; goto efd05; fbf54: if (!version_compare($this->a6765[$E5eb4], $fc087['version'], '>')) { goto A55fa; } goto D6e00; d770b: $bdaca[$Ca999]['bootstrap'] = NULL; goto C06cf; c49eb: $c7763 = add_query_arg($b6cb4, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto f0eb3; A9713: $this->show_notices($fc087, $f6ac5); goto d770b; Dae58: b2e98: goto e32bb; A4463: self::$e3f26[] = $Ca999; goto f3b1f; F736c: $B40a6[$Ca999]['extended'] = $c32ac[$ad766]['extended'] ?? FALSE; goto Aee00; E6dd9: $C234c = strpos($Ca999, '_trial') !== FALSE || strpos($fc087['basename'], 'trial') !== FALSE; goto f4035; f3b1f: F4649: goto E3d7a; C1d86: if (!(empty($c32ac[$ad766]['expires']) || strtotime($c32ac[$ad766]['expires']) <= time())) { goto D92a3; } goto C725b; C6c34: $this->show_notices($fc087, $f6ac5); goto a843f; D80de: $bdaca[$Ca999]['bootstrap'] = NULL; goto b8086; F2bc6: dc7f0: goto C1d86; e2361: A19a7: goto ae49a; ae49a: $ad766 = strtolower($d936d[$E5eb4]['name'] ?? ''); goto E9edd; e817e: $bdaca[$Ca999]['bootstrap'] = NULL; goto e70a0; e70a0: self::$e3f26[] = $Ca999; goto Fdf10; C7f57: goto Fd4e4; goto Dae58; f14a3: $bdaca[$Ca999]['bootstrap'] = NULL; goto C485f; da8a5: $this->show_notices($fc087, $f6ac5); goto D80de; C725b: $B40a6[$Ca999] = $fc087; goto D0224; E15c2: A802a: goto Bafe5; Abf79: $this->show_notices($fc087, $f6ac5); goto Ca522; efd05: self::$e3f26[] = $Ca999; goto Eb41d; C485f: self::$e3f26[] = $Ca999; goto a61a6; A6f70: } goto D72a2; a76b2: $bdaca = Addons::get_installed_addons(); goto ed831; C94c9: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto a5349; b8407: Addons::set_installed_addons($bdaca); goto Ca010; ce1cf: $acfc8->set_js_dependencies(['atum-trials-modal']); goto ea592; a5139: $c32ac = Addons::get_keys(); goto Df7ac; Fcf2d: $acfc8 = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto ce1cf; c63c3: fad5c: goto Eca9f; ea592: $acfc8->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($B40a6), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $B40a6])); goto c63c3; ed831: if (empty($bdaca)) { goto A2102; } goto A34ec; Df7ac: $d936d = Addons::get_addons_paths(); goto c9330; D72a2: c43d1: goto A8960; A2c20: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($A174f) { $A174f['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $A174f; }); add_action('atum/check_addons', function () { goto a4be2; Ad965: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto Bb7b4; } goto a6575; eb86e: foreach ($D1007 as $Ff204) { goto E1e02; D6e2a: $B37e2['expires'] = $cbc5a->a6fe0 ?? date_i18n('Y-m-d H:i:s'); goto Edd52; F7c19: Dc915: goto E72fb; ce63e: Dbeed: goto c7e54; e86dc: $d289d = $d69d5[$ad766]; goto D0f9e; D5393: if (!($d289d['status'] !== $cbc5a->d35cb)) { goto fcbef; } goto E8fbf; e9c67: if (!(empty($d289d['expires']) || $d289d['expires'] !== $cbc5a->a6fe0)) { goto a8807; } goto D6e2a; bc179: if (!(strpos($Bce95, 'trial') !== FALSE)) { goto A82c8; } goto a50e8; E1e02: $Bce95 = strtolower($Ff204['name']); goto bc179; E8fbf: $B37e2['status'] = $cbc5a->d35cb; goto F700c; f517c: $B37e2['trial'] = TRUE; goto Ffe99; F700c: fcbef: goto e9c67; E72fb: b099d: goto f3f66; f3f66: fc66a: goto Ec231; Fa9e0: B7fdb: goto F7c19; Ea635: $cbc5a = json_decode(wp_remote_retrieve_body($Ecd46)); goto C351f; c7e54: if (empty(array_diff_assoc($d289d, $B37e2))) { goto B7fdb; } goto b56f5; Ec231: A82c8: goto Ed261; B3243: $B37e2['extended'] = TRUE; goto ce63e; b3075: $C12aa = TRUE; goto e86dc; afa08: if (!$cbc5a) { goto Dc915; } goto D5393; Ffe99: f6257: goto Bbc7d; C351f: $B37e2 = $d289d; goto afa08; Bbc7d: if (!(empty($d289d['extended']) && (!isset($cbc5a->e6320) || TRUE !== $cbc5a->e6320))) { goto Dbeed; } goto B3243; b793f: if (!(!is_wp_error($Ecd46) && isset($d289d['status']) && 'valid' === $d289d['status'])) { goto b099d; } goto Ea635; Ed261: e92e6: goto d41be; Edd52: a8807: goto f719a; F3e88: if (!(is_array($d69d5) && array_key_exists($ad766, $d69d5))) { goto fc66a; } goto b3075; a50e8: $ad766 = trim(str_replace('trial', '', $Bce95)); goto F3e88; D0f9e: $Ecd46 = Addons::check_license($Bce95, $d289d['key']); goto b793f; f719a: if (!(empty($d289d['trial']) && isset($cbc5a->E8c3a) && TRUE === $cbc5a->E8c3a)) { goto f6257; } goto f517c; b56f5: Addons::update_key($Bce95, $B37e2); goto Fa9e0; d41be: } goto d3e65; D0dc4: D3937: goto Ae35c; d3e65: Ea835: goto Dea80; a4be2: $d69d5 = Addons::get_keys(); goto A2f53; a6575: return; goto E1f58; Dea80: if (!$C12aa) { goto D3937; } goto bac0a; E1f58: Bb7b4: goto B52fb; B52fb: $C12aa = FALSE; goto eb86e; A2f53: $D1007 = Addons::get_installed_addons(); goto Ad965; bac0a: self::set_last_api_access('check_addons'); goto D0dc4; Ae35c: }); } private function show_notices($fc087, $f6ac5) { AtumAdminNotices::add_notice($f6ac5, strtolower($fc087['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $fc087['basename'], function ($D5714, $Ae597) use($f6ac5) { goto B2647; f928c: echo $f6ac5; goto F9499; Fd3bc: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto C5b02; B2647: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto f928c; E3ef5: echo esc_attr($D5714); goto Fd3bc; Ce319: echo esc_attr($D5714); goto be89c; F9499: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto Ce319; be89c: ?>"] th, tr[data-plugin="<?php  goto E3ef5; C5b02: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$A1786; } public static function get_non_bootstrapped_addons() { return self::$e3f26; } public static function check_addon($f2812, $Bce95, $f0feb) { goto c473e; Fefe7: return TRUE; goto e7b2a; Bea9a: return FALSE; goto E52ea; Da913: if (!(stripos($f0feb, '-trial.php') === FALSE)) { goto c1cd3; } goto Bea9a; bb47b: C4269: goto Da913; Ca7d8: return FALSE; goto d1da3; b7c77: if (!(stripos($Bce95, 'Trial') === FALSE)) { goto C4269; } goto Ff4b8; E52ea: c1cd3: goto Fefe7; d1da3: a79b6: goto b7c77; Ff4b8: return FALSE; goto bb47b; c473e: if (!(stripos($f2812, '_trial') === FALSE)) { goto a79b6; } goto Ca7d8; e7b2a: } }