<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $WXMyF = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1'); private $LtUNw = array('action_logs' => '1.3.5', 'export_pro' => '1.5.5', 'multi_inventory' => '1.8.0', 'product_levels' => '1.8.7.1', 'purchase_orders' => '1.1.1', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0', 'barcodes_pro' => '0.0.1'); private static $CXAz9 = []; private static $HqZ2i = []; private $cJG_2; public function __construct() { goto xrTmM; xrTmM: $this->cJG_2 = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto B7MkR; v89Qs: IvcY2: goto r04BG; w23jU: foreach ($AMuuQ as $PzG5t => $ZhWhv) { goto qUNz2; zpNOU: J5wvg: goto XNrVC; U8bqo: rToG_: goto zpNOU; Ir4r6: $this->LtUNw[$PzG5t] = $ZhWhv; goto U8bqo; qUNz2: if (!(!array_key_exists($PzG5t, $this->LtUNw) && version_compare($ZhWhv, '0.0', '>'))) { goto rToG_; } goto Ir4r6; XNrVC: } goto v89Qs; LQ2uk: if (empty($AMuuQ)) { goto BkhjC; } goto w23jU; r04BG: BkhjC: goto jyc1c; B7MkR: $AMuuQ = (array) apply_filters('atum/addons/loader/extra_addons', []); goto LQ2uk; jyc1c: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto sloL1; sloL1: $this->check_trials(); goto vnO5m; vnO5m: } public function load_addons() { goto GDcdt; WAwjv: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto Rfyft; Rfyft: $HDFP6 = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto F06gC; Fq1EP: $MlM8u = Addons::get_keys(); goto Xds42; F06gC: $HDFP6->set_js_dependencies(['atum-trials-modal']); goto a12x3; qHEFN: if (empty($NWnTW)) { goto xHjKR; } goto NXSG8; Xds42: $qy2JE = Addons::get_addons_paths(); goto TMEi1; UiSbF: Addons::set_installed_addons($NWnTW); goto ynXqR; NXSG8: $ka0R1 = []; goto Fq1EP; RCwfh: xHjKR: goto D2bzH; TMEi1: foreach ($NWnTW as $Pae2w => $tWBTJ) { goto p8IWp; h1dSq: if (!(empty($MlM8u[$FStQM]['expires']) || strtotime($MlM8u[$FStQM]['expires']) <= time())) { goto wGcvk; } goto o5UXN; lbzu2: FZgcG: goto EtDTe; BiT6h: AtumAdminNotices::add_notice($aSSS5, strtolower($tWBTJ['name']), 'error', FALSE, TRUE); goto Yb42z; vObM0: $NWnTW[$Pae2w]['bootstrap'] = NULL; goto Mz4Xx; g_b6u: self::$HqZ2i[] = $Pae2w; goto B1o02; JhzTO: $AijAS = $O0ItI ? str_replace('_trial', '', $Pae2w) : $Pae2w; goto JmDWp; fChKk: $NWnTW[$Pae2w]['bootstrap'] = NULL; goto g_b6u; rioJm: sQ5bR: goto h1dSq; j26_r: goto vPxUb; goto rioJm; fpksv: goto vPxUb; goto hlYDV; AZcs3: if (!(!$us_1C && !empty($this->WXMyF[$Pae2w]) && version_compare($this->WXMyF[$Pae2w], $tWBTJ['version'], '<'))) { goto mKhWo; } goto RhI4X; aojDH: self::$HqZ2i[] = $Pae2w; goto SghSS; Yb42z: $NWnTW[$Pae2w]['bootstrap'] = NULL; goto XiU6f; p8IWp: $O0ItI = strpos($Pae2w, '_trial') !== FALSE || strpos($tWBTJ['basename'], 'trial') !== FALSE; goto JhzTO; c2NoH: if (!(empty($MlM8u) || empty($MlM8u[$FStQM]) || empty($MlM8u[$FStQM]['key']))) { goto sQ5bR; } goto QKM1c; nmJ14: $NWnTW[$Pae2w]['bootstrap'] = NULL; goto Fpmjl; o5UXN: $ka0R1[$Pae2w] = $tWBTJ; goto uB92D; pLzLD: AtumAdminNotices::add_notice($aSSS5, strtolower($tWBTJ['name']), 'error', FALSE, TRUE); goto vObM0; cfQ4R: SoHya: goto ve8LO; ENFXg: if ('now' === $ka0R1[$Pae2w]['expires']) { goto SoHya; } goto JkPxu; Fpmjl: self::$HqZ2i[] = $Pae2w; goto j26_r; X2qvA: $aSSS5 = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $tWBTJ['name']); goto F0amR; JkPxu: $aSSS5 = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $tWBTJ['name'], date_i18n(get_option('date_format'), strtotime($MlM8u[$FStQM]['expires']))); goto LRrTh; M4p14: kwlYT: goto go3Y7; B1o02: goto vPxUb; goto pa4Mx; LRrTh: goto ehlKp; goto cfQ4R; e2ASU: goto vPxUb; goto M4p14; gtuvg: goto vPxUb; goto hMUHr; hMUHr: CsPvo: goto NnxRn; FWp5n: BRQML: goto LmRG9; EtDTe: if (!(!empty($tWBTJ['bootstrap']) && is_callable($tWBTJ['bootstrap']))) { goto BRQML; } goto aingQ; v7NY9: $ka0R1[$Pae2w]['key'] = $MlM8u[$FStQM]['key']; goto NjSfT; BrCDX: if (!(isset($NWnTW[$AijAS]) || !$this->cJG_2 && !empty($qy2JE[$AijAS]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $qy2JE[$AijAS]['basename']))) { goto CsPvo; } goto X2qvA; AE0Wa: AtumAdminNotices::add_notice($aSSS5 . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $tWBTJ['addon_url'] . '" target="_blank">', '</a>'), strtolower($tWBTJ['name']), 'error', FALSE, TRUE); goto fChKk; yauAb: if (!$O0ItI) { goto FZgcG; } goto BrCDX; muy75: $aSSS5 = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $tWBTJ['name']); goto BiT6h; go3Y7: if (!version_compare($this->LtUNw[$AijAS], $tWBTJ['version'], '>')) { goto dBPd6; } goto Wa3AV; XiU6f: self::$HqZ2i[] = $Pae2w; goto e2ASU; hlYDV: dBPd6: goto yauAb; F0amR: AtumAdminNotices::add_notice($aSSS5, strtolower($tWBTJ['name']), 'error', FALSE, TRUE); goto OqzYO; pa4Mx: wGcvk: goto lbzu2; NnxRn: $FStQM = strtolower($qy2JE[$AijAS]['name'] ?? ''); goto c2NoH; NjSfT: $ka0R1[$Pae2w]['extended'] = $MlM8u[$FStQM]['extended'] ?? FALSE; goto ENFXg; l5avm: ehlKp: goto AE0Wa; Mz4Xx: self::$HqZ2i[] = $Pae2w; goto fpksv; JmDWp: if (isset($this->LtUNw[$AijAS])) { goto kwlYT; } goto muy75; aingQ: self::$CXAz9[] = $Pae2w; goto DulXd; LmRG9: vPxUb: goto d302F; mW1P9: array_pop(self::$CXAz9); goto aojDH; pds4b: self::$HqZ2i[] = $Pae2w; goto gtuvg; ve8LO: $aSSS5 = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $tWBTJ['name']); goto l5avm; OqzYO: $NWnTW[$Pae2w]['bootstrap'] = NULL; goto pds4b; UkfLT: AtumAdminNotices::add_notice($aSSS5, strtolower($tWBTJ['name']), 'error', FALSE, TRUE); goto nmJ14; Wa3AV: $aSSS5 = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $tWBTJ['name'], $this->LtUNw[$AijAS]); goto pLzLD; QKM1c: $aSSS5 = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $tWBTJ['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto UkfLT; RhI4X: $NWnTW[$Pae2w]['bootstrap'] = NULL; goto mW1P9; DulXd: $us_1C = call_user_func($tWBTJ['bootstrap']); goto AZcs3; uB92D: $ka0R1[$Pae2w]['expires'] = $MlM8u[$FStQM]['expires'] ?? 'now'; goto v7NY9; SghSS: mKhWo: goto FWp5n; d302F: } goto HxKJL; HxKJL: ichXK: goto bf8hw; AcIvr: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto WAwjv; wrhUz: if (!(count(self::$HqZ2i) > 0)) { goto kz_MX; } goto UiSbF; ynXqR: kz_MX: goto RCwfh; a12x3: $HDFP6->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($ka0R1), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $ka0R1])); goto UOg1c; UOg1c: GBvtd: goto wrhUz; GDcdt: $NWnTW = Addons::get_installed_addons(); goto qHEFN; bf8hw: if (empty($ka0R1)) { goto GBvtd; } goto AcIvr; D2bzH: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($zjSon) { $zjSon['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $zjSon; }); add_action('atum/check_trials', function () { goto I4E0q; go5AH: foreach ($B637S as $t6nE2) { goto JfO1B; iYe5l: if (!(strpos($zz2vf, 'trial') !== FALSE)) { goto eDnYP; } goto z6Vu3; H8k3K: $Rmz95['status'] = $b59CG->ljTyx; goto K7J6U; JfO1B: $zz2vf = strtolower($t6nE2['name']); goto iYe5l; SEL64: $Rmz95['expires'] = $b59CG->JOULS ?? date_i18n('Y-m-d H:i:s'); goto Hbl2U; BIkRY: if (!(empty($rB5gC['extended']) && (!isset($b59CG->AMwSx) || TRUE !== $b59CG->AMwSx))) { goto PcNne; } goto Sy3aZ; z6Vu3: $FStQM = trim(str_replace('trial', '', $zz2vf)); goto a2W14; ShTHu: Addons::update_key($zz2vf, $Rmz95); goto n8rTj; gg50A: if (!($rB5gC['status'] !== $b59CG->ljTyx)) { goto XVsoX; } goto H8k3K; mNn1e: if (!(!is_wp_error($g4sJc) && isset($rB5gC['status']) && 'valid' === $rB5gC['status'])) { goto UK2E8; } goto rf2Ll; eyJMi: $Rmz95['trial'] = TRUE; goto biwM2; SxnMN: eDnYP: goto FqdHY; n1ojh: if (!(empty($rB5gC['trial']) && isset($b59CG->eQqPv) && TRUE === $b59CG->eQqPv)) { goto yTivO; } goto eyJMi; KtQDb: if (empty(array_diff_assoc($rB5gC, $Rmz95))) { goto psjRq; } goto ShTHu; Etlbg: $Rmz95 = $rB5gC; goto iyAL3; Za7oF: p0m91: goto SxnMN; H4XnK: $g4sJc = Addons::check_license($zz2vf, $rB5gC['key']); goto mNn1e; biwM2: yTivO: goto BIkRY; a2W14: if (!array_key_exists($BgZTp[$FStQM])) { goto p0m91; } goto g9TQG; Y8R_H: UK2E8: goto Za7oF; FqdHY: eiQfQ: goto kwtCU; rf2Ll: $b59CG = json_decode(wp_remote_retrieve_body($g4sJc)); goto Etlbg; l3Z3e: if (!(empty($rB5gC['expires']) || $rB5gC['expires'] !== $b59CG->JOULS)) { goto nXUam; } goto SEL64; zJxBA: PcNne: goto KtQDb; Hbl2U: nXUam: goto n1ojh; g9TQG: $rB5gC = $BgZTp[$FStQM]; goto H4XnK; Sy3aZ: $Rmz95['extended'] = TRUE; goto zJxBA; iyAL3: if (!$b59CG) { goto JXPFZ; } goto gg50A; n8rTj: psjRq: goto coINr; K7J6U: XVsoX: goto l3Z3e; coINr: JXPFZ: goto Y8R_H; kwtCU: } goto UHkKo; I4E0q: $BgZTp = Addons::get_keys(); goto g_e6F; UHkKo: s8lu7: goto ufmIx; g_e6F: $B637S = Addons::get_installed_addons(); goto go5AH; ufmIx: }); } public static function get_bootstrapped_addons() { return self::$CXAz9; } public static function get_non_bootstrapped_addons() { return self::$HqZ2i; } public static function check_addon($PzG5t, $zz2vf, $Uf4tn) { goto dIiV0; hMXtg: rX9n7: goto wnhJk; xZCw4: xGpvO: goto IGq3R; qLPAi: return FALSE; goto xZCw4; Q94Z1: FgYya: goto RJk9N; IGq3R: if (!(stripos($zz2vf, 'Trial') === FALSE)) { goto FgYya; } goto JZRp3; dIiV0: if (!(stripos($PzG5t, '_trial') === FALSE)) { goto xGpvO; } goto qLPAi; RJk9N: if (!(stripos($Uf4tn, '-trial.php') === FALSE)) { goto rX9n7; } goto UzKPC; wnhJk: return TRUE; goto jlLil; JZRp3: return FALSE; goto Q94Z1; UzKPC: return FALSE; goto hMXtg; jlLil: } }