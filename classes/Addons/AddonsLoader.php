<?php
/** @noinspection ALL */
/**
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2023 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $uKZjO = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.6.0', 'purchase_orders' => '0.0.1', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1'); private $eXWCp = array('action_logs' => '1.3.4', 'export_pro' => '1.5.4', 'multi_inventory' => '1.7.9', 'product_levels' => '1.8.6', 'purchase_orders' => '1.0.9', 'stock_takes' => '1.0.0', 'pick_pack' => '1.0.0'); private static $QTpd0 = []; private static $WEdON = []; private $N0w5U; public function __construct() { goto kcK9d; lO2Bz: $this->check_trials(); goto eDOp_; lEB0v: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto lO2Bz; kcK9d: $this->N0w5U = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto lEB0v; eDOp_: } public function load_addons() { goto e7Mjz; JRV9z: c4_JY: goto Z5A5l; F87WO: fXNb0: goto YLBRH; tg_tx: Addons::set_installed_addons($oJCCA); goto aNW7f; e7Mjz: $oJCCA = Addons::get_installed_addons(); goto nxOu0; puXVq: $LYra1 = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto jtpz_; nxOu0: if (empty($oJCCA)) { goto c4_JY; } goto W4uwh; s42TA: foreach ($oJCCA as $I9_zt => $BM1CY) { goto ttxE2; ttxE2: $y8P6C = strpos($I9_zt, '_trial') !== FALSE || strpos($BM1CY['basename'], 'trial') !== FALSE; goto zQeJB; zQeJB: $mTTZ0 = $y8P6C ? str_replace('_trial', '', $I9_zt) : $I9_zt; goto f46fX; WgFaD: $RI7vh = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $BM1CY['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto IiSns; AAVql: lo73v: goto f5t8e; V9C1B: NHH3D: goto RndO1; f5t8e: if (!version_compare($this->eXWCp[$mTTZ0], $BM1CY['version'], '>')) { goto eL5a9; } goto jkkyY; PEmbl: self::$WEdON[] = $I9_zt; goto L2fIp; zraV7: AtumAdminNotices::add_notice($RI7vh, strtolower($BM1CY['name']), 'error', FALSE, TRUE); goto dS264; j3ZG9: $RI7vh = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $BM1CY['name'], date_i18n(get_option('date_format'), strtotime($HKF0L[$ekViC]['expires']))); goto CX3sf; hGx2S: $stRr4[$I9_zt]['extended'] = $HKF0L[$ekViC]['extended'] ?? FALSE; goto DmLPQ; JBika: if (!(empty($HKF0L) || empty($HKF0L[$ekViC]) || empty($HKF0L[$ekViC]['key']))) { goto fuKez; } goto WgFaD; j5INF: goto hHQ_0; goto PmRIL; Sw4hJ: self::$QTpd0[] = $I9_zt; goto FahH3; tVyXF: hHQ_0: goto jwxs5; rjytd: $ekViC = strtolower($C4ZOY[$mTTZ0]['name'] ?? ''); goto JBika; dS264: $oJCCA[$I9_zt]['bootstrap'] = NULL; goto l6Ib8; PmRIL: JLZB2: goto hrNsq; GL3L0: if (!(empty($HKF0L[$ekViC]['expires']) || strtotime($HKF0L[$ekViC]['expires']) <= time())) { goto JLZB2; } goto pshVv; mauH1: self::$WEdON[] = $I9_zt; goto RgBoj; jkkyY: $RI7vh = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $BM1CY['name'], $this->eXWCp[$mTTZ0]); goto zraV7; G1Yk_: self::$WEdON[] = $I9_zt; goto I_kDF; LOJnI: AtumAdminNotices::add_notice($RI7vh, strtolower($BM1CY['name']), 'error', FALSE, TRUE); goto d3Vx4; vEY7n: $RI7vh = sprintf(__('The ATUM %s could not be loaded because the full version is installed. To use the trial, uninstall the full version first.', ATUM_TEXT_DOMAIN), $BM1CY['name']); goto ferex; mwURB: array_pop(self::$QTpd0); goto mauH1; cnfiS: $stRr4[$I9_zt]['expires'] = $HKF0L[$ekViC]['expires'] ?? 'now'; goto ffdkm; d3Vx4: $oJCCA[$I9_zt]['bootstrap'] = NULL; goto G1Yk_; L2fIp: goto hHQ_0; goto Ts1Fj; l6Ib8: self::$WEdON[] = $I9_zt; goto bBUit; L9OsD: $oJCCA[$I9_zt]['bootstrap'] = NULL; goto PEmbl; RndO1: $RI7vh = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $BM1CY['name']); goto Pzs_o; ffdkm: $stRr4[$I9_zt]['key'] = $HKF0L[$ekViC]['key']; goto hGx2S; I_kDF: goto hHQ_0; goto AAVql; iB9hD: if (!$y8P6C) { goto NLlkX; } goto GGHuA; GGHuA: if (!(isset($oJCCA[$mTTZ0]) || !$this->N0w5U && !empty($C4ZOY[$mTTZ0]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $C4ZOY[$mTTZ0]['basename']))) { goto wUaqt; } goto vEY7n; aQdFb: self::$WEdON[] = $I9_zt; goto FtzC1; crvlV: if (!(!empty($BM1CY['bootstrap']) && is_callable($BM1CY['bootstrap']))) { goto gThKx; } goto Sw4hJ; WzCHn: fuKez: goto GL3L0; e40G1: eL5a9: goto iB9hD; hrNsq: NLlkX: goto crvlV; d_utU: $oJCCA[$I9_zt]['bootstrap'] = NULL; goto mwURB; p3RfO: if (!(!$vGyAZ && !empty($this->uKZjO[$I9_zt]) && version_compare($this->uKZjO[$I9_zt], $BM1CY['version'], '<'))) { goto h29Yp; } goto d_utU; Ts1Fj: wUaqt: goto rjytd; v2V8l: $oJCCA[$I9_zt]['bootstrap'] = NULL; goto KFuaU; FahH3: $vGyAZ = call_user_func($BM1CY['bootstrap']); goto p3RfO; tv1Lv: gThKx: goto tVyXF; PR_6K: $oJCCA[$I9_zt]['bootstrap'] = NULL; goto aQdFb; CX3sf: goto pkT9l; goto V9C1B; FtzC1: goto hHQ_0; goto WzCHn; KFuaU: self::$WEdON[] = $I9_zt; goto j5INF; pshVv: $stRr4[$I9_zt] = $BM1CY; goto cnfiS; V5mIi: $RI7vh = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $BM1CY['name']); goto LOJnI; rXVP1: AtumAdminNotices::add_notice($RI7vh . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $BM1CY['addon_url'] . '" target="_blank">', '</a>'), strtolower($BM1CY['name']), 'error', FALSE, TRUE); goto v2V8l; RgBoj: h29Yp: goto tv1Lv; ferex: AtumAdminNotices::add_notice($RI7vh, strtolower($BM1CY['name']), 'error', FALSE, TRUE); goto L9OsD; bBUit: goto hHQ_0; goto e40G1; Pzs_o: pkT9l: goto rXVP1; f46fX: if (isset($this->eXWCp[$mTTZ0])) { goto lo73v; } goto V5mIi; IiSns: AtumAdminNotices::add_notice($RI7vh, strtolower($BM1CY['name']), 'error', FALSE, TRUE); goto PR_6K; DmLPQ: if ('now' === $stRr4[$I9_zt]['expires']) { goto NHH3D; } goto j3ZG9; jwxs5: } goto F87WO; aNW7f: F9Ffy: goto JRV9z; vhc_0: ZjcpV: goto WUd6V; W4uwh: $stRr4 = []; goto u0qJc; EGk6Q: $C4ZOY = Addons::get_addons_paths(); goto s42TA; jtpz_: $LYra1->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($stRr4), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $stRr4])); goto vhc_0; WUd6V: if (!(count(self::$WEdON) > 0)) { goto F9Ffy; } goto tg_tx; u0qJc: $HKF0L = Addons::get_keys(); goto EGk6Q; YLBRH: if (empty($stRr4)) { goto ZjcpV; } goto puXVq; Z5A5l: } public function check_trials() { add_filter('atum/queues/recurring_hooks', function ($sJGpB) { $sJGpB['atum/check_trials'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $sJGpB; }); add_action('atum/check_trials', function () { goto qvvCs; WfrkF: foreach ($ZC1O5 as $WO1Kt => $OOQDp) { goto nt7xO; AJ3SE: $HyLvP = []; goto GppPh; mYE8v: if (!(empty($OOQDp['expires']) || $OOQDp['expires'] !== $bpgr1->ZQ_Hk)) { goto HP0CG; } goto fR3pR; fR3pR: $HyLvP['expires'] = $bpgr1->ZQ_Hk; goto Jhz15; m0BZ2: if (!($OOQDp['status'] !== $bpgr1->bMjMi)) { goto BrfIH; } goto OItop; ID8Fk: if (empty($HyLvP)) { goto nRuQE; } goto Q8XjQ; yVoZ8: oExKF: goto eSvkV; JZJ0l: fZszh: goto ezGTG; IxMXA: $XmmMM = Addons::check_license($WO1Kt, $OOQDp['key']); goto JKqFF; eSvkV: T_9c5: goto ID8Fk; Q8XjQ: $HyLvP['key'] = $OOQDp['key']; goto ULlLs; Q9u5b: H9h3P: goto sWk1H; yzSeH: $bpgr1 = json_decode(wp_remote_retrieve_body($XmmMM)); goto AJ3SE; OItop: $HyLvP['status'] = $bpgr1->bMjMi; goto cfVwD; ezGTG: sfOwS: goto Q9u5b; cfVwD: BrfIH: goto mYE8v; JKqFF: if (!(!is_wp_error($XmmMM) && isset($OOQDp['status']) && 'valid' === $OOQDp['status'])) { goto fZszh; } goto yzSeH; GppPh: if (!$bpgr1) { goto T_9c5; } goto m0BZ2; lQvN2: nRuQE: goto JZJ0l; PtfCA: $HyLvP['extended'] = TRUE; goto yVoZ8; ULlLs: Addons::update_key($WO1Kt, $HyLvP); goto lQvN2; Jhz15: HP0CG: goto wFK1l; nt7xO: if (!(!empty($OOQDp['trial']) && TRUE === $OOQDp['trial'])) { goto sfOwS; } goto IxMXA; wFK1l: if (!(empty($OOQDp['extended']) && (!isset($bpgr1->MefE6) || TRUE !== $bpgr1->MefE6))) { goto oExKF; } goto PtfCA; sWk1H: } goto PC2Ez; qvvCs: $ZC1O5 = Addons::get_keys(); goto WfrkF; PC2Ez: itY9y: goto bkp9S; bkp9S: }); } public static function get_bootstrapped_addons() { return self::$QTpd0; } public static function get_non_bootstrapped_addons() { return self::$WEdON; } }